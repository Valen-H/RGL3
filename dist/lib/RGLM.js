/// <reference path="./rgl">
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RGLM = exports.csimerger = void 0;
const tslib_1 = require("tslib");
const assert = tslib_1.__importStar(require("assert"));
const fs = tslib_1.__importStar(require("fs-extra"));
const path = tslib_1.__importStar(require("path"));
function csimerger(str) {
    let idx = 0, //runner
    csi = 0, //csidx valid at 2
    csidx = [-1, -1]; //first csi
    function proc(str, i1, i2) {
        let s = str.slice(i1, i2);
        if (!s.endsWith('m')) {
            s += 'm';
            i2++;
        }
        s = s.replaceAll(/m\x1b\[/g, ';');
        return str.slice(0, i1) + s + str.slice(i2);
    } //proc
    if (!str)
        return str;
    let cln = str;
    do {
        const c = cln[idx] || '';
        if (!csi && c == '\x1b') {
            csi = 1;
            csidx[0] = idx;
        }
        else if (csi == 1 && c == '[')
            csi = 2;
        else if (csi == 1)
            csi = 0;
        else if (csi == 2 && c == 'm')
            csi = 3;
        else if (csi == 3 && c == '\x1b')
            csi = 4;
        else if (csi == 4 && c == '[')
            csi = 2;
        else if (csi > 1 && !/^([\d,;:]+)$/.test(c)) {
            csidx[1] = idx - 1;
            if (csi != 2) {
                const ncln = proc(cln, ...csidx);
                if (cln != ncln)
                    idx = 0;
                cln = ncln;
            }
            csi = 0;
            csidx = [-1, -1];
        }
        idx++;
    } while (idx <= cln.length);
    return cln;
} //csimerger
exports.csimerger = csimerger;
var RGLM;
(function (RGLM) {
    /**
     * RGLM Magic
     */
    RGLM.MAGIC = Buffer.from("RGL\0", "ascii");
    class RGLMChunk {
        chr;
        fg;
        bg;
        st;
        cust;
        static #idcntr = 0;
        /**
         * Formatting mappings, set by parent module
         */
        static mappings = {
            fg: [],
            bg: [],
            st: [],
            cust: [],
        };
        /**
         * Chunk unique id
         */
        _id = RGLMChunk.#idcntr++;
        onrender = (idx, c, par) => this.print;
        constructor(chr, fg, bg, st, cust) {
            this.chr = chr;
            this.fg = fg;
            this.bg = bg;
            this.st = st;
            this.cust = cust;
            assert.ok(typeof chr == "string", "Bad Chunk");
            this.chr = chr.replaceAll('\x00', '');
            assert.ok(this.chr.length <= 1 &&
                Buffer.from(this.chr, "ascii").length <= 4 &&
                fg >= 0 && fg <= 0xff &&
                bg >= 0 && bg <= 0xff &&
                st >= 0 && st <= 0xff &&
                cust >= 0 && cust <= 0xff, "Bad Chunk");
        } //ctor
        /**
         * Repack into Buf8
         */
        get pack() {
            const chr = Buffer.alloc(4);
            chr.write(this.chr);
            return Buffer.concat([chr, Buffer.from([this.fg, this.bg, this.st, this.cust])], 8);
        } //g-pack
        /**
         * Craft invalid/blank ender Chunk
         */
        static blank() {
            return new RGLMChunk('', 0xff, 0xff, 0xff, 0xff);
        } //blank
        /**
         * Buf8 -> Chunk
         */
        static parse(buf) {
            return new RGLMChunk(buf.slice(0, 4).toString(), buf[4], buf[5], buf[6], buf[7]);
        } //parse
        /**
         * Chunk string representation
         */
        get print() {
            const fg = RGLMChunk.mappings.fg[this.fg] ?? ((s) => s), bg = RGLMChunk.mappings.bg[this.bg] ?? ((s) => s), st = RGLMChunk.mappings.st[this.st] ?? ((s) => s), cust = RGLMChunk.mappings.cust[this.cust] ?? ((s) => s);
            return csimerger(cust(st(fg(bg(this.chr ?? ' ')))));
        } //g-print
    } //RGLMChunk
    RGLM.RGLMChunk = RGLMChunk;
    class RGLMap {
        dimens;
        parent;
        scroll;
        static RGLMChunk = RGLMChunk;
        /**
         * Map Chunks
         */
        chunks = [];
        _loadedFrom = "";
        meta = {};
        constructor(dimens = [0, 0], parent, scroll = [0, 0]) {
            this.dimens = dimens;
            this.parent = parent;
            this.scroll = scroll;
            assert.ok(dimens instanceof Array && dimens.length == 2 && dimens.every(d => d >= 0) &&
                scroll instanceof Array && scroll.length == 2 && parent, "Bad Map");
            this.dimens = dimens.map(d => Number(d));
            this.scroll = scroll.map(d => Number(d));
        } //ctor
        /**
         * Create empty/blank Map
         */
        static blank(par) {
            return new RGLM.RGLMap([0, 0], par);
        } //blank
        /**
         * Craft Map from fs
         */
        static async parse(from, par) {
            assert.ok(from, "'from' must be provided");
            from = path.resolve(from);
            const dat = await fs.promises.readFile(from, {
                flag: "r"
            }), end = Buffer.from("FFFFFFFFFFFFFFFF", "hex");
            assert.ok(dat.length >= 8 && !dat.slice(0, 4).compare(Buffer.from("RGL\0", "ascii")), "Broken RGLM");
            let map = new RGLMap([dat.slice(4, 6).readUInt16LE(), dat.slice(6, 8).readUInt16LE()], par), chk = null, i = 8, passing = true;
            map._loadedFrom = from;
            if (dat.length > 8) {
                do {
                    if (i + 8 > dat.length)
                        throw "Broken RGLM";
                    chk = dat.slice(i, i += 8);
                    if (chk.compare(end)) {
                        map.chunks.push(RGLMap.RGLMChunk.parse(chk));
                        if (i == dat.length)
                            break;
                    }
                    else
                        passing = false;
                } while (passing);
            }
            if (chk && !chk.compare(end)) {
                const meta = dat.slice(i).toString("utf8").split('&');
                for (const met of meta) {
                    const pair = met.split('=');
                    map.meta[pair[0]] = pair[1] ?? '';
                }
            }
            return map;
        } //parse
        /**
         * (Re)store Map to fs
         */
        async store(to = this._loadedFrom) {
            assert.ok(to && typeof to == "string", "'destination' must be a valid path");
            return await fs.promises.writeFile(to, this.pack, {
                encoding: "binary",
                flag: "w",
                mode: 0o775
            });
        } //store
        /**
         * Map -> Buff
         */
        get pack() {
            const dimens = [
                Buffer.allocUnsafe(2),
                Buffer.allocUnsafe(2),
            ];
            let meta = Buffer.from(Object.entries(this.meta).map(e => e.join('=')).join('&'), "utf8");
            dimens[0].writeUInt16LE(this.dimens[0]);
            dimens[1].writeUInt16LE(this.dimens[1]);
            if (meta.length)
                meta = Buffer.concat([Buffer.from("FFFFFFFFFFFFFFFF", "hex"), meta]);
            return Buffer.concat([RGLM.MAGIC, ...dimens, ...this.chunks.map(c => c.pack), meta], (this.chunks.length + 1) * 8 + meta.length);
        } //g-pack
        /**
         * String representation of Map's Chunks
         */
        get print() {
            return this.chunks.map(c => c.print).join('');
        } //g-print
        /**
         * Calculate Viewport coordinates from chunklist index
         */
        calcChkIdx(x, y = 0) {
            if (x instanceof RGLMChunk)
                return this.chunks.findIndex(c => c == x);
            assert.ok(x >= 0, "Bad idx");
            return this.dimens[0] * y + x;
        } //calcChkIdx
        /**
         * Calculate chunklist index from Viewport coordinates
         */
        calcChkCrd(idx) {
            if (idx instanceof RGLMChunk)
                idx = this.chunks.findIndex(c => c == idx);
            assert.ok(idx >= 0, "Bad idx");
            return [
                idx % this.dimens[0],
                Math.floor(idx / this.dimens[0])
            ];
        } //calcChkCrd
        /**
         * Get a Chunk
         */
        get(n, x) {
            if (n instanceof RGLMChunk)
                return this.chunks[this.calcChkIdx(n)];
            else if (typeof x == "undefined")
                return this.chunks[n];
            else
                return this.chunks[this.calcChkIdx(n, x)];
        } //get
        /**
         * Place a Chunk
         */
        place(c, n = this.chunks.length, x, repl = 1) {
            const idx = typeof x == "undefined" ? (n instanceof RGLMChunk ? this.calcChkIdx(n) : n) : this.calcChkIdx(n, x);
            assert.ok(idx >= 0, "Bad idx");
            return this.chunks.splice(idx, repl, ...c);
        } //place
        /**
         * Swap Chunks locations
         */
        swap(c1, c2) {
            if (c1 == c2)
                return this;
            const ci1 = this.calcChkIdx(c1);
            assert.ok(ci1 >= 0, "Bad idx");
            const cc1 = this.chunks.splice(ci1, 1)[0];
            const ci2 = this.calcChkIdx(c2);
            assert.ok(ci2 >= 0, "Bad idx");
            const cc2 = this.chunks.splice(ci2, 1, cc1)[0];
            this.chunks.splice(ci1, 0, cc2);
            return this;
        } //swap
        /**
         * Check if Chunk is inside bounds
         *
         * t* - chunk target
         * d* - viewport size
         * s* - viewport scroll
         * * - viewport
         */
        isIn(tx, ty, x = 0, y = 0, sx = this.scroll[0], sy = this.scroll[1], dx = this.dimens[0], dy = this.dimens[1]) {
            if (typeof ty == "undefined")
                ([tx, ty] = this.calcChkCrd(tx));
            const rx = tx - sx, ry = ty - sy;
            return rx >= x && rx < dx && ry >= y && ry < dy;
        } //isIn
        /**
         * Imprint Map on RGL
         */
        async stamp(dx = this.dimens[0], dy = this.dimens[1], x = 0, y = 0, sx = this.scroll[0], sy = this.scroll[1], par = this.parent) {
            assert.ok(par, "Bad parent");
            const sav = [...par.cursor];
            for (let idx = 0; idx < this.chunks.length; idx++) {
                const c = this.chunks[idx];
                if (this.isIn(idx, undefined, x, y, sx, sy, dx, dy)) {
                    await par.move(...(this.calcChkCrd(idx).map((c, idx) => c + [sx, sy][idx])));
                    par.write(c.onrender(idx, c, this));
                }
            }
            await par.move(...sav);
            return this;
        } //stamp
        *[Symbol.iterator]() {
            for (const c of this.chunks)
                yield c;
        }
        get [Symbol.isConcatSpreadable]() {
            return true;
        }
        get [Symbol.toStringTag]() {
            return this.toString();
        }
        toString() {
            return this.print;
        } //toString
    } //RGLMap
    RGLM.RGLMap = RGLMap;
})(RGLM = exports.RGLM || (exports.RGLM = {})); //RGLM
exports.default = RGLM;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUkdMTS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9SR0xNLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDRCQUE0QjtBQUU1QixZQUFZLENBQUM7Ozs7QUFFYix1REFBaUM7QUFDakMscURBQStCO0FBQy9CLG1EQUE2QjtBQUc3QixTQUFnQixTQUFTLENBQUMsR0FBVztJQUNwQyxJQUFJLEdBQUcsR0FBVyxDQUFDLEVBQUUsUUFBUTtJQUM1QixHQUFHLEdBQVcsQ0FBQyxFQUFFLGtCQUFrQjtJQUNuQyxLQUFLLEdBQXFCLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVc7SUFFaEQsU0FBUyxJQUFJLENBQUMsR0FBVyxFQUFFLEVBQVUsRUFBRSxFQUFVO1FBQ2hELElBQUksQ0FBQyxHQUFXLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWxDLElBQUksQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ3JCLENBQUMsSUFBSSxHQUFHLENBQUM7WUFDVCxFQUFFLEVBQUUsQ0FBQztTQUNMO1FBRUQsQ0FBQyxHQUFHLENBQUMsQ0FBQyxVQUFVLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBRWxDLE9BQU8sR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0MsQ0FBQyxDQUFDLE1BQU07SUFFUixJQUFJLENBQUMsR0FBRztRQUFFLE9BQU8sR0FBRyxDQUFDO0lBRXJCLElBQUksR0FBRyxHQUFHLEdBQUcsQ0FBQztJQUVkLEdBQUc7UUFDRixNQUFNLENBQUMsR0FBVyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO1FBRWpDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJ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QUUsSUFBSSxDQUFDLENBQUMsQ0FBQztpQkFDcEM7YUFDRDtZQUVELE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1lBRXZCLE9BQU8sSUFBSSxDQUFDO1FBQ2IsQ0FBQyxDQUFDLE9BQU87UUFFVCxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQztZQUNqQixLQUFLLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxNQUFNO2dCQUMxQixNQUFNLENBQUMsQ0FBQztRQUNWLENBQUM7UUFFRCxJQUFJLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDO1lBQzlCLE9BQU8sSUFBSSxDQUFDO1FBQ2IsQ0FBQztRQUVELElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDO1lBQ3ZCLE9BQU8sSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ3hCLENBQUM7UUFDRCxRQUFRO1lBQ1AsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ25CLENBQUMsQ0FBQyxVQUFVO01BRVgsUUFBUTtJQXBPRyxXQUFNLFNBb09sQixDQUFBO0FBRUYsQ0FBQyxFQWhVYSxJQUFJLEdBQUosWUFBSSxLQUFKLFlBQUksUUFnVWpCLENBQUMsTUFBTTtBQUVSLGtCQUFlLElBQUksQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuL3JnbFwiPlxyXG5cclxuXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5pbXBvcnQgKiBhcyBhc3NlcnQgZnJvbSBcImFzc2VydFwiO1xyXG5pbXBvcnQgKiBhcyBmcyBmcm9tIFwiZnMtZXh0cmFcIjtcclxuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xyXG5pbXBvcnQgKiBhcyByZ2wgZnJvbSBcIi4vcmdsXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3NpbWVyZ2VyKHN0cjogc3RyaW5nKTogc3RyaW5nIHtcclxuXHRsZXQgaWR4OiBudW1iZXIgPSAwLCAvL3J1bm5lclxyXG5cdFx0Y3NpOiBudW1iZXIgPSAwLCAvL2NzaWR4IHZhbGlkIGF0IDJcclxuXHRcdGNzaWR4OiBbbnVtYmVyLCBudW1iZXJdID0gWy0xLCAtMV07IC8vZmlyc3QgY3NpXHJcblx0XHJcblx0ZnVuY3Rpb24gcHJvYyhzdHI6IHN0cmluZywgaTE6IG51bWJlciwgaTI6IG51bWJlcikge1xyXG5cdFx0bGV0IHM6IHN0cmluZyA9IHN0ci5zbGljZShpMSwgaTIpO1xyXG5cdFx0XHJcblx0XHRpZiAoIXMuZW5kc1dpdGgoJ20nKSkge1xyXG5cdFx0XHRzICs9ICdtJztcclxuXHRcdFx0aTIrKztcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0cyA9IHMucmVwbGFjZUFsbCgvbVxceDFiXFxbL2csICc7Jyk7XHJcblx0XHRcclxuXHRcdHJldHVybiBzdHIuc2xpY2UoMCwgaTEpICsgcyArIHN0ci5zbGljZShpMik7XHJcblx0fSAvL3Byb2NcclxuXHRcclxuXHRpZiAoIXN0cikgcmV0dXJuIHN0cjtcclxuXHRcclxuXHRsZXQgY2xuID0gc3RyO1xyXG5cdFxyXG5cdGRvIHtcclxuXHRcdGNvbnN0IGM6IHN0cmluZyA9IGNsbltpZHhdIHx8ICcnO1xyXG5cdFx0XHJcblx0XHRpZiAoIWNzaSAmJiBjID09ICdcXHgxYicpIHtcclxuXHRcdFx0Y3NpID0gMTtcclxuXHRcdFx0Y3NpZHhbMF0gPSBpZHg7XHJcblx0XHR9IGVsc2UgaWYgKGNzaSA9PSAxICYmIGMgPT0gJ1snKSBjc2kgPSAyO1xyXG5cdFx0ZWxzZSBpZiAoY3NpID09IDEpIGNzaSA9IDA7XHJcblx0XHRlbHNlIGlmIChjc2kgPT0gMiAmJiBjID09ICdtJykgY3NpID0gMztcclxuXHRcdGVsc2UgaWYgKGNzaSA9PSAzICYmIGMgPT0gJ1xceDFiJykgY3NpID0gNDtcclxuXHRcdGVsc2UgaWYgKGNzaSA9PSA0ICYmIGMgPT0gJ1snKSBjc2kgPSAyO1xyXG5cdFx0ZWxzZSBpZiAoY3NpID4gMSAmJiAhL14oW1xcZCw7Ol0rKSQvLnRlc3QoYykpIHtcclxuXHRcdFx0Y3NpZHhbMV0gPSBpZHggLSAxO1xyXG5cdFx0XHRcclxuXHRcdFx0aWYgKGNzaSAhPSAyKSB7XHJcblx0XHRcdFx0Y29uc3QgbmNsbjogc3RyaW5nID0gcHJvYyhjbG4sIC4uLmNzaWR4KTtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRpZiAoY2xuICE9IG5jbG4pIGlkeCA9IDA7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0Y2xuID0gbmNsbjtcclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0Y3NpID0gMDtcclxuXHRcdFx0Y3NpZHggPSBbLTEsIC0xXTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0aWR4Kys7XHJcblx0fSB3aGlsZShpZHggPD0gY2xuLmxlbmd0aCk7XHJcblx0XHJcblx0cmV0dXJuIGNsbjtcclxufSAvL2NzaW1lcmdlclxyXG5cclxuZXhwb3J0IG1vZHVsZSBSR0xNIHtcclxuXHRcclxuXHRleHBvcnQgdHlwZSBCdWY4ID0gQnVmZmVyICYgeyBsZW5ndGg6IDggfTtcclxuXHRleHBvcnQgdHlwZSBCdWY0ID0gQnVmZmVyICYgeyBsZW5ndGg6IDQgfTtcclxuXHRleHBvcnQgdHlwZSBCdWYyID0gQnVmZmVyICYgeyBsZW5ndGg6IDIgfTtcclxuXHRcclxuXHQvKipcclxuXHQgKiBSR0xNIE1hZ2ljXHJcblx0ICovXHJcblx0ZXhwb3J0IGNvbnN0IE1BR0lDOiBSZWFkb25seTxCdWY0PiA9IEJ1ZmZlci5mcm9tKFwiUkdMXFwwXCIsIFwiYXNjaWlcIikgYXMgQnVmNDtcclxuXHRcclxuXHRleHBvcnQgY2xhc3MgUkdMTUNodW5rIHtcclxuXHRcdFxyXG5cdFx0c3RhdGljICNpZGNudHI6IG51bWJlciA9IDA7XHJcblx0XHRcclxuXHRcdC8qKlxyXG5cdFx0ICogRm9ybWF0dGluZyBtYXBwaW5ncywgc2V0IGJ5IHBhcmVudCBtb2R1bGVcclxuXHRcdCAqL1xyXG5cdFx0c3RhdGljIG1hcHBpbmdzOiB7XHJcblx0XHRcdGZnOlx0XHQoKHM6IHN0cmluZykgPT4gc3RyaW5nKVtdO1xyXG5cdFx0XHRiZzpcdFx0KChzOiBzdHJpbmcpID0+IHN0cmluZylbXTtcclxuXHRcdFx0c3Q6XHRcdCgoczogc3RyaW5nKSA9PiBzdHJpbmcpW107XHJcblx0XHRcdGN1c3Q6XHQoKHM6IHN0cmluZykgPT4gc3RyaW5nKVtdO1xyXG5cdFx0fSA9IHtcclxuXHRcdFx0Zmc6IFtdLFxyXG5cdFx0XHRiZzogW10sXHJcblx0XHRcdHN0OiBbXSxcclxuXHRcdFx0Y3VzdDogW10sXHJcblx0XHR9O1xyXG5cdFx0XHJcblx0XHQvKipcclxuXHRcdCAqIENodW5rIHVuaXF1ZSBpZFxyXG5cdFx0ICovXHJcblx0XHRfaWQ6IG51bWJlciA9IFJHTE1DaHVuay4jaWRjbnRyKys7XHJcblx0XHRvbnJlbmRlcjogKC4uLmRhdGE6IGFueVtdKSA9PiBzdHJpbmcgPSAoaWR4OiBudW1iZXIsIGM6IHRoaXMsIHBhcjogUkdMTS5SR0xNYXApID0+IHRoaXMucHJpbnQ7XHJcblx0XHRcclxuXHRcdGNvbnN0cnVjdG9yKHB1YmxpYyBjaHI6IHN0cmluZywgcHVibGljIGZnOiBudW1iZXIsIHB1YmxpYyBiZzogbnVtYmVyLCBwdWJsaWMgc3Q6IG51bWJlciwgcHVibGljIGN1c3Q6IG51bWJlcikge1xyXG5cdFx0XHRhc3NlcnQub2sodHlwZW9mIGNociA9PSBcInN0cmluZ1wiLCBcIkJhZCBDaHVua1wiKTtcclxuXHRcdFx0XHJcblx0XHRcdHRoaXMuY2hyID0gY2hyLnJlcGxhY2VBbGwoJ1xceDAwJywgJycpO1xyXG5cdFx0XHRcclxuXHRcdFx0YXNzZXJ0Lm9rKFxyXG5cdFx0XHRcdHRoaXMuY2hyLmxlbmd0aCA8PSAxICYmXHJcblx0XHRcdFx0QnVmZmVyLmZyb20odGhpcy5jaHIsIFwiYXNjaWlcIikubGVuZ3RoIDw9IDQgJiZcclxuXHRcdFx0XHRmZyA+PSAwICYmIGZnIDw9IDB4ZmYgJiZcclxuXHRcdFx0XHRiZyA+PSAwICYmIGJnIDw9IDB4ZmYgJiZcclxuXHRcdFx0XHRzdCA+PSAwICYmIHN0IDw9IDB4ZmYgJiZcclxuXHRcdFx0XHRjdXN0ID49IDAgJiYgY3VzdCA8PSAweGZmLFxyXG5cdFx0XHRcIkJhZCBDaHVua1wiKTtcclxuXHRcdH0gLy9jdG9yXHJcblx0XHRcclxuXHRcdC8qKlxyXG5cdFx0ICogUmVwYWNrIGludG8gQnVmOFxyXG5cdFx0ICovXHJcblx0XHRnZXQgcGFjaygpOiBCdWY4IHtcclxuXHRcdFx0Y29uc3QgY2hyOiBCdWY0ID0gQnVmZmVyLmFsbG9jKDQpIGFzIEJ1ZjQ7XHJcblx0XHRcdFxyXG5cdFx0XHRjaHIud3JpdGUodGhpcy5jaHIpO1xyXG5cdFx0XHRcclxuXHRcdFx0cmV0dXJuIEJ1ZmZlci5jb25jYXQoW2NociwgQnVmZmVyLmZyb20oW3RoaXMuZmcsIHRoaXMuYmcsIHRoaXMuc3QsIHRoaXMuY3VzdF0pXSwgOCkgYXMgQnVmODtcclxuXHRcdH0gLy9nLXBhY2tcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBDcmFmdCBpbnZhbGlkL2JsYW5rIGVuZGVyIENodW5rXHJcblx0XHQgKi9cclxuXHRcdHN0YXRpYyBibGFuaygpOiBSR0xNQ2h1bmsge1xyXG5cdFx0XHRyZXR1cm4gbmV3IFJHTE1DaHVuaygnJywgMHhmZiwgMHhmZiwgMHhmZiwgMHhmZik7XHJcblx0XHR9IC8vYmxhbmtcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBCdWY4IC0+IENodW5rXHJcblx0XHQgKi9cclxuXHRcdHN0YXRpYyBwYXJzZShidWY6IFJlYWRvbmx5PEJ1Zjg+KTogUkdMTUNodW5rIHtcclxuXHRcdFx0cmV0dXJuIG5ldyBSR0xNQ2h1bmsoYnVmLnNsaWNlKDAsIDQpLnRvU3RyaW5nKCksIGJ1Zls0XSwgYnVmWzVdLCBidWZbNl0sIGJ1Zls3XSk7XHJcblx0XHR9IC8vcGFyc2VcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBDaHVuayBzdHJpbmcgcmVwcmVzZW50YXRpb25cclxuXHRcdCAqL1xyXG5cdFx0Z2V0IHByaW50KCk6IHN0cmluZyB7XHJcblx0XHRcdGNvbnN0IGZnOlx0KHM6IHN0cmluZykgPT4gc3RyaW5nID0gUkdMTUNodW5rLm1hcHBpbmdzLmZnW3RoaXMuZmddXHRcdD8/ICgoczogc3RyaW5nKTogc3RyaW5nID0+IHMpLFxyXG5cdFx0XHRcdGJnOlx0XHQoczogc3RyaW5nKSA9PiBzdHJpbmcgPSBSR0xNQ2h1bmsubWFwcGluZ3MuYmdbdGhpcy5iZ11cdFx0Pz8gKChzOiBzdHJpbmcpOiBzdHJpbmcgPT4gcyksXHJcblx0XHRcdFx0c3Q6XHRcdChzOiBzdHJpbmcpID0+IHN0cmluZyA9IFJHTE1DaHVuay5tYXBwaW5ncy5zdFt0aGlzLnN0XVx0XHQ/PyAoKHM6IHN0cmluZyk6IHN0cmluZyA9PiBzKSxcclxuXHRcdFx0XHRjdXN0Olx0KHM6IHN0cmluZykgPT4gc3RyaW5nID0gUkdMTUNodW5rLm1hcHBpbmdzLmN1c3RbdGhpcy5jdXN0XVx0Pz8gKChzOiBzdHJpbmcpOiBzdHJpbmcgPT4gcyk7XHJcblx0XHRcdFxyXG5cdFx0XHRyZXR1cm4gY3NpbWVyZ2VyKGN1c3Qoc3QoZmcoYmcodGhpcy5jaHIgPz8gJyAnKSkpKSk7XHJcblx0XHR9IC8vZy1wcmludFxyXG5cdFx0XHJcblx0fSAvL1JHTE1DaHVua1xyXG5cclxuXHRleHBvcnQgY2xhc3MgUkdMTWFwIHtcclxuXHRcdHN0YXRpYyBSR0xNQ2h1bms6IHR5cGVvZiBSR0xNQ2h1bmsgPSBSR0xNQ2h1bms7XHJcblx0XHRcclxuXHRcdC8qKlxyXG5cdFx0ICogTWFwIENodW5rc1xyXG5cdFx0ICovXHJcblx0XHRjaHVua3M6IFJHTE1DaHVua1tdID0gWyBdO1xyXG5cdFx0X2xvYWRlZEZyb206IHN0cmluZyA9IFwiXCI7XHJcblx0XHRtZXRhOiB7XHJcblx0XHRcdFtrZXk6IHN0cmluZ106IHN0cmluZztcclxuXHRcdH0gPSB7IH07XHJcblx0XHRcclxuXHRcdGNvbnN0cnVjdG9yKHB1YmxpYyBkaW1lbnM6IFtudW1iZXIsIG51bWJlcl0gPSBbIDAsIDAgXSwgcHVibGljIHBhcmVudDogcmdsLnJnbC5SR0wsIHB1YmxpYyBzY3JvbGw6IFtudW1iZXIsIG51bWJlcl0gPSBbIDAsIDAgXSkge1xyXG5cdFx0XHRhc3NlcnQub2soZGltZW5zIGluc3RhbmNlb2YgQXJyYXkgJiYgZGltZW5zLmxlbmd0aCA9PSAyICYmIGRpbWVucy5ldmVyeShkID0+IGQgPj0gMCkgJiZcclxuXHRcdFx0XHRzY3JvbGwgaW5zdGFuY2VvZiBBcnJheSAmJiBzY3JvbGwubGVuZ3RoID09IDIgJiYgcGFyZW50LCBcIkJhZCBNYXBcIik7XHJcblx0XHRcdFxyXG5cdFx0XHR0aGlzLmRpbWVucyA9IGRpbWVucy5tYXAoZCA9PiBOdW1iZXIoZCkpIGFzIFtudW1iZXIsIG51bWJlcl07XHJcblx0XHRcdHRoaXMuc2Nyb2xsID0gc2Nyb2xsLm1hcChkID0+IE51bWJlcihkKSkgYXMgW251bWJlciwgbnVtYmVyXTtcclxuXHRcdH0gLy9jdG9yXHJcblx0XHRcclxuXHRcdC8qKlxyXG5cdFx0ICogQ3JlYXRlIGVtcHR5L2JsYW5rIE1hcFxyXG5cdFx0ICovXHJcblx0XHRzdGF0aWMgYmxhbmsocGFyOiByZ2wucmdsLlJHTCkge1xyXG5cdFx0XHRyZXR1cm4gbmV3IFJHTE0uUkdMTWFwKFsgMCwgMCBdLCBwYXIpO1xyXG5cdFx0fSAvL2JsYW5rXHJcblx0XHRcclxuXHRcdC8qKlxyXG5cdFx0ICogQ3JhZnQgTWFwIGZyb20gZnNcclxuXHRcdCAqL1xyXG5cdFx0c3RhdGljIGFzeW5jIHBhcnNlKGZyb206IHN0cmluZywgcGFyOiByZ2wucmdsLlJHTCk6IFByb21pc2U8UkdMTWFwPiB7XHJcblx0XHRcdGFzc2VydC5vayhmcm9tLCBcIidmcm9tJyBtdXN0IGJlIHByb3ZpZGVkXCIpO1xyXG5cdFx0XHRcclxuXHRcdFx0ZnJvbSA9IHBhdGgucmVzb2x2ZShmcm9tKTtcclxuXHRcdFx0Y29uc3QgZGF0OiBCdWZmZXIgPSBhd2FpdCBmcy5wcm9taXNlcy5yZWFkRmlsZShmcm9tLCB7XHJcblx0XHRcdFx0ZmxhZzogXCJyXCJcclxuXHRcdFx0fSksXHJcblx0XHRcdGVuZDogQnVmOCA9IEJ1ZmZlci5mcm9tKFwiRkZGRkZGRkZGRkZGRkZGRlwiLCBcImhleFwiKSBhcyBCdWY4O1xyXG5cdFx0XHRcclxuXHRcdFx0YXNzZXJ0Lm9rKGRhdC5sZW5ndGggPj0gOCAmJiAhZGF0LnNsaWNlKDAsIDQpLmNvbXBhcmUoQnVmZmVyLmZyb20oXCJSR0xcXDBcIiwgXCJhc2NpaVwiKSksIFwiQnJva2VuIFJHTE1cIik7XHJcblx0XHRcdFxyXG5cdFx0XHRsZXQgbWFwID0gbmV3IFJHTE1hcChbZGF0LnNsaWNlKDQsIDYpLnJlYWRVSW50MTZMRSgpLCBkYXQuc2xpY2UoNiwgOCkucmVhZFVJbnQxNkxFKCldLCBwYXIpLFxyXG5cdFx0XHRcdGNoazogcmdsLk51bGxhYmxlPEJ1Zjg+ID0gbnVsbCxcclxuXHRcdFx0XHRpOiBudW1iZXIgPSA4LFxyXG5cdFx0XHRcdHBhc3Npbmc6IGJvb2xlYW4gPSB0cnVlO1xyXG5cdFx0XHRcclxuXHRcdFx0bWFwLl9sb2FkZWRGcm9tID0gZnJvbTtcclxuXHRcdFx0XHJcblx0XHRcdGlmIChkYXQubGVuZ3RoID4gOCkge1xyXG5cdFx0XHRcdGRvIHtcclxuXHRcdFx0XHRcdGlmIChpICsgOCA+IGRhdC5sZW5ndGgpIHRocm93IFwiQnJva2VuIFJHTE1cIjtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0Y2hrID0gZGF0LnNsaWNlKGksIGkgKz0gOCkgYXMgQnVmODtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0aWYgKGNoay5jb21wYXJlKGVuZCkpIHtcclxuXHRcdFx0XHRcdFx0bWFwLmNodW5rcy5wdXNoKFJHTE1hcC5SR0xNQ2h1bmsucGFyc2UoY2hrKSk7XHJcblx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRpZiAoaSA9PSBkYXQubGVuZ3RoKSBicmVhaztcclxuXHRcdFx0XHRcdH0gZWxzZSBwYXNzaW5nID0gZmFsc2U7XHJcblx0XHRcdFx0fSB3aGlsZShwYXNzaW5nKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0aWYgKGNoayAmJiAhY2hrLmNvbXBhcmUoZW5kKSkge1xyXG5cdFx0XHRcdGNvbnN0IG1ldGE6IHN0cmluZ1tdID0gZGF0LnNsaWNlKGkpLnRvU3RyaW5nKFwidXRmOFwiKS5zcGxpdCgnJicpO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGZvciAoY29uc3QgbWV0IG9mIG1ldGEpIHtcclxuXHRcdFx0XHRcdGNvbnN0IHBhaXI6IFtzdHJpbmcsIHN0cmluZ10gfCBbc3RyaW5nXSA9IG1ldC5zcGxpdCgnPScpIGFzIFtzdHJpbmcsIHN0cmluZ10gfCBbc3RyaW5nXTtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0bWFwLm1ldGFbcGFpclswXV0gPSBwYWlyWzFdID8/ICcnO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0cmV0dXJuIG1hcDtcclxuXHRcdH0gLy9wYXJzZVxyXG5cdFx0XHJcblx0XHQvKipcclxuXHRcdCAqIChSZSlzdG9yZSBNYXAgdG8gZnNcclxuXHRcdCAqL1xyXG5cdFx0YXN5bmMgc3RvcmUodG86IHN0cmluZyA9IHRoaXMuX2xvYWRlZEZyb20pIHtcclxuXHRcdFx0YXNzZXJ0Lm9rKHRvICYmIHR5cGVvZiB0byA9PSBcInN0cmluZ1wiLCBcIidkZXN0aW5hdGlvbicgbXVzdCBiZSBhIHZhbGlkIHBhdGhcIik7XHJcblx0XHRcdFxyXG5cdFx0XHRyZXR1cm4gYXdhaXQgZnMucHJvbWlzZXMud3JpdGVGaWxlKHRvLCB0aGlzLnBhY2ssIHtcclxuXHRcdFx0XHRlbmNvZGluZzogXCJiaW5hcnlcIixcclxuXHRcdFx0XHRmbGFnOiBcIndcIixcclxuXHRcdFx0XHRtb2RlOiAwbzc3NVxyXG5cdFx0XHR9KTtcclxuXHRcdH0gLy9zdG9yZVxyXG5cdFx0XHJcblx0XHQvKipcclxuXHRcdCAqIE1hcCAtPiBCdWZmXHJcblx0XHQgKi9cclxuXHRcdGdldCBwYWNrKCk6IEJ1ZmZlciB7XHJcblx0XHRcdGNvbnN0IGRpbWVuczogW0J1ZjIsIEJ1ZjJdID0gW1xyXG5cdFx0XHRcdEJ1ZmZlci5hbGxvY1Vuc2FmZSgyKSBhcyBCdWYyLFxyXG5cdFx0XHRcdEJ1ZmZlci5hbGxvY1Vuc2FmZSgyKSBhcyBCdWYyLFxyXG5cdFx0XHRdO1xyXG5cdFx0XHRsZXQgbWV0YTogQnVmZmVyID0gQnVmZmVyLmZyb20oT2JqZWN0LmVudHJpZXModGhpcy5tZXRhKS5tYXAoZSA9PiBlLmpvaW4oJz0nKSkuam9pbignJicpLCBcInV0ZjhcIik7XHJcblx0XHRcdFxyXG5cdFx0XHRkaW1lbnNbMF0ud3JpdGVVSW50MTZMRSh0aGlzLmRpbWVuc1swXSk7XHJcblx0XHRcdGRpbWVuc1sxXS53cml0ZVVJbnQxNkxFKHRoaXMuZGltZW5zWzFdKTtcclxuXHRcdFx0XHJcblx0XHRcdGlmIChtZXRhLmxlbmd0aCkgbWV0YSA9IEJ1ZmZlci5jb25jYXQoW0J1ZmZlci5mcm9tKFwiRkZGRkZGRkZGRkZGRkZGRlwiLCBcImhleFwiKSwgbWV0YV0pO1xyXG5cdFx0XHRcclxuXHRcdFx0cmV0dXJuIEJ1ZmZlci5jb25jYXQoW1JHTE0uTUFHSUMsIC4uLmRpbWVucywgLi4udGhpcy5jaHVua3MubWFwKGMgPT4gYy5wYWNrKSwgbWV0YV0sICh0aGlzLmNodW5rcy5sZW5ndGggKyAxKSAqIDggKyBtZXRhLmxlbmd0aCk7XHJcblx0XHR9IC8vZy1wYWNrXHJcblx0XHRcclxuXHRcdC8qKlxyXG5cdFx0ICogU3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIE1hcCdzIENodW5rc1xyXG5cdFx0ICovXHJcblx0XHRnZXQgcHJpbnQoKTogc3RyaW5nIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuY2h1bmtzLm1hcChjID0+IGMucHJpbnQpLmpvaW4oJycpO1xyXG5cdFx0fSAvL2ctcHJpbnRcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBDYWxjdWxhdGUgVmlld3BvcnQgY29vcmRpbmF0ZXMgZnJvbSBjaHVua2xpc3QgaW5kZXhcclxuXHRcdCAqL1xyXG5cdFx0Y2FsY0Noa0lkeCh4OiBudW1iZXIgfCBSR0xNQ2h1bmssIHk6IG51bWJlciA9IDApOiBudW1iZXIge1xyXG5cdFx0XHRpZiAoeCBpbnN0YW5jZW9mIFJHTE1DaHVuaykgcmV0dXJuIHRoaXMuY2h1bmtzLmZpbmRJbmRleChjID0+IGMgPT0geCk7XHJcblx0XHRcdFxyXG5cdFx0XHRhc3NlcnQub2soeCA+PSAwLCBcIkJhZCBpZHhcIik7XHJcblx0XHRcdFxyXG5cdFx0XHRyZXR1cm4gdGhpcy5kaW1lbnNbMF0gKiB5ISArIHg7XHJcblx0XHR9IC8vY2FsY0Noa0lkeFxyXG5cdFx0LyoqXHJcblx0XHQgKiBDYWxjdWxhdGUgY2h1bmtsaXN0IGluZGV4IGZyb20gVmlld3BvcnQgY29vcmRpbmF0ZXNcclxuXHRcdCAqL1xyXG5cdFx0Y2FsY0Noa0NyZChpZHg6IG51bWJlciB8IFJHTE1DaHVuayk6IFtudW1iZXIsIG51bWJlcl0ge1xyXG5cdFx0XHRpZiAoaWR4IGluc3RhbmNlb2YgUkdMTUNodW5rKSBpZHggPSB0aGlzLmNodW5rcy5maW5kSW5kZXgoYyA9PiBjID09IGlkeCk7XHJcblx0XHRcdFxyXG5cdFx0XHRhc3NlcnQub2soaWR4ID49IDAsIFwiQmFkIGlkeFwiKTtcclxuXHRcdFx0XHJcblx0XHRcdHJldHVybiBbXHJcblx0XHRcdFx0aWR4ICUgdGhpcy5kaW1lbnNbMF0sXHJcblx0XHRcdFx0TWF0aC5mbG9vcihpZHggLyB0aGlzLmRpbWVuc1swXSlcclxuXHRcdFx0XTtcclxuXHRcdH0gLy9jYWxjQ2hrQ3JkXHJcblx0XHQvKipcclxuXHRcdCAqIEdldCBhIENodW5rXHJcblx0XHQgKi9cclxuXHRcdGdldChuOiBudW1iZXIgfCBSR0xNQ2h1bmssIHg/OiBudW1iZXIpOiBSR0xNQ2h1bmsge1xyXG5cdFx0XHRpZiAobiBpbnN0YW5jZW9mIFJHTE1DaHVuaykgcmV0dXJuIHRoaXMuY2h1bmtzW3RoaXMuY2FsY0Noa0lkeChuKV07XHJcblx0XHRcdGVsc2UgaWYgKHR5cGVvZiB4ID09IFwidW5kZWZpbmVkXCIpIHJldHVybiB0aGlzLmNodW5rc1tuXTtcclxuXHRcdFx0ZWxzZSByZXR1cm4gdGhpcy5jaHVua3NbdGhpcy5jYWxjQ2hrSWR4KG4sIHgpXTtcclxuXHRcdH0gLy9nZXRcclxuXHRcdC8qKlxyXG5cdFx0ICogUGxhY2UgYSBDaHVua1xyXG5cdFx0ICovXHJcblx0XHRwbGFjZShjOiBSR0xNQ2h1bmtbXSwgbjogbnVtYmVyIHwgUkdMTUNodW5rID0gdGhpcy5jaHVua3MubGVuZ3RoLCB4PzogbnVtYmVyLCByZXBsOiBudW1iZXIgPSAxKSB7XHJcblx0XHRcdGNvbnN0IGlkeDogbnVtYmVyID0gdHlwZW9mIHggPT0gXCJ1bmRlZmluZWRcIiA/IChuIGluc3RhbmNlb2YgUkdMTUNodW5rID8gdGhpcy5jYWxjQ2hrSWR4KG4pIDogbikgOiB0aGlzLmNhbGNDaGtJZHgobiwgeCk7XHJcblx0XHRcdFxyXG5cdFx0XHRhc3NlcnQub2soaWR4ID49IDAsIFwiQmFkIGlkeFwiKTtcclxuXHRcdFx0XHJcblx0XHRcdHJldHVybiB0aGlzLmNodW5rcy5zcGxpY2UoaWR4LCByZXBsLCAuLi5jKTtcclxuXHRcdH0gLy9wbGFjZVxyXG5cdFx0LyoqXHJcblx0XHQgKiBTd2FwIENodW5rcyBsb2NhdGlvbnNcclxuXHRcdCAqL1xyXG5cdFx0c3dhcChjMTogUkdMTUNodW5rLCBjMjogUkdMTUNodW5rKTogdGhpcyB7XHJcblx0XHRcdGlmIChjMSA9PSBjMikgcmV0dXJuIHRoaXM7XHJcblx0XHRcdFxyXG5cdFx0XHRjb25zdCBjaTE6IG51bWJlciA9IHRoaXMuY2FsY0Noa0lkeChjMSk7XHJcblx0XHRcdGFzc2VydC5vayhjaTEgPj0gMCwgXCJCYWQgaWR4XCIpO1xyXG5cdFx0XHRjb25zdCBjYzE6IFJHTE1DaHVuayA9IHRoaXMuY2h1bmtzLnNwbGljZShjaTEsIDEpWzBdO1xyXG5cdFx0XHRcclxuXHRcdFx0Y29uc3QgY2kyOiBudW1iZXIgPSB0aGlzLmNhbGNDaGtJZHgoYzIpO1xyXG5cdFx0XHRhc3NlcnQub2soY2kyID49IDAsIFwiQmFkIGlkeFwiKTtcclxuXHRcdFx0Y29uc3QgY2MyOiBSR0xNQ2h1bmsgPSB0aGlzLmNodW5rcy5zcGxpY2UoY2kyLCAxLCBjYzEpWzBdO1xyXG5cdFx0XHRcclxuXHRcdFx0dGhpcy5jaHVua3Muc3BsaWNlKGNpMSwgMCwgY2MyKTtcclxuXHRcdFx0XHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSAvL3N3YXBcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBDaGVjayBpZiBDaHVuayBpcyBpbnNpZGUgYm91bmRzXHJcblx0XHQgKiBcclxuXHRcdCAqIHQqIC0gY2h1bmsgdGFyZ2V0XHJcblx0XHQgKiBkKiAtIHZpZXdwb3J0IHNpemVcclxuXHRcdCAqIHMqIC0gdmlld3BvcnQgc2Nyb2xsXHJcblx0XHQgKiAqIC0gdmlld3BvcnRcclxuXHRcdCAqL1xyXG5cdFx0aXNJbih0eDogbnVtYmVyLCB0eT86IG51bWJlciwgeDogbnVtYmVyID0gMCwgeTogbnVtYmVyID0gMCwgc3g6IG51bWJlciA9IHRoaXMuc2Nyb2xsWzBdLCBzeTogbnVtYmVyID0gdGhpcy5zY3JvbGxbMV0sIGR4OiBudW1iZXIgPSB0aGlzLmRpbWVuc1swXSwgZHk6IG51bWJlciA9IHRoaXMuZGltZW5zWzFdKTogYm9vbGVhbiB7XHJcblx0XHRcdGlmICh0eXBlb2YgdHkgPT0gXCJ1bmRlZmluZWRcIikgKFt0eCwgdHldID0gdGhpcy5jYWxjQ2hrQ3JkKHR4KSk7XHJcblx0XHRcdFxyXG5cdFx0XHRjb25zdCByeDogbnVtYmVyID0gdHggLSBzeCxcclxuXHRcdFx0XHRyeTogbnVtYmVyID0gdHkgLSBzeTtcclxuXHRcdFx0XHJcblx0XHRcdHJldHVybiByeCA+PSB4ICYmIHJ4IDwgZHggJiYgcnkgPj0geSAmJiByeSA8IGR5O1xyXG5cdFx0fSAvL2lzSW5cclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBJbXByaW50IE1hcCBvbiBSR0xcclxuXHRcdCAqL1xyXG5cdFx0YXN5bmMgc3RhbXAoZHg6IG51bWJlciA9IHRoaXMuZGltZW5zWzBdLCBkeTogbnVtYmVyID0gdGhpcy5kaW1lbnNbMV0sIHg6IG51bWJlciA9IDAsIHk6IG51bWJlciA9IDAsIHN4OiBudW1iZXIgPSB0aGlzLnNjcm9sbFswXSwgc3k6IG51bWJlciA9IHRoaXMuc2Nyb2xsWzFdLCBwYXI6IHJnbC5yZ2wuUkdMID0gdGhpcy5wYXJlbnQpOiBQcm9taXNlPHRoaXM+IHtcclxuXHRcdFx0YXNzZXJ0Lm9rKHBhciwgXCJCYWQgcGFyZW50XCIpO1xyXG5cdFx0XHRcclxuXHRcdFx0Y29uc3Qgc2F2OiBbbnVtYmVyLCBudW1iZXJdID0gWy4uLnBhci5jdXJzb3JdO1xyXG5cdFx0XHRcclxuXHRcdFx0Zm9yIChsZXQgaWR4OiBudW1iZXIgPSAwOyBpZHggPCB0aGlzLmNodW5rcy5sZW5ndGg7IGlkeCsrKSB7XHJcblx0XHRcdFx0Y29uc3QgYzogUkdMTS5SR0xNQ2h1bmsgPSB0aGlzLmNodW5rc1tpZHhdO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGlmICh0aGlzLmlzSW4oaWR4LCB1bmRlZmluZWQsIHgsIHksIHN4LCBzeSwgZHgsIGR5KSkge1xyXG5cdFx0XHRcdFx0YXdhaXQgcGFyLm1vdmUoLi4uKHRoaXMuY2FsY0Noa0NyZChpZHgpLm1hcCgoYzogbnVtYmVyLCBpZHg6IG51bWJlcik6IG51bWJlciA9PiBjICsgW3N4LCBzeV1baWR4XSkpIGFzIFtudW1iZXIsIG51bWJlcl0pO1xyXG5cdFx0XHRcdFx0cGFyLndyaXRlKGMub25yZW5kZXIoaWR4LCBjLCB0aGlzKSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHRhd2FpdCBwYXIubW92ZSguLi5zYXYpO1xyXG5cdFx0XHRcclxuXHRcdFx0cmV0dXJuIHRoaXM7XHJcblx0XHR9IC8vc3RhbXBcclxuXHRcdFxyXG5cdFx0KltTeW1ib2wuaXRlcmF0b3JdKCk6IEdlbmVyYXRvcjxSR0xNQ2h1bmssIHZvaWQsIFJHTE1DaHVuaz4ge1xyXG5cdFx0XHRmb3IgKGNvbnN0IGMgb2YgdGhpcy5jaHVua3MpXHJcblx0XHRcdFx0eWllbGQgYztcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0Z2V0IFtTeW1ib2wuaXNDb25jYXRTcHJlYWRhYmxlXSgpOiBib29sZWFuIHtcclxuXHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGdldCBbU3ltYm9sLnRvU3RyaW5nVGFnXSgpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMudG9TdHJpbmcoKTtcclxuXHRcdH1cclxuXHRcdHRvU3RyaW5nKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5wcmludDtcclxuXHRcdH0gLy90b1N0cmluZ1xyXG5cdFx0XHJcblx0fSAvL1JHTE1hcFxyXG5cdFxyXG59IC8vUkdMTVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUkdMTTtcclxuIl19