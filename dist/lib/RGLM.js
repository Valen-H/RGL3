/// <reference path="./rgl">
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RGLM = exports.csimerger = exports.CSI = void 0;
const tslib_1 = require("tslib");
const assert = tslib_1.__importStar(require("assert"));
const fs = tslib_1.__importStar(require("fs-extra"));
const path = tslib_1.__importStar(require("path"));
const events = tslib_1.__importStar(require("events"));
exports.CSI = "\x1b[";
/**
 * Merge polluted ANSI
 */
function csimerger(str) {
    let idx = 0, //runner
    csi = 0, //csidx valid at 2
    csidx = [-1, -1]; //first csi
    function proc(str, i1, i2) {
        let s = str.slice(i1, i2);
        if (!s.endsWith('m')) {
            s += 'm';
            i2++;
        }
        s = s.replaceAll(/m\x1b\[/g, ';');
        return [str.slice(0, i1) + s + str.slice(i2), i1 + s.length];
    } //proc
    if (!str)
        return str;
    let cln = str;
    do {
        const c = cln[idx] || '';
        if (!csi && c == '\x1b') {
            csi = 1;
            csidx[0] = idx;
        }
        else if (csi == 1 && c == '[')
            csi = 2;
        else if (csi == 1)
            csi = 0;
        else if (csi == 2 && c == 'm')
            csi = 3;
        else if (csi == 3 && c == '\x1b')
            csi = 4;
        else if (csi == 4 && c == '[')
            csi = 2;
        else if (csi > 1 && !/^([\d;]+)$/.test(c)) {
            csidx[1] = idx - 1;
            if (csi != 2) {
                const [ncln, l] = proc(cln, ...csidx);
                if (cln != ncln)
                    idx = l;
                cln = ncln;
            }
            csi = 0;
            csidx = [-1, -1];
        }
        idx++;
    } while (idx <= cln.length);
    return cln;
} //csimerger
exports.csimerger = csimerger;
var RGLM;
(function (RGLM) {
    function stubmap(text, ...data) {
        return text.split('').map((c) => new RGLMChunk(c, data.shift() ?? 0xff, data.shift() ?? 0xff, data.shift() ?? 0xff, data.shift() ?? 0xff));
    } //stubmap
    RGLM.stubmap = stubmap;
    /**
     * RGLM Magic
     */
    RGLM.MAGIC = Buffer.from("RGL\0", "ascii");
    class RGLMChunk extends events.EventEmitter {
        chr;
        fg;
        bg;
        st;
        cust;
        static #idcntr = 0;
        /**
         * Formatting mappings, set by parent module
         */
        static mappings = {
            fg: [],
            bg: [],
            st: [],
            cust: [],
        };
        /**
         * Chunk unique id
         */
        _id = RGLMChunk.#idcntr++;
        onrender = (idx, c, par) => this.print;
        constructor(chr, fg, bg, st, cust) {
            assert.ok(typeof chr == "string", "Bad Chunk");
            super();
            this.chr = chr;
            this.fg = fg;
            this.bg = bg;
            this.st = st;
            this.cust = cust;
            this.chr = chr.replaceAll('\x00', '');
            assert.ok(this.chr.length <= 1 &&
                Buffer.from(this.chr, "ascii").length <= 4 &&
                fg >= 0 && fg <= 0xff &&
                bg >= 0 && bg <= 0xff &&
                st >= 0 && st <= 0xff &&
                cust >= 0 && cust <= 0xff, "Bad Chunk");
        } //ctor
        /**
         * Repack into Buf8
         */
        get pack() {
            const chr = Buffer.alloc(4);
            chr.write(this.chr);
            return Buffer.concat([chr, Buffer.from([this.fg, this.bg, this.st, this.cust])], 8);
        } //g-pack
        /**
         * Craft invalid/blank ender Chunk
         */
        static blank() {
            return new RGLMChunk('', 0xff, 0xff, 0xff, 0xff);
        } //blank
        /**
         * Buf8 -> Chunk
         */
        static parse(buf) {
            return new RGLMChunk(buf.slice(0, 4).toString(), buf[4], buf[5], buf[6], buf[7]);
        } //parse
        /**
         * Chunk string representation
         */
        get print() {
            const fg = RGLMChunk.mappings.fg[this.cust == 0xff ? 0xff : this.fg] ?? ((s) => s), bg = RGLMChunk.mappings.bg[this.cust == 0xff ? 0xff : this.bg] ?? ((s) => s), st = RGLMChunk.mappings.st[this.cust == 0xff ? 0xff : this.st] ?? ((s) => s), cust = RGLMChunk.mappings.cust[this.cust] ?? ((s) => s);
            return csimerger(cust(st(fg(bg(this.chr ?? ' ', this.bg, this), this.fg, this), this.st, this), this.cust, this));
        } //g-print
    } //RGLMChunk
    RGLM.RGLMChunk = RGLMChunk;
    class RGLMap extends events.EventEmitter {
        dimens;
        parent;
        scroll;
        static RGLMChunk = RGLMChunk;
        /**
         * Map Chunks
         */
        chunks = [];
        _loadedFrom = "";
        meta = {};
        constructor(dimens = [0, 0], parent, scroll = [0, 0]) {
            assert.ok(dimens instanceof Array && dimens.length == 2 && dimens.every(d => d >= 0) &&
                scroll instanceof Array && scroll.length == 2 && parent, "Bad Map");
            super();
            this.dimens = dimens;
            this.parent = parent;
            this.scroll = scroll;
            this.dimens = dimens.map(d => Number(d));
            this.scroll = scroll.map(d => Number(d));
        } //ctor
        /**
         * Create empty/blank Map
         */
        static blank(par) {
            return new RGLM.RGLMap([0, 0], par);
        } //blank
        /**
         * Craft Map from fs
         */
        static async parse(from, par) {
            assert.ok(from, "'from' must be provided");
            from = path.resolve(from);
            const dat = await fs.promises.readFile(from, {
                flag: "r"
            }), end = Buffer.from("FFFFFFFFFFFFFFFF", "hex");
            assert.ok(dat.length >= 8 && !dat.slice(0, 4).compare(Buffer.from("RGL\0", "ascii")), "Broken RGLM");
            let map = new RGLMap([dat.slice(4, 6).readUInt16LE(), dat.slice(6, 8).readUInt16LE()], par), chk = null, i = 8, passing = true;
            map._loadedFrom = from;
            if (dat.length > 8) {
                do {
                    if (i + 8 > dat.length)
                        throw "Broken RGLM";
                    chk = dat.slice(i, i += 8);
                    if (chk.compare(end)) {
                        map.chunks.push(RGLMap.RGLMChunk.parse(chk));
                        if (i == dat.length)
                            break;
                    }
                    else
                        passing = false;
                } while (passing);
            }
            if (chk && !chk.compare(end)) {
                const meta = dat.slice(i).toString("utf8").split('&');
                for (const met of meta) {
                    const pair = met.split('=');
                    map.meta[pair[0]] = pair[1] ?? '';
                }
            }
            return map;
        } //parse
        /**
         * (Re)store Map to fs
         */
        async store(to = this._loadedFrom) {
            assert.ok(to && typeof to == "string", "'destination' must be a valid path");
            return await fs.promises.writeFile(to, this.pack, {
                encoding: "binary",
                flag: "w",
                mode: 0o775
            });
        } //store
        /**
         * Map -> Buff
         */
        get pack() {
            const dimens = [
                Buffer.allocUnsafe(2),
                Buffer.allocUnsafe(2),
            ];
            let meta = Buffer.from(Object.entries(this.meta).map(e => e.join('=')).join('&'), "utf8");
            dimens[0].writeUInt16LE(this.dimens[0]);
            dimens[1].writeUInt16LE(this.dimens[1]);
            if (meta.length)
                meta = Buffer.concat([Buffer.from("FFFFFFFFFFFFFFFF", "hex"), meta]);
            return Buffer.concat([RGLM.MAGIC, ...dimens, ...this.chunks.map(c => c.pack), meta], (this.chunks.length + 1) * 8 + meta.length);
        } //g-pack
        /**
         * String representation of Map's Chunks
         */
        get print() {
            return this.chunks.map(c => c.print).join('');
        } //g-print
        /**
         * Calculate Viewport coordinates from chunklist index
         */
        calcChkIdx(x, y = 0) {
            if (x instanceof RGLMChunk)
                return this.chunks.findIndex(c => c == x);
            assert.ok(x >= 0, "Bad idx");
            return this.dimens[0] * y + x;
        } //calcChkIdx
        /**
         * Calculate chunklist index from Viewport coordinates
         */
        calcChkCrd(idx) {
            if (idx instanceof RGLMChunk)
                idx = this.chunks.findIndex(c => c == idx);
            assert.ok(idx >= 0, "Bad idx");
            return [
                idx % this.dimens[0],
                Math.floor(idx / this.dimens[0])
            ];
        } //calcChkCrd
        /**
         * Get a Chunk
         */
        get(n, x) {
            if (n instanceof RGLMChunk)
                return this.chunks[this.calcChkIdx(n)];
            else if (typeof x == "undefined")
                return this.chunks[n];
            else
                return this.chunks[this.calcChkIdx(n, x)];
        } //get
        /**
         * Place a Chunk
         */
        place(c, n = this.chunks.length, x, repl = 1) {
            const idx = typeof x == "undefined" ? (n instanceof RGLMChunk ? this.calcChkIdx(n) : n) : this.calcChkIdx(n, x);
            assert.ok(idx >= 0, "Bad idx");
            return this.chunks.splice(idx, repl, ...c);
        } //place
        /**
         * Swap Chunks locations
         */
        swap(c1, c2) {
            if (c1 == c2)
                return this;
            const ci1 = this.calcChkIdx(c1);
            assert.ok(ci1 >= 0, "Bad idx");
            const cc1 = this.chunks.splice(ci1, 1)[0];
            const ci2 = this.calcChkIdx(c2);
            assert.ok(ci2 >= 0, "Bad idx");
            const cc2 = this.chunks.splice(ci2, 1, cc1)[0];
            this.chunks.splice(ci1, 0, cc2);
            return this;
        } //swap
        /**
         * Check if Chunk is inside bounds
         *
         * t* - chunk target
         * d* - viewport size
         * s* - viewport scroll
         * * - viewport
         */
        isIn(tx, ty, x = 0, y = 0, sx = this.scroll[0], sy = this.scroll[1], dx = this.dimens[0], dy = this.dimens[1]) {
            if (typeof ty == "undefined")
                ([tx, ty] = this.calcChkCrd(tx));
            const rx = tx + sx, ry = ty + sy;
            return rx >= x && rx < Math.min(dx, this.parent.sout.columns) && ry >= y && ry < Math.min(dy, this.parent.sout.rows);
        } //isIn
        /**
         * Imprint Map on RGL
         */
        async stamp(dx = this.dimens[0], dy = this.dimens[1], x = 0, y = 0, sx = this.scroll[0], sy = this.scroll[1], par = this.parent) {
            assert.ok(par, "Bad parent");
            const sav = [...par.cursor];
            for (let idx = 0; idx < this.chunks.length; idx++) {
                const c = this.chunks[idx];
                if (!c)
                    continue;
                if (this.isIn(idx, undefined, x, y, sx, sy, dx, dy)) {
                    await par.move(...(this.calcChkCrd(idx).map((c, idx) => c + [sx, sy][idx])));
                    par.write(c.onrender(idx, c, this));
                }
            }
            await par.move(...sav);
            return this;
        } //stamp
        *[Symbol.iterator]() {
            for (const c of this.chunks)
                yield c;
        }
        get [Symbol.isConcatSpreadable]() {
            return true;
        }
        get [Symbol.toStringTag]() {
            return this.toString();
        }
        toString() {
            return this.print;
        } //toString
    } //RGLMap
    RGLM.RGLMap = RGLMap;
})(RGLM = exports.RGLM || (exports.RGLM = {})); //RGLM
exports.default = RGLM;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUkdMTS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9SR0xNLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDRCQUE0QjtBQUU1QixZQUFZLENBQUM7Ozs7QUFFYix1REFBaUM7QUFDakMscURBQStCO0FBQy9CLG1EQUE2QjtBQUU3Qix1REFBaUM7QUFFcEIsUUFBQSxHQUFHLEdBQVksT0FBTyxDQUFDO0FBRXBDOztHQUVHO0FBQ0gsU0FBZ0IsU0FBUyxDQUFDLEdBQVc7SUFDcEMsSUFBSSxHQUFHLEdBQVcsQ0FBQyxFQUFFLFFBQVE7SUFDNUIsR0FBRyxHQUFXLENBQUMsRUFBRSxrQkFBa0I7SUFDbkMsS0FBSyxHQUFxQixDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXO0lBRWhELFNBQVMsSUFBSSxDQUFDLEdBQVcsRUFBRSxFQUFVLEVBQUUsRUFBVTtRQUNoRCxJQUFJLENBQUMsR0FBVyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVsQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUNyQixDQUFDLElBQUksR0FBRyxDQUFDO1lBQ1QsRUFBRSxFQUFFLENBQUM7U0FDTDtRQUVELENBQUMsR0FBRyxDQUFDLENBQUMsVUFBVSxDQUFDLFVBQVUsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUVsQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM5RCxDQUFDLENBQUMsTUFBTTtJQUVSLElBQUksQ0FBQyxHQUFHO1FBQUUsT0FBTyxHQUFHLENBQUM7SUFFckIsSUFBSSxHQUFHLEdBQUcsR0FBRyxDQUFDO0lBRWQs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Q0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFxQixDQUFDLENBQUM7b0JBQ3pILEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7aUJBQ3BDO2FBQ0Q7WUFFRCxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztZQUV2QixPQUFPLElBQUksQ0FBQztRQUNiLENBQUMsQ0FBQyxPQUFPO1FBRVQsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7WUFDakIsS0FBSyxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsTUFBTTtnQkFDMUIsTUFBTSxDQUFDLENBQUM7UUFDVixDQUFDO1FBRUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQztZQUM5QixPQUFPLElBQUksQ0FBQztRQUNiLENBQUM7UUFFRCxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQztZQUN2QixPQUFPLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN4QixDQUFDO1FBQ0QsUUFBUTtZQUNQLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNuQixDQUFDLENBQUMsVUFBVTtNQUVYLFFBQVE7SUF4T0csV0FBTSxTQXdPbEIsQ0FBQTtBQUVGLENBQUMsRUExVWEsSUFBSSxHQUFKLFlBQUksS0FBSixZQUFJLFFBMFVqQixDQUFDLE1BQU07QUFFUixrQkFBZSxJQUFJLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi9yZ2xcIj5cclxuXHJcblwidXNlIHN0cmljdFwiO1xyXG5cclxuaW1wb3J0ICogYXMgYXNzZXJ0IGZyb20gXCJhc3NlcnRcIjtcclxuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzLWV4dHJhXCI7XHJcbmltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIjtcclxuaW1wb3J0ICogYXMgcmdsIGZyb20gXCIuL3JnbFwiO1xyXG5pbXBvcnQgKiBhcyBldmVudHMgZnJvbSBcImV2ZW50c1wiO1xyXG5cclxuZXhwb3J0IGNvbnN0IENTSTogXCJcXHgxYltcIiA9IFwiXFx4MWJbXCI7XHJcblxyXG4vKipcclxuICogTWVyZ2UgcG9sbHV0ZWQgQU5TSVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNzaW1lcmdlcihzdHI6IHN0cmluZyk6IHN0cmluZyB7XHJcblx0bGV0IGlkeDogbnVtYmVyID0gMCwgLy9ydW5uZXJcclxuXHRcdGNzaTogbnVtYmVyID0gMCwgLy9jc2lkeCB2YWxpZCBhdCAyXHJcblx0XHRjc2lkeDogW251bWJlciwgbnVtYmVyXSA9IFstMSwgLTFdOyAvL2ZpcnN0IGNzaVxyXG5cdFxyXG5cdGZ1bmN0aW9uIHByb2Moc3RyOiBzdHJpbmcsIGkxOiBudW1iZXIsIGkyOiBudW1iZXIpOiBbc3RyaW5nLCBudW1iZXJdIHtcclxuXHRcdGxldCBzOiBzdHJpbmcgPSBzdHIuc2xpY2UoaTEsIGkyKTtcclxuXHRcdFxyXG5cdFx0aWYgKCFzLmVuZHNXaXRoKCdtJykpIHtcclxuXHRcdFx0cyArPSAnbSc7XHJcblx0XHRcdGkyKys7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdHMgPSBzLnJlcGxhY2VBbGwoL21cXHgxYlxcWy9nLCAnOycpO1xyXG5cdFx0XHJcblx0XHRyZXR1cm4gW3N0ci5zbGljZSgwLCBpMSkgKyBzICsgc3RyLnNsaWNlKGkyKSwgaTEgKyBzLmxlbmd0aF07XHJcblx0fSAvL3Byb2NcclxuXHRcclxuXHRpZiAoIXN0cikgcmV0dXJuIHN0cjtcclxuXHRcclxuXHRsZXQgY2xuID0gc3RyO1xyXG5cdFxyXG5cdGRvIHtcclxuXHRcdGNvbnN0IGM6IHN0cmluZyA9IGNsbltpZHhdIHx8ICcnO1xyXG5cdFx0XHJcblx0XHRpZiAoIWNzaSAmJiBjID09ICdcXHgxYicpIHtcclxuXHRcdFx0Y3NpID0gMTtcclxuXHRcdFx0Y3NpZHhbMF0gPSBpZHg7XHJcblx0XHR9IGVsc2UgaWYgKGNzaSA9PSAxICYmIGMgPT0gJ1snKSBjc2kgPSAyO1xyXG5cdFx0ZWxzZSBpZiAoY3NpID09IDEpIGNzaSA9IDA7XHJcblx0XHRlbHNlIGlmIChjc2kgPT0gMiAmJiBjID09ICdtJykgY3NpID0gMztcclxuXHRcdGVsc2UgaWYgKGNzaSA9PSAzICYmIGMgPT0gJ1xceDFiJykgY3NpID0gNDtcclxuXHRcdGVsc2UgaWYgKGNzaSA9PSA0ICYmIGMgPT0gJ1snKSBjc2kgPSAyO1xyXG5cdFx0ZWxzZSBpZiAoY3NpID4gMSAmJiAhL14oW1xcZDtdKykkLy50ZXN0KGMpKSB7XHJcblx0XHRcdGNzaWR4WzFdID0gaWR4IC0gMTtcclxuXHRcdFx0XHJcblx0XHRcdGlmIChjc2kgIT0gMikge1xyXG5cdFx0XHRcdGNvbnN0IFtuY2xuLCBsXTogW3N0cmluZywgbnVtYmVyXSA9IHByb2MoY2xuLCAuLi5jc2lkeCk7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0aWYgKGNsbiAhPSBuY2xuKSBpZHggPSBsO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGNsbiA9IG5jbG47XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHRcdGNzaSA9IDA7XHJcblx0XHRcdGNzaWR4ID0gWy0xLCAtMV07XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGlkeCsrO1xyXG5cdH0gd2hpbGUoaWR4IDw9IGNsbi5sZW5ndGgpO1xyXG5cdFxyXG5cdHJldHVybiBjbG47XHJcbn0gLy9jc2ltZXJnZXJcclxuXHJcbmV4cG9ydCBtb2R1bGUgUkdMTSB7XHJcblx0XHJcblx0ZXhwb3J0IHR5cGUgQnVmOCA9IEJ1ZmZlciAmIHsgbGVuZ3RoOiA4IH07XHJcblx0ZXhwb3J0IHR5cGUgQnVmNCA9IEJ1ZmZlciAmIHsgbGVuZ3RoOiA0IH07XHJcblx0ZXhwb3J0IHR5cGUgQnVmMiA9IEJ1ZmZlciAmIHsgbGVuZ3RoOiAyIH07XHJcblx0XHJcblx0ZXhwb3J0IGZ1bmN0aW9uIHN0dWJtYXAodGV4dDogc3RyaW5nLCAuLi5kYXRhOiBudW1iZXJbXSk6IFJHTE1DaHVua1tdIHtcclxuXHRcdHJldHVybiB0ZXh0LnNwbGl0KCcnKS5tYXAoKGM6IHN0cmluZykgPT4gbmV3IFJHTE1DaHVuayhjLCBkYXRhLnNoaWZ0KCkgPz8gMHhmZiwgZGF0YS5zaGlmdCgpID8/IDB4ZmYsIGRhdGEuc2hpZnQoKSA/PyAweGZmLCBkYXRhLnNoaWZ0KCkgPz8gMHhmZikpO1xyXG5cdH0gLy9zdHVibWFwXHJcblx0XHJcblx0LyoqXHJcblx0ICogUkdMTSBNYWdpY1xyXG5cdCAqL1xyXG5cdGV4cG9ydCBjb25zdCBNQUdJQzogUmVhZG9ubHk8QnVmND4gPSBCdWZmZXIuZnJvbShcIlJHTFxcMFwiLCBcImFzY2lpXCIpIGFzIEJ1ZjQ7XHJcblx0XHJcblx0ZXhwb3J0IGNsYXNzIFJHTE1DaHVuayBleHRlbmRzIGV2ZW50cy5FdmVudEVtaXR0ZXIge1xyXG5cdFx0XHJcblx0XHRzdGF0aWMgI2lkY250cjogbnVtYmVyID0gMDtcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBGb3JtYXR0aW5nIG1hcHBpbmdzLCBzZXQgYnkgcGFyZW50IG1vZHVsZVxyXG5cdFx0ICovXHJcblx0XHRzdGF0aWMgbWFwcGluZ3M6IHtcclxuXHRcdFx0Zmc6XHRcdCgoczogc3RyaW5nKSA9PiBzdHJpbmcpW107XHJcblx0XHRcdGJnOlx0XHQoKHM6IHN0cmluZykgPT4gc3RyaW5nKVtdO1xyXG5cdFx0XHRzdDpcdFx0KChzOiBzdHJpbmcpID0+IHN0cmluZylbXTtcclxuXHRcdFx0Y3VzdDpcdCgoczogc3RyaW5nKSA9PiBzdHJpbmcpW107XHJcblx0XHR9ID0ge1xyXG5cdFx0XHRmZzogW10sXHJcblx0XHRcdGJnOiBbXSxcclxuXHRcdFx0c3Q6IFtdLFxyXG5cdFx0XHRjdXN0OiBbXSxcclxuXHRcdH07XHJcblx0XHRcclxuXHRcdC8qKlxyXG5cdFx0ICogQ2h1bmsgdW5pcXVlIGlkXHJcblx0XHQgKi9cclxuXHRcdF9pZDogbnVtYmVyID0gUkdMTUNodW5rLiNpZGNudHIrKztcclxuXHRcdG9ucmVuZGVyOiAoLi4uZGF0YTogYW55W10pID0+IHN0cmluZyA9IChpZHg6IG51bWJlciwgYzogdGhpcywgcGFyOiBSR0xNLlJHTE1hcCkgPT4gdGhpcy5wcmludDtcclxuXHRcdFxyXG5cdFx0Y29uc3RydWN0b3IocHVibGljIGNocjogc3RyaW5nLCBwdWJsaWMgZmc6IG51bWJlciwgcHVibGljIGJnOiBudW1iZXIsIHB1YmxpYyBzdDogbnVtYmVyLCBwdWJsaWMgY3VzdDogbnVtYmVyKSB7XHJcblx0XHRcdGFzc2VydC5vayh0eXBlb2YgY2hyID09IFwic3RyaW5nXCIsIFwiQmFkIENodW5rXCIpO1xyXG5cdFx0XHRcclxuXHRcdFx0c3VwZXIoKTtcclxuXHRcdFx0XHJcblx0XHRcdHRoaXMuY2hyID0gY2hyLnJlcGxhY2VBbGwoJ1xceDAwJywgJycpO1xyXG5cdFx0XHRcclxuXHRcdFx0YXNzZXJ0Lm9rKFxyXG5cdFx0XHRcdHRoaXMuY2hyLmxlbmd0aCA8PSAxICYmXHJcblx0XHRcdFx0QnVmZmVyLmZyb20odGhpcy5jaHIsIFwiYXNjaWlcIikubGVuZ3RoIDw9IDQgJiZcclxuXHRcdFx0XHRmZyA+PSAwICYmIGZnIDw9IDB4ZmYgJiZcclxuXHRcdFx0XHRiZyA+PSAwICYmIGJnIDw9IDB4ZmYgJiZcclxuXHRcdFx0XHRzdCA+PSAwICYmIHN0IDw9IDB4ZmYgJiZcclxuXHRcdFx0XHRjdXN0ID49IDAgJiYgY3VzdCA8PSAweGZmLFxyXG5cdFx0XHRcIkJhZCBDaHVua1wiKTtcclxuXHRcdH0gLy9jdG9yXHJcblx0XHRcclxuXHRcdC8qKlxyXG5cdFx0ICogUmVwYWNrIGludG8gQnVmOFxyXG5cdFx0ICovXHJcblx0XHRnZXQgcGFjaygpOiBCdWY4IHtcclxuXHRcdFx0Y29uc3QgY2hyOiBCdWY0ID0gQnVmZmVyLmFsbG9jKDQpIGFzIEJ1ZjQ7XHJcblx0XHRcdFxyXG5cdFx0XHRjaHIud3JpdGUodGhpcy5jaHIpO1xyXG5cdFx0XHRcclxuXHRcdFx0cmV0dXJuIEJ1ZmZlci5jb25jYXQoW2NociwgQnVmZmVyLmZyb20oW3RoaXMuZmcsIHRoaXMuYmcsIHRoaXMuc3QsIHRoaXMuY3VzdF0pXSwgOCkgYXMgQnVmODtcclxuXHRcdH0gLy9nLXBhY2tcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBDcmFmdCBpbnZhbGlkL2JsYW5rIGVuZGVyIENodW5rXHJcblx0XHQgKi9cclxuXHRcdHN0YXRpYyBibGFuaygpOiBSR0xNQ2h1bmsge1xyXG5cdFx0XHRyZXR1cm4gbmV3IFJHTE1DaHVuaygnJywgMHhmZiwgMHhmZiwgMHhmZiwgMHhmZik7XHJcblx0XHR9IC8vYmxhbmtcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBCdWY4IC0+IENodW5rXHJcblx0XHQgKi9cclxuXHRcdHN0YXRpYyBwYXJzZShidWY6IFJlYWRvbmx5PEJ1Zjg+KTogUkdMTUNodW5rIHtcclxuXHRcdFx0cmV0dXJuIG5ldyBSR0xNQ2h1bmsoYnVmLnNsaWNlKDAsIDQpLnRvU3RyaW5nKCksIGJ1Zls0XSwgYnVmWzVdLCBidWZbNl0sIGJ1Zls3XSk7XHJcblx0XHR9IC8vcGFyc2VcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBDaHVuayBzdHJpbmcgcmVwcmVzZW50YXRpb25cclxuXHRcdCAqL1xyXG5cdFx0Z2V0IHByaW50KCk6IHN0cmluZyB7XHJcblx0XHRcdGNvbnN0IGZnOlx0KHM6IHN0cmluZywgbj86IG51bWJlciwgdD86IFJHTE1DaHVuaykgPT4gc3RyaW5nID0gUkdMTUNodW5rLm1hcHBpbmdzLmZnW3RoaXMuY3VzdCA9PSAweGZmID8gMHhmZiA6IHRoaXMuZmddXHRcdD8/ICgoczogc3RyaW5nKTogc3RyaW5nID0+IHMpLFxyXG5cdFx0XHRcdGJnOlx0XHQoczogc3RyaW5nLCBuPzogbnVtYmVyLCB0PzogUkdMTUNodW5rKSA9PiBzdHJpbmcgPSBSR0xNQ2h1bmsubWFwcGluZ3MuYmdbdGhpcy5jdXN0ID09IDB4ZmYgPyAweGZmIDogdGhpcy5iZ11cdFx0Pz8gKChzOiBzdHJpbmcpOiBzdHJpbmcgPT4gcyksXHJcblx0XHRcdFx0c3Q6XHRcdChzOiBzdHJpbmcsIG4/OiBudW1iZXIsIHQ/OiBSR0xNQ2h1bmspID0+IHN0cmluZyA9IFJHTE1DaHVuay5tYXBwaW5ncy5zdFt0aGlzLmN1c3QgPT0gMHhmZiA/IDB4ZmYgOiB0aGlzLnN0XVx0XHQ/PyAoKHM6IHN0cmluZyk6IHN0cmluZyA9PiBzKSxcclxuXHRcdFx0XHRjdXN0Olx0KHM6IHN0cmluZywgbj86IG51bWJlciwgdD86IFJHTE1DaHVuaykgPT4gc3RyaW5nID0gUkdMTUNodW5rLm1hcHBpbmdzLmN1c3RbdGhpcy5jdXN0XVx0XHRcdFx0XHRcdFx0XHQ/PyAoKHM6IHN0cmluZyk6IHN0cmluZyA9PiBzKTtcclxuXHRcdFx0XHJcblx0XHRcdHJldHVybiBjc2ltZXJnZXIoY3VzdChzdChmZyhiZyh0aGlzLmNociA/PyAnICcsIHRoaXMuYmcsIHRoaXMpLCB0aGlzLmZnLCB0aGlzKSwgdGhpcy5zdCwgdGhpcyksIHRoaXMuY3VzdCwgdGhpcykpO1xyXG5cdFx0fSAvL2ctcHJpbnRcclxuXHRcdFxyXG5cdH0gLy9SR0xNQ2h1bmtcclxuXHJcblx0ZXhwb3J0IGNsYXNzIFJHTE1hcCBleHRlbmRzIGV2ZW50cy5FdmVudEVtaXR0ZXIge1xyXG5cdFx0c3RhdGljIFJHTE1DaHVuazogdHlwZW9mIFJHTE1DaHVuayA9IFJHTE1DaHVuaztcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBNYXAgQ2h1bmtzXHJcblx0XHQgKi9cclxuXHRcdGNodW5rczogUkdMTUNodW5rW10gPSBbIF07XHJcblx0XHRfbG9hZGVkRnJvbTogc3RyaW5nID0gXCJcIjtcclxuXHRcdG1ldGE6IHtcclxuXHRcdFx0W2tleTogc3RyaW5nXTogc3RyaW5nO1xyXG5cdFx0fSA9IHsgfTtcclxuXHRcdFxyXG5cdFx0Y29uc3RydWN0b3IocHVibGljIGRpbWVuczogW251bWJlciwgbnVtYmVyXSA9IFsgMCwgMCBdLCBwdWJsaWMgcGFyZW50OiByZ2wucmdsLlJHTCwgcHVibGljIHNjcm9sbDogW251bWJlciwgbnVtYmVyXSA9IFsgMCwgMCBdKSB7XHJcblx0XHRcdGFzc2VydC5vayhkaW1lbnMgaW5zdGFuY2VvZiBBcnJheSAmJiBkaW1lbnMubGVuZ3RoID09IDIgJiYgZGltZW5zLmV2ZXJ5KGQgPT4gZCA+PSAwKSAmJlxyXG5cdFx0XHRcdHNjcm9sbCBpbnN0YW5jZW9mIEFycmF5ICYmIHNjcm9sbC5sZW5ndGggPT0gMiAmJiBwYXJlbnQsIFwiQmFkIE1hcFwiKTtcclxuXHRcdFx0XHJcblx0XHRcdHN1cGVyKCk7XHJcblx0XHRcdFxyXG5cdFx0XHR0aGlzLmRpbWVucyA9IGRpbWVucy5tYXAoZCA9PiBOdW1iZXIoZCkpIGFzIFtudW1iZXIsIG51bWJlcl07XHJcblx0XHRcdHRoaXMuc2Nyb2xsID0gc2Nyb2xsLm1hcChkID0+IE51bWJlcihkKSkgYXMgW251bWJlciwgbnVtYmVyXTtcclxuXHRcdH0gLy9jdG9yXHJcblx0XHRcclxuXHRcdC8qKlxyXG5cdFx0ICogQ3JlYXRlIGVtcHR5L2JsYW5rIE1hcFxyXG5cdFx0ICovXHJcblx0XHRzdGF0aWMgYmxhbmsocGFyOiByZ2wucmdsLlJHTCkge1xyXG5cdFx0XHRyZXR1cm4gbmV3IFJHTE0uUkdMTWFwKFsgMCwgMCBdLCBwYXIpO1xyXG5cdFx0fSAvL2JsYW5rXHJcblx0XHRcclxuXHRcdC8qKlxyXG5cdFx0ICogQ3JhZnQgTWFwIGZyb20gZnNcclxuXHRcdCAqL1xyXG5cdFx0c3RhdGljIGFzeW5jIHBhcnNlKGZyb206IHN0cmluZywgcGFyOiByZ2wucmdsLlJHTCk6IFByb21pc2U8UkdMTWFwPiB7XHJcblx0XHRcdGFzc2VydC5vayhmcm9tLCBcIidmcm9tJyBtdXN0IGJlIHByb3ZpZGVkXCIpO1xyXG5cdFx0XHRcclxuXHRcdFx0ZnJvbSA9IHBhdGgucmVzb2x2ZShmcm9tKTtcclxuXHRcdFx0Y29uc3QgZGF0OiBCdWZmZXIgPSBhd2FpdCBmcy5wcm9taXNlcy5yZWFkRmlsZShmcm9tLCB7XHJcblx0XHRcdFx0ZmxhZzogXCJyXCJcclxuXHRcdFx0fSksXHJcblx0XHRcdGVuZDogQnVmOCA9IEJ1ZmZlci5mcm9tKFwiRkZGRkZGRkZGRkZGRkZGRlwiLCBcImhleFwiKSBhcyBCdWY4O1xyXG5cdFx0XHRcclxuXHRcdFx0YXNzZXJ0Lm9rKGRhdC5sZW5ndGggPj0gOCAmJiAhZGF0LnNsaWNlKDAsIDQpLmNvbXBhcmUoQnVmZmVyLmZyb20oXCJSR0xcXDBcIiwgXCJhc2NpaVwiKSksIFwiQnJva2VuIFJHTE1cIik7XHJcblx0XHRcdFxyXG5cdFx0XHRsZXQgbWFwID0gbmV3IFJHTE1hcChbZGF0LnNsaWNlKDQsIDYpLnJlYWRVSW50MTZMRSgpLCBkYXQuc2xpY2UoNiwgOCkucmVhZFVJbnQxNkxFKCldLCBwYXIpLFxyXG5cdFx0XHRcdGNoazogcmdsLk51bGxhYmxlPEJ1Zjg+ID0gbnVsbCxcclxuXHRcdFx0XHRpOiBudW1iZXIgPSA4LFxyXG5cdFx0XHRcdHBhc3Npbmc6IGJvb2xlYW4gPSB0cnVlO1xyXG5cdFx0XHRcclxuXHRcdFx0bWFwLl9sb2FkZWRGcm9tID0gZnJvbTtcclxuXHRcdFx0XHJcblx0XHRcdGlmIChkYXQubGVuZ3RoID4gOCkge1xyXG5cdFx0XHRcdGRvIHtcclxuXHRcdFx0XHRcdGlmIChpICsgOCA+IGRhdC5sZW5ndGgpIHRocm93IFwiQnJva2VuIFJHTE1cIjtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0Y2hrID0gZGF0LnNsaWNlKGksIGkgKz0gOCkgYXMgQnVmODtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0aWYgKGNoay5jb21wYXJlKGVuZCkpIHtcclxuXHRcdFx0XHRcdFx0bWFwLmNodW5rcy5wdXNoKFJHTE1hcC5SR0xNQ2h1bmsucGFyc2UoY2hrKSk7XHJcblx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRpZiAoaSA9PSBkYXQubGVuZ3RoKSBicmVhaztcclxuXHRcdFx0XHRcdH0gZWxzZSBwYXNzaW5nID0gZmFsc2U7XHJcblx0XHRcdFx0fSB3aGlsZShwYXNzaW5nKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0aWYgKGNoayAmJiAhY2hrLmNvbXBhcmUoZW5kKSkge1xyXG5cdFx0XHRcdGNvbnN0IG1ldGE6IHN0cmluZ1tdID0gZGF0LnNsaWNlKGkpLnRvU3RyaW5nKFwidXRmOFwiKS5zcGxpdCgnJicpO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGZvciAoY29uc3QgbWV0IG9mIG1ldGEpIHtcclxuXHRcdFx0XHRcdGNvbnN0IHBhaXI6IFtzdHJpbmcsIHN0cmluZ10gfCBbc3RyaW5nXSA9IG1ldC5zcGxpdCgnPScpIGFzIFtzdHJpbmcsIHN0cmluZ10gfCBbc3RyaW5nXTtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0bWFwLm1ldGFbcGFpclswXV0gPSBwYWlyWzFdID8/ICcnO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0cmV0dXJuIG1hcDtcclxuXHRcdH0gLy9wYXJzZVxyXG5cdFx0XHJcblx0XHQvKipcclxuXHRcdCAqIChSZSlzdG9yZSBNYXAgdG8gZnNcclxuXHRcdCAqL1xyXG5cdFx0YXN5bmMgc3RvcmUodG86IHN0cmluZyA9IHRoaXMuX2xvYWRlZEZyb20pIHtcclxuXHRcdFx0YXNzZXJ0Lm9rKHRvICYmIHR5cGVvZiB0byA9PSBcInN0cmluZ1wiLCBcIidkZXN0aW5hdGlvbicgbXVzdCBiZSBhIHZhbGlkIHBhdGhcIik7XHJcblx0XHRcdFxyXG5cdFx0XHRyZXR1cm4gYXdhaXQgZnMucHJvbWlzZXMud3JpdGVGaWxlKHRvLCB0aGlzLnBhY2ssIHtcclxuXHRcdFx0XHRlbmNvZGluZzogXCJiaW5hcnlcIixcclxuXHRcdFx0XHRmbGFnOiBcIndcIixcclxuXHRcdFx0XHRtb2RlOiAwbzc3NVxyXG5cdFx0XHR9KTtcclxuXHRcdH0gLy9zdG9yZVxyXG5cdFx0XHJcblx0XHQvKipcclxuXHRcdCAqIE1hcCAtPiBCdWZmXHJcblx0XHQgKi9cclxuXHRcdGdldCBwYWNrKCk6IEJ1ZmZlciB7XHJcblx0XHRcdGNvbnN0IGRpbWVuczogW0J1ZjIsIEJ1ZjJdID0gW1xyXG5cdFx0XHRcdEJ1ZmZlci5hbGxvY1Vuc2FmZSgyKSBhcyBCdWYyLFxyXG5cdFx0XHRcdEJ1ZmZlci5hbGxvY1Vuc2FmZSgyKSBhcyBCdWYyLFxyXG5cdFx0XHRdO1xyXG5cdFx0XHRsZXQgbWV0YTogQnVmZmVyID0gQnVmZmVyLmZyb20oT2JqZWN0LmVudHJpZXModGhpcy5tZXRhKS5tYXAoZSA9PiBlLmpvaW4oJz0nKSkuam9pbignJicpLCBcInV0ZjhcIik7XHJcblx0XHRcdFxyXG5cdFx0XHRkaW1lbnNbMF0ud3JpdGVVSW50MTZMRSh0aGlzLmRpbWVuc1swXSk7XHJcblx0XHRcdGRpbWVuc1sxXS53cml0ZVVJbnQxNkxFKHRoaXMuZGltZW5zWzFdKTtcclxuXHRcdFx0XHJcblx0XHRcdGlmIChtZXRhLmxlbmd0aCkgbWV0YSA9IEJ1ZmZlci5jb25jYXQoW0J1ZmZlci5mcm9tKFwiRkZGRkZGRkZGRkZGRkZGRlwiLCBcImhleFwiKSwgbWV0YV0pO1xyXG5cdFx0XHRcclxuXHRcdFx0cmV0dXJuIEJ1ZmZlci5jb25jYXQoW1JHTE0uTUFHSUMsIC4uLmRpbWVucywgLi4udGhpcy5jaHVua3MubWFwKGMgPT4gYy5wYWNrKSwgbWV0YV0sICh0aGlzLmNodW5rcy5sZW5ndGggKyAxKSAqIDggKyBtZXRhLmxlbmd0aCk7XHJcblx0XHR9IC8vZy1wYWNrXHJcblx0XHRcclxuXHRcdC8qKlxyXG5cdFx0ICogU3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIE1hcCdzIENodW5rc1xyXG5cdFx0ICovXHJcblx0XHRnZXQgcHJpbnQoKTogc3RyaW5nIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuY2h1bmtzLm1hcChjID0+IGMucHJpbnQpLmpvaW4oJycpO1xyXG5cdFx0fSAvL2ctcHJpbnRcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBDYWxjdWxhdGUgVmlld3BvcnQgY29vcmRpbmF0ZXMgZnJvbSBjaHVua2xpc3QgaW5kZXhcclxuXHRcdCAqL1xyXG5cdFx0Y2FsY0Noa0lkeCh4OiBudW1iZXIgfCBSR0xNQ2h1bmssIHk6IG51bWJlciA9IDApOiBudW1iZXIge1xyXG5cdFx0XHRpZiAoeCBpbnN0YW5jZW9mIFJHTE1DaHVuaykgcmV0dXJuIHRoaXMuY2h1bmtzLmZpbmRJbmRleChjID0+IGMgPT0geCk7XHJcblx0XHRcdFxyXG5cdFx0XHRhc3NlcnQub2soeCA+PSAwLCBcIkJhZCBpZHhcIik7XHJcblx0XHRcdFxyXG5cdFx0XHRyZXR1cm4gdGhpcy5kaW1lbnNbMF0gKiB5ISArIHg7XHJcblx0XHR9IC8vY2FsY0Noa0lkeFxyXG5cdFx0LyoqXHJcblx0XHQgKiBDYWxjdWxhdGUgY2h1bmtsaXN0IGluZGV4IGZyb20gVmlld3BvcnQgY29vcmRpbmF0ZXNcclxuXHRcdCAqL1xyXG5cdFx0Y2FsY0Noa0NyZChpZHg6IG51bWJlciB8IFJHTE1DaHVuayk6IFtudW1iZXIsIG51bWJlcl0ge1xyXG5cdFx0XHRpZiAoaWR4IGluc3RhbmNlb2YgUkdMTUNodW5rKSBpZHggPSB0aGlzLmNodW5rcy5maW5kSW5kZXgoYyA9PiBjID09IGlkeCk7XHJcblx0XHRcdFxyXG5cdFx0XHRhc3NlcnQub2soaWR4ID49IDAsIFwiQmFkIGlkeFwiKTtcclxuXHRcdFx0XHJcblx0XHRcdHJldHVybiBbXHJcblx0XHRcdFx0aWR4ICUgdGhpcy5kaW1lbnNbMF0sXHJcblx0XHRcdFx0TWF0aC5mbG9vcihpZHggLyB0aGlzLmRpbWVuc1swXSlcclxuXHRcdFx0XTtcclxuXHRcdH0gLy9jYWxjQ2hrQ3JkXHJcblx0XHQvKipcclxuXHRcdCAqIEdldCBhIENodW5rXHJcblx0XHQgKi9cclxuXHRcdGdldChuOiBudW1iZXIgfCBSR0xNQ2h1bmssIHg/OiBudW1iZXIpOiBSR0xNQ2h1bmsge1xyXG5cdFx0XHRpZiAobiBpbnN0YW5jZW9mIFJHTE1DaHVuaykgcmV0dXJuIHRoaXMuY2h1bmtzW3RoaXMuY2FsY0Noa0lkeChuKV07XHJcblx0XHRcdGVsc2UgaWYgKHR5cGVvZiB4ID09IFwidW5kZWZpbmVkXCIpIHJldHVybiB0aGlzLmNodW5rc1tuXTtcclxuXHRcdFx0ZWxzZSByZXR1cm4gdGhpcy5jaHVua3NbdGhpcy5jYWxjQ2hrSWR4KG4sIHgpXTtcclxuXHRcdH0gLy9nZXRcclxuXHRcdC8qKlxyXG5cdFx0ICogUGxhY2UgYSBDaHVua1xyXG5cdFx0ICovXHJcblx0XHRwbGFjZShjOiBSR0xNQ2h1bmtbXSwgbjogbnVtYmVyIHwgUkdMTUNodW5rID0gdGhpcy5jaHVua3MubGVuZ3RoLCB4PzogbnVtYmVyLCByZXBsOiBudW1iZXIgPSAxKSB7XHJcblx0XHRcdGNvbnN0IGlkeDogbnVtYmVyID0gdHlwZW9mIHggPT0gXCJ1bmRlZmluZWRcIiA/IChuIGluc3RhbmNlb2YgUkdMTUNodW5rID8gdGhpcy5jYWxjQ2hrSWR4KG4pIDogbikgOiB0aGlzLmNhbGNDaGtJZHgobiwgeCk7XHJcblx0XHRcdFxyXG5cdFx0XHRhc3NlcnQub2soaWR4ID49IDAsIFwiQmFkIGlkeFwiKTtcclxuXHRcdFx0XHJcblx0XHRcdHJldHVybiB0aGlzLmNodW5rcy5zcGxpY2UoaWR4LCByZXBsLCAuLi5jKTtcclxuXHRcdH0gLy9wbGFjZVxyXG5cdFx0LyoqXHJcblx0XHQgKiBTd2FwIENodW5rcyBsb2NhdGlvbnNcclxuXHRcdCAqL1xyXG5cdFx0c3dhcChjMTogUkdMTUNodW5rLCBjMjogUkdMTUNodW5rKTogdGhpcyB7XHJcblx0XHRcdGlmIChjMSA9PSBjMikgcmV0dXJuIHRoaXM7XHJcblx0XHRcdFxyXG5cdFx0XHRjb25zdCBjaTE6IG51bWJlciA9IHRoaXMuY2FsY0Noa0lkeChjMSk7XHJcblx0XHRcdGFzc2VydC5vayhjaTEgPj0gMCwgXCJCYWQgaWR4XCIpO1xyXG5cdFx0XHRjb25zdCBjYzE6IFJHTE1DaHVuayA9IHRoaXMuY2h1bmtzLnNwbGljZShjaTEsIDEpWzBdO1xyXG5cdFx0XHRcclxuXHRcdFx0Y29uc3QgY2kyOiBudW1iZXIgPSB0aGlzLmNhbGNDaGtJZHgoYzIpO1xyXG5cdFx0XHRhc3NlcnQub2soY2kyID49IDAsIFwiQmFkIGlkeFwiKTtcclxuXHRcdFx0Y29uc3QgY2MyOiBSR0xNQ2h1bmsgPSB0aGlzLmNodW5rcy5zcGxpY2UoY2kyLCAxLCBjYzEpWzBdO1xyXG5cdFx0XHRcclxuXHRcdFx0dGhpcy5jaHVua3Muc3BsaWNlKGNpMSwgMCwgY2MyKTtcclxuXHRcdFx0XHJcblx0XHRcdHJldHVybiB0aGlzO1xyXG5cdFx0fSAvL3N3YXBcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBDaGVjayBpZiBDaHVuayBpcyBpbnNpZGUgYm91bmRzXHJcblx0XHQgKiBcclxuXHRcdCAqIHQqIC0gY2h1bmsgdGFyZ2V0XHJcblx0XHQgKiBkKiAtIHZpZXdwb3J0IHNpemVcclxuXHRcdCAqIHMqIC0gdmlld3BvcnQgc2Nyb2xsXHJcblx0XHQgKiAqIC0gdmlld3BvcnRcclxuXHRcdCAqL1xyXG5cdFx0aXNJbih0eDogbnVtYmVyLCB0eT86IG51bWJlciwgeDogbnVtYmVyID0gMCwgeTogbnVtYmVyID0gMCwgc3g6IG51bWJlciA9IHRoaXMuc2Nyb2xsWzBdLCBzeTogbnVtYmVyID0gdGhpcy5zY3JvbGxbMV0sIGR4OiBudW1iZXIgPSB0aGlzLmRpbWVuc1swXSwgZHk6IG51bWJlciA9IHRoaXMuZGltZW5zWzFdKTogYm9vbGVhbiB7XHJcblx0XHRcdGlmICh0eXBlb2YgdHkgPT0gXCJ1bmRlZmluZWRcIikgKFt0eCwgdHldID0gdGhpcy5jYWxjQ2hrQ3JkKHR4KSk7XHJcblx0XHRcdFxyXG5cdFx0XHRjb25zdCByeDogbnVtYmVyID0gdHggKyBzeCxcclxuXHRcdFx0XHRyeTogbnVtYmVyID0gdHkgKyBzeTtcclxuXHRcdFx0XHJcblx0XHRcdHJldHVybiByeCA+PSB4ICYmIHJ4IDwgTWF0aC5taW4oZHgsIHRoaXMucGFyZW50LnNvdXQuY29sdW1ucykgJiYgcnkgPj0geSAmJiByeSA8IE1hdGgubWluKGR5LCB0aGlzLnBhcmVudC5zb3V0LnJvd3MpO1xyXG5cdFx0fSAvL2lzSW5cclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBJbXByaW50IE1hcCBvbiBSR0xcclxuXHRcdCAqL1xyXG5cdFx0YXN5bmMgc3RhbXAoZHg6IG51bWJlciA9IHRoaXMuZGltZW5zWzBdLCBkeTogbnVtYmVyID0gdGhpcy5kaW1lbnNbMV0sIHg6IG51bWJlciA9IDAsIHk6IG51bWJlciA9IDAsIHN4OiBudW1iZXIgPSB0aGlzLnNjcm9sbFswXSwgc3k6IG51bWJlciA9IHRoaXMuc2Nyb2xsWzFdLCBwYXI6IHJnbC5yZ2wuUkdMID0gdGhpcy5wYXJlbnQpOiBQcm9taXNlPHRoaXM+IHtcclxuXHRcdFx0YXNzZXJ0Lm9rKHBhciwgXCJCYWQgcGFyZW50XCIpO1xyXG5cdFx0XHRcclxuXHRcdFx0Y29uc3Qgc2F2OiBbbnVtYmVyLCBudW1iZXJdID0gWy4uLnBhci5jdXJzb3JdO1xyXG5cdFx0XHRcclxuXHRcdFx0Zm9yIChsZXQgaWR4OiBudW1iZXIgPSAwOyBpZHggPCB0aGlzLmNodW5rcy5sZW5ndGg7IGlkeCsrKSB7XHJcblx0XHRcdFx0Y29uc3QgYzogUkdMTS5SR0xNQ2h1bmsgPSB0aGlzLmNodW5rc1tpZHhdO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGlmICghYykgY29udGludWU7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0aWYgKHRoaXMuaXNJbihpZHgsIHVuZGVmaW5lZCwgeCwgeSwgc3gsIHN5LCBkeCwgZHkpKSB7XHJcblx0XHRcdFx0XHRhd2FpdCBwYXIubW92ZSguLi4odGhpcy5jYWxjQ2hrQ3JkKGlkeCkubWFwKChjOiBudW1iZXIsIGlkeDogbnVtYmVyKTogbnVtYmVyID0+IGMgKyBbc3gsIHN5XVtpZHhdKSkgYXMgW251bWJlciwgbnVtYmVyXSk7XHJcblx0XHRcdFx0XHRwYXIud3JpdGUoYy5vbnJlbmRlcihpZHgsIGMsIHRoaXMpKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHRcdGF3YWl0IHBhci5tb3ZlKC4uLnNhdik7XHJcblx0XHRcdFxyXG5cdFx0XHRyZXR1cm4gdGhpcztcclxuXHRcdH0gLy9zdGFtcFxyXG5cdFx0XHJcblx0XHQqW1N5bWJvbC5pdGVyYXRvcl0oKTogR2VuZXJhdG9yPFJHTE1DaHVuaywgdm9pZCwgUkdMTUNodW5rPiB7XHJcblx0XHRcdGZvciAoY29uc3QgYyBvZiB0aGlzLmNodW5rcylcclxuXHRcdFx0XHR5aWVsZCBjO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRnZXQgW1N5bWJvbC5pc0NvbmNhdFNwcmVhZGFibGVdKCk6IGJvb2xlYW4ge1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0Z2V0IFtTeW1ib2wudG9TdHJpbmdUYWddKCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy50b1N0cmluZygpO1xyXG5cdFx0fVxyXG5cdFx0dG9TdHJpbmcoKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLnByaW50O1xyXG5cdFx0fSAvL3RvU3RyaW5nXHJcblx0XHRcclxuXHR9IC8vUkdMTWFwXHJcblx0XHJcbn0gLy9SR0xNXHJcblxyXG5leHBvcnQgZGVmYXVsdCBSR0xNO1xyXG4iXX0=