/// <reference path="./RGLM.ts">
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.rglm = exports.rgl = void 0;
const tslib_1 = require("tslib");
const assert = tslib_1.__importStar(require("assert"));
const event = tslib_1.__importStar(require("events"));
const readline = tslib_1.__importStar(require("readline"));
const fs = tslib_1.__importStar(require("fs-extra"));
const os = tslib_1.__importStar(require("os"));
const path = tslib_1.__importStar(require("path"));
const rglm = tslib_1.__importStar(require("./RGLM"));
exports.rglm = rglm;
const util = tslib_1.__importStar(require("util"));
var rgl;
(function (rgl) {
    const dbg = util.debuglog("RGL");
    dbg(`ins ${__dirname}`);
    rgl.scrollUp = (by = 1) => `\x1b[${by}S`, rgl.scrollDown = (by = 1) => `\x1b[${by}T`, rgl.save = `\x1b7\x1b[s`, rgl.restore = `\x1b8\x1b[u`;
    /**
     * Main packaging Class
     */
    class RGL extends event.EventEmitter {
        cfg;
        /**
         * TTY streams bound to app
         */
        _bound = {
            sin: process.stdin,
            sout: process.stdout,
            serr: process.stderr,
            sinbind: null,
        };
        /**
         * SOUT cursor state
         */
        cursor = [0, 0];
        /**
         * Source of package Config in case of fs load
         */
        #_loadedFrom = "";
        static defaults = {
            description: "",
            main: "./main.js",
            version: "0.1",
            mappings: "./mappings.js",
            name: process.title,
            keywords: [],
            "$schema": path.join(__dirname, "../../rglcfg.schema.json")
        };
        /**
         * Special keys for convenience
         */
        static special_keys = {
            ctrlC: Buffer.from("03", "hex"),
            ctrlV: Buffer.from("16", "hex"),
            up: Buffer.from("1b5b41", "hex"),
            down: Buffer.from("1b5b42", "hex"),
            right: Buffer.from("1b5b43", "hex"),
            left: Buffer.from("1b5b44", "hex"),
            enter: Buffer.from("0d", "hex"),
            back: Buffer.from("08", "hex"),
            del: Buffer.from("1b5b337e", "hex"),
            shiftUp: Buffer.from("1b5b313b3241", "hex"),
            shiftDown: Buffer.from("1b5b313b3242", "hex"),
            shiftRight: Buffer.from("1b5b313b3243", "hex"),
            shiftLeft: Buffer.from("1b5b313b3244", "hex"),
            /**
             * @todo add ctrl/shift arrows(?)
            */
        };
        constructor(cfg) {
            super();
            this.cfg = cfg;
            this.cfg = Object.assign(Object.assign(Object.create(null), RGL.defaults), cfg);
            assert.ok(this.cfg.name, "RGL 'name' must be provided in the config");
            this.cfg.main = "./" + path.win32.normalize(this.cfg.main ?? "./main.js");
            this.cfg.mappings = "./" + path.win32.normalize(this.cfg.mappings ?? "./mappings.js");
            //process.stdout.write(`\x1b]0;${this.cfg.name}\a`);
            process.title = this.cfg.name ?? process.title ?? "RGL";
            this.parseMappings();
        } //ctor
        get dimens() {
            return this.sout?.getWindowSize() ?? [0, 0];
        } //g-dimens
        get cDpt() {
            return this.colorDepth();
        } //g-cDpt
        get serr() {
            return this._bound.serr ?? this._bound.sout ?? process.stderr;
        } //g-serr
        get sout() {
            return this._bound.sout ?? process.stdout;
        } //g-sout
        get sin() {
            return this._bound.sin ?? process.stdin;
        } //g-sin
        /**
         * Parse Mappings from File
         */
        parseMappings(from = this.cfg.mappings) {
            assert.ok(from, "'mappings' must be a valid path");
            from = path.win32.join(process.cwd(), from);
            delete require.cache[from];
            try {
                return rglm.RGLM.RGLMChunk.mappings = require(from);
            }
            catch (e) {
                return rglm.RGLM.RGLMChunk.mappings = require(path.join(__dirname, "../../mappings.js"));
            }
        } //parseMappings
        /**
         * Capture keys from SIN
         */
        capture(which = this.sin, bind = true, out = this.sout, err = this.serr) {
            assert.ok(which.isTTY && out.isTTY && err.isTTY, "Stream must be TTY");
            if ((which.isRaw && !bind) || (!which.isRaw && bind))
                which.setRawMode(bind);
            if (this._bound.sinbind && this._bound.sin) {
                this._bound.sin.removeListener("data", this._bound.sinbind);
                this._bound.sinbind = null;
            }
            if (which.isRaw) {
                which.on("data", this._bound.sinbind = (key) => {
                    this.emit("rawkey", key, key.length > 1 && key[0] == 0x1b, key.length > 1 ? key.slice(1) : key.slice(0));
                    this.emit("rawctrlkey", key, Buffer.from([(Array.from(key.values()).pop() ?? 0) + 0x61 - 1]), key.length > 1 && key[0] == 0x1b, key.length > 1 ? key.slice(1) : key.slice(0));
                    this.emit("key", key.toString("utf8"), key.length > 1 && key[0] == 0x1b, (key.length > 1 ? key.slice(1) : key.slice(0)).toString("utf8"));
                });
            }
            this._bound.sin = which;
            this._bound.sout = out;
            this._bound.serr = err;
            this.emit("debug", `TTY set to ${bind}`);
            return which.isRaw;
        } //capture
        /**
         * Load package Config from File
         */
        static async load(from = "./package.json") {
            if (typeof from == "string") {
                from = path.win32.resolve(from);
                let out = new RGL(await fs.readJSON(from, {
                    encoding: "ascii",
                    flag: "r"
                }));
                out.#_loadedFrom = from;
                return out;
            }
            else
                return new RGL(from);
        } //load
        /**
         * Store package Config to File
         */
        async store(to = this.#_loadedFrom ?? "./package.json", repl, pad = 2) {
            assert.ok(to && typeof to == "string", "'config' must be a valid path");
            return await fs.writeJSON(to, this.cfg, {
                EOL: os.EOL,
                encoding: "ascii",
                mode: 0o775,
                spaces: pad,
                replacer: repl,
                flag: "w"
            });
        } //store
        /**
         * Launch package entry
         */
        exec(from = this.cfg.main ?? "./main.js") {
            assert.ok(from, "'main' must be a valid path");
            from = path.win32.join(process.cwd(), from);
            delete require.cache[from];
            try {
                return require(from)(this, module);
            }
            catch (e) {
                return require(path.win32.join(process.cwd(), "./main.js"))(this, module);
            }
        } //exec
        /**
         * Write-and-count to SOUT
         */
        write(d, ...data) {
            if (d instanceof Buffer)
                d = d.toString("ascii");
            else if (d instanceof Uint8Array)
                d = d.join('');
            d = d.replaceAll('\t', ' '.repeat(4)).replaceAll(/((?<!\r)\n(?!\r)|(?<!\n)\r(?!\n)|\r\n|\n\r)/gmis, '\n');
            const chs = d.toString().split('\n'), len = chs.length - 1;
            if (len >= 1)
                this.cursor[0] = chs[len].length;
            else
                this.cursor[0] += chs[len].length;
            this.cursor[0] %= this.sout.columns;
            this.cursor[1] = Math.min(this.cursor[1] + len, this.sout.rows);
            const out = this.sout.write(d);
            this.emit("write", d);
            if (!out)
                process.nextTick(() => this.sout.uncork());
            data.forEach(dt => this.write(dt));
            return out;
        } //write
        /**
         * Write-and-count-newline to SOUT
         */
        writeE(...data) {
            return this.write(data.shift(), ...data, os.EOL);
        } //writeE
        /**
         * Get TTY color depth
         */
        colorDepth(env = process.env) {
            return this.sout.getColorDepth(env);
        } //colorDepth
        /**
         * Move-and-count SOUT cursor
         */
        async move(x, y, rel = false) {
            if (!rel)
                x = Math.min(Math.max(x, 0), this.dimens[0]);
            else
                x = Math.min(Math.max(x, -this.dimens[0]), this.dimens[0]);
            if (!rel && y)
                y = Math.min(Math.max(y, 0), this.dimens[1]);
            else if (rel && y)
                y = Math.min(Math.max(y, -this.dimens[1]), this.dimens[1]);
            return new Promise((res, rej) => {
                let data;
                this.emit("move", x, y, rel);
                if (!rel) {
                    this.cursor[0] = x;
                    this.cursor[1] = y ?? this.cursor[1];
                    data = readline.cursorTo(this.sout, x, y, () => res(data));
                }
                else {
                    if (x)
                        this.cursor[0] += x;
                    if (y)
                        this.cursor[1] += y;
                    data = readline.moveCursor(this.sout, x, y ?? 0, () => res(data));
                }
            });
        } //move
        /**
         * Clear-and-restore SOUT
         */
        async clear(lines, dir = 0, rel) {
            return new Promise(async (res, rej) => {
                const sav = [...this.cursor];
                let out = true;
                if (!lines) {
                    this.move(0, 0, rel).then(() => {
                        out = readline.clearScreenDown(this.sout, () => {
                            this.move(...sav, false).then(() => res(out));
                        });
                    });
                }
                else if (typeof lines == "number" && lines < 0)
                    out = readline.clearLine(this.sout, dir, () => {
                        this.move(...sav, false).then(() => res(out));
                    });
                else if (typeof lines == "number") {
                    this.move(0, lines, rel).then(() => {
                        out = readline.clearLine(this.sout, dir, () => {
                            this.move(...sav, false).then(() => res(out));
                        });
                    });
                }
                else
                    return Promise.all(lines.map(l => this.clear(l, dir, rel))).then(bs => res(bs.every(b => b)), rej);
                this.emit("clear", lines, dir, rel, out);
            });
        } //clear
        once(eventname, listener) {
            return super.on(eventname, listener);
        } //once
        on(eventname, listener) {
            return super.on(eventname, listener);
        } //on
        emit(eventname, ...args) {
            return super.emit(eventname, ...args);
        } //emit
    } //RGL
    rgl.RGL = RGL;
})(rgl = exports.rgl || (exports.rgl = {})); //rgl
exports.default = rgl;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmdsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vbGliL3JnbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxnQ0FBZ0M7QUFFaEMsWUFBWSxDQUFDOzs7O0FBV2IsdURBQWlDO0FBQ2pDLHNEQUFnQztBQUNoQywyREFBcUM7QUFFckMscURBQStCO0FBQy9CLCtDQUF5QjtBQUN6QixtREFBNkI7QUFDN0IscURBQStCO0FBZ1h0QixvQkFBSTtBQS9XYixtREFBNkI7QUFFN0IsSUFBYyxHQUFHLENBMldoQjtBQTNXRCxXQUFjLEdBQUc7SUFFaEIsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUVqQyxHQUFHLENBQUMsT0FBTyxTQUFTLEVBQUUsQ0FBQyxDQUFDO0lBRVgsWUFBUSxHQUFHLENBQUMsS0FBc0IsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUNqRSxjQUFVLEdBQUcsQ0FBQyxLQUFzQixDQUFDLEVBQUUsRUFBRSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQ3ZELFFBQUksR0FBRyxhQUFhLEVBQ3BCLFdBQU8sR0FBRyxhQUFhLENBQUM7SUFlekI7O09BRUc7SUFDSCxNQUFhLEdBQUksU0FBUSxLQUFLLENBQUMsWUFBWTtRQXNFcEI7UUFwRXRCOztXQUVHO1FBQ0ssTUFBTSxHQUtWO1lBQ0gsR0FBRyxFQUFFLE9BQU8sQ0FBQyxLQUFLO1lBQ2xCLElBQUksRUFBRSxPQUFPLENBQUMsTUFBTTtZQUNwQixJQUFJLEVBQUUsT0FBTyxDQUFDLE1BQU07WUFDcEIsT0FBTyxFQUFFLElBQUk7U0FDYixDQUFDO1FBQ0Y7O1dBRUc7UUFDSCxNQUFNLEdBQXFCLENBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBRSxDQUFDO1FBQ3BDOztXQUVHO1FBQ0gsWUFBWSxHQUFXLEVBQUUsQ0FBQztRQUUxQixNQUFNLENBQVUsUUFBUSxHQUFvQjtZQUMzQyxXQUFXLEVBQUUsRUFBRTtZ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QUFJLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRTt3QkFDOUIsR0FBRyxHQUFHLFFBQVEsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUU7NEJBQzlDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUMvQyxDQUFDLENBQUMsQ0FBQztvQkFDSixDQUFDLENBQUMsQ0FBQztpQkFDSDtxQkFBTSxJQUFJLE9BQU8sS0FBSyxJQUFJLFFBQVEsSUFBSSxLQUFLLEdBQUcsQ0FBQztvQkFDL0MsR0FBRyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFO3dCQUM3QyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDL0MsQ0FBQyxDQUFDLENBQUM7cUJBQ0MsSUFBSSxPQUFPLEtBQUssSUFBSSxRQUFRLEVBQUU7b0JBQ2xDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFO3dCQUNsQyxHQUFHLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUU7NEJBQzdDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUMvQyxDQUFDLENBQUMsQ0FBQztvQkFDSixDQUFDLENBQUMsQ0FBQztpQkFDSDs7b0JBQ0EsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFFcEcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDMUMsQ0FBQyxDQUFDLENBQUM7UUFDSixDQUFDLENBQUMsT0FBTztRQVdULElBQUksQ0FBQyxTQUEwQixFQUFFLFFBQWtDO1lBQ2xFLE9BQU8sS0FBSyxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDdEMsQ0FBQyxDQUFDLE1BQU07UUFVUixFQUFFLENBQUMsU0FBMEIsRUFBRSxRQUFrQztZQUNoRSxPQUFPLEtBQUssQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3RDLENBQUMsQ0FBQyxJQUFJO1FBVU4sSUFBSSxDQUFDLFNBQTBCLEVBQUUsR0FBRyxJQUFXO1lBQzlDLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztRQUN2QyxDQUFDLENBQUMsTUFBTTtNQUVQLEtBQUs7SUE5VU0sT0FBRyxNQThVZixDQUFBO0FBRUYsQ0FBQyxFQTNXYSxHQUFHLEdBQUgsV0FBRyxLQUFILFdBQUcsUUEyV2hCLENBQUMsS0FBSztBQUlQLGtCQUFlLEdBQUcsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuL1JHTE0udHNcIj5cclxuXHJcblwidXNlIHN0cmljdFwiO1xyXG5cclxuZXhwb3J0IHR5cGUgT3B0aW9uYWxzT25seTxUIGV4dGVuZHMgb2JqZWN0PiA9IFBpY2s8VCwgRXhjbHVkZTx7XHJcblx0W0sgaW4ga2V5b2YgVF0/OiBUIGV4dGVuZHMgUmVjb3JkPEssIFRbS10+ID8gbmV2ZXIgOiBLXHJcbn1ba2V5b2YgVF0sIHVuZGVmaW5lZD4+O1xyXG5leHBvcnQgdHlwZSBOb25PcHRpb25hbHM8VCBleHRlbmRzIG9iamVjdD4gPSB7XHJcblx0W2sgaW4ga2V5b2YgVF0tPzogdW5kZWZpbmVkIGV4dGVuZHMgVFtrXSA/IG5ldmVyIDoga1xyXG59W2tleW9mIFRdO1xyXG5leHBvcnQgdHlwZSBOdWxsYWJsZTxUPiA9IFQgfCBudWxsIHwgdW5kZWZpbmVkO1xyXG5leHBvcnQgdHlwZSBOdWxsYWJsZUFycmF5PFQ+ID0gWyBdIHwgVDtcclxuXHJcbmltcG9ydCAqIGFzIGFzc2VydCBmcm9tIFwiYXNzZXJ0XCI7XHJcbmltcG9ydCAqIGFzIGV2ZW50IGZyb20gXCJldmVudHNcIjtcclxuaW1wb3J0ICogYXMgcmVhZGxpbmUgZnJvbSBcInJlYWRsaW5lXCI7XHJcbmltcG9ydCAqIGFzIHR0eSBmcm9tIFwidHR5XCI7XHJcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmcy1leHRyYVwiO1xyXG5pbXBvcnQgKiBhcyBvcyBmcm9tIFwib3NcIjtcclxuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xyXG5pbXBvcnQgKiBhcyByZ2xtIGZyb20gXCIuL1JHTE1cIjtcclxuaW1wb3J0ICogYXMgdXRpbCBmcm9tIFwidXRpbFwiO1xyXG5cclxuZXhwb3J0IG1vZHVsZSByZ2wge1xyXG5cdFxyXG5cdGNvbnN0IGRiZyA9IHV0aWwuZGVidWdsb2coXCJSR0xcIik7XHJcblx0XHJcblx0ZGJnKGBpbnMgJHtfX2Rpcm5hbWV9YCk7XHJcblx0XHJcblx0ZXhwb3J0IGNvbnN0IHNjcm9sbFVwID0gKGJ5OiBudW1iZXIgfCBzdHJpbmcgPSAxKSA9PiBgXFx4MWJbJHtieX1TYCxcclxuXHRcdHNjcm9sbERvd24gPSAoYnk6IG51bWJlciB8IHN0cmluZyA9IDEpID0+IGBcXHgxYlske2J5fVRgLFxyXG5cdFx0c2F2ZSA9IGBcXHgxYjdcXHgxYltzYCxcclxuXHRcdHJlc3RvcmUgPSBgXFx4MWI4XFx4MWJbdWA7XHJcblx0XHJcblx0LyoqXHJcblx0ICogUGFja2FnZSBDb25maWdcclxuXHQgKi9cclxuXHRleHBvcnQgaW50ZXJmYWNlIFJHTENmZyB7XHJcblx0XHRuYW1lOiBzdHJpbmc7XHJcblx0XHRkZXNjcmlwdGlvbj86IHN0cmluZztcclxuXHRcdG1haW46IHN0cmluZztcclxuXHRcdHZlcnNpb24/OiBzdHJpbmc7XHJcblx0XHRtYXBwaW5ncz86IHN0cmluZztcclxuXHRcdGtleXdvcmRzPzogc3RyaW5nW107XHJcblx0XHRcIiRzY2hlbWFcIj86IHN0cmluZztcclxuXHR9IC8vUkdMQ2ZnXHJcblx0XHJcblx0LyoqXHJcblx0ICogTWFpbiBwYWNrYWdpbmcgQ2xhc3NcclxuXHQgKi9cclxuXHRleHBvcnQgY2xhc3MgUkdMIGV4dGVuZHMgZXZlbnQuRXZlbnRFbWl0dGVyIHtcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBUVFkgc3RyZWFtcyBib3VuZCB0byBhcHBcclxuXHRcdCAqL1xyXG5cdFx0cHJpdmF0ZSBfYm91bmQ6IHtcclxuXHRcdFx0c2luPzogdHR5LlJlYWRTdHJlYW0sXHJcblx0XHRcdHNvdXQ/OiB0dHkuV3JpdGVTdHJlYW0sXHJcblx0XHRcdHNlcnI/OiB0dHkuV3JpdGVTdHJlYW0sXHJcblx0XHRcdHNpbmJpbmQ/OiBOdWxsYWJsZTwoa2V5OiBCdWZmZXIpID0+IGFueT4sXHJcblx0XHR9ID0ge1xyXG5cdFx0XHRzaW46IHByb2Nlc3Muc3RkaW4sXHJcblx0XHRcdHNvdXQ6IHByb2Nlc3Muc3Rkb3V0LFxyXG5cdFx0XHRzZXJyOiBwcm9jZXNzLnN0ZGVycixcclxuXHRcdFx0c2luYmluZDogbnVsbCxcclxuXHRcdH07XHJcblx0XHQvKipcclxuXHRcdCAqIFNPVVQgY3Vyc29yIHN0YXRlXHJcblx0XHQgKi9cclxuXHRcdGN1cnNvcjogW251bWJlciwgbnVtYmVyXSA9IFsgMCwgMCBdO1xyXG5cdFx0LyoqXHJcblx0XHQgKiBTb3VyY2Ugb2YgcGFja2FnZSBDb25maWcgaW4gY2FzZSBvZiBmcyBsb2FkXHJcblx0XHQgKi9cclxuXHRcdCNfbG9hZGVkRnJvbTogc3RyaW5nID0gXCJcIjtcclxuXHRcdFxyXG5cdFx0c3RhdGljIHJlYWRvbmx5IGRlZmF1bHRzOiBQYXJ0aWFsPFJHTENmZz4gPSB7XHJcblx0XHRcdGRlc2NyaXB0aW9uOiBcIlwiLFxyXG5cdFx0XHRtYWluOiBcIi4vbWFpbi5qc1wiLFxyXG5cdFx0XHR2ZXJzaW9uOiBcIjAuMVwiLFxyXG5cdFx0XHRtYXBwaW5nczogXCIuL21hcHBpbmdzLmpzXCIsXHJcblx0XHRcdG5hbWU6IHByb2Nlc3MudGl0bGUsXHJcblx0XHRcdGtleXdvcmRzOiBbIF0sXHJcblx0XHRcdFwiJHNjaGVtYVwiOiBwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4uLy4uL3JnbGNmZy5zY2hlbWEuanNvblwiKVxyXG5cdFx0fTtcclxuXHRcdC8qKlxyXG5cdFx0ICogU3BlY2lhbCBrZXlzIGZvciBjb252ZW5pZW5jZVxyXG5cdFx0ICovXHJcblx0XHRzdGF0aWMgcmVhZG9ubHkgc3BlY2lhbF9rZXlzOiB7XHJcblx0XHRcdGN0cmxDOlx0XHRSZWFkb25seTxOb25OdWxsYWJsZTxCdWZmZXI+PjtcclxuXHRcdFx0Y3RybFY6XHRcdFJlYWRvbmx5PE5vbk51bGxhYmxlPEJ1ZmZlcj4+O1xyXG5cdFx0XHR1cDpcdFx0XHRSZWFkb25seTxOb25OdWxsYWJsZTxCdWZmZXI+PjtcclxuXHRcdFx0ZG93bjpcdFx0UmVhZG9ubHk8Tm9uTnVsbGFibGU8QnVmZmVyPj47XHJcblx0XHRcdHJpZ2h0Olx0XHRSZWFkb25seTxOb25OdWxsYWJsZTxCdWZmZXI+PjtcclxuXHRcdFx0bGVmdDpcdFx0UmVhZG9ubHk8Tm9uTnVsbGFibGU8QnVmZmVyPj47XHJcblx0XHRcdGVudGVyOlx0XHRSZWFkb25seTxOb25OdWxsYWJsZTxCdWZmZXI+PjtcclxuXHRcdFx0YmFjazpcdFx0UmVhZG9ubHk8Tm9uTnVsbGFibGU8QnVmZmVyPj47XHJcblx0XHRcdGRlbDpcdFx0UmVhZG9ubHk8Tm9uTnVsbGFibGU8QnVmZmVyPj47XHJcblx0XHRcdHNoaWZ0VXA6XHRSZWFkb25seTxOb25OdWxsYWJsZTxCdWZmZXI+PjtcclxuXHRcdFx0c2hpZnREb3duOlx0UmVhZG9ubHk8Tm9uTnVsbGFibGU8QnVmZmVyPj47XHJcblx0XHRcdHNoaWZ0UmlnaHQ6XHRSZWFkb25seTxOb25OdWxsYWJsZTxCdWZmZXI+PjtcclxuXHRcdFx0c2hpZnRMZWZ0Olx0UmVhZG9ubHk8Tm9uTnVsbGFibGU8QnVmZmVyPj47XHJcblx0XHR9ID0ge1xyXG5cdFx0XHRjdHJsQzpcdFx0QnVmZmVyLmZyb20oXCIwM1wiLFx0XHRcdFwiaGV4XCIpLFxyXG5cdFx0XHRjdHJsVjpcdFx0QnVmZmVyLmZyb20oXCIxNlwiLFx0XHRcdFwiaGV4XCIpLFxyXG5cdFx0XHR1cDpcdFx0XHRCdWZmZXIuZnJvbShcIjFiNWI0MVwiLFx0XHRcImhleFwiKSxcclxuXHRcdFx0ZG93bjpcdFx0QnVmZmVyLmZyb20oXCIxYjViNDJcIixcdFx0XCJoZXhcIiksXHJcblx0XHRcdHJpZ2h0Olx0XHRCdWZmZXIuZnJvbShcIjFiNWI0M1wiLFx0XHRcImhleFwiKSxcclxuXHRcdFx0bGVmdDpcdFx0QnVmZmVyLmZyb20oXCIxYjViNDRcIixcdFx0XCJoZXhcIiksXHJcblx0XHRcdGVudGVyOlx0XHRCdWZmZXIuZnJvbShcIjBkXCIsXHRcdFx0XCJoZXhcIiksIC8vMGFcclxuXHRcdFx0YmFjazpcdFx0QnVmZmVyLmZyb20oXCIwOFwiLFx0XHRcdFwiaGV4XCIpLCAvLytjdHJsSFxyXG5cdFx0XHRkZWw6XHRcdEJ1ZmZlci5mcm9tKFwiMWI1YjMzN2VcIixcdFx0XCJoZXhcIiksXHJcblx0XHRcdHNoaWZ0VXA6XHRCdWZmZXIuZnJvbShcIjFiNWIzMTNiMzI0MVwiLFx0XCJoZXhcIiksXHJcblx0XHRcdHNoaWZ0RG93bjpcdEJ1ZmZlci5mcm9tKFwiMWI1YjMxM2IzMjQyXCIsXHRcImhleFwiKSxcclxuXHRcdFx0c2hpZnRSaWdodDpcdEJ1ZmZlci5mcm9tKFwiMWI1YjMxM2IzMjQzXCIsXHRcImhleFwiKSxcclxuXHRcdFx0c2hpZnRMZWZ0Olx0QnVmZmVyLmZyb20oXCIxYjViMzEzYjMyNDRcIixcdFwiaGV4XCIpLFxyXG5cdFx0XHQvKipcclxuXHRcdFx0ICogQHRvZG8gYWRkIGN0cmwvc2hpZnQgYXJyb3dzKD8pXHJcblx0XHRcdCovXHJcblx0XHR9O1xyXG5cdFx0XHJcblx0XHRjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgY2ZnOiBSR0xDZmcpIHtcclxuXHRcdFx0c3VwZXIoKTtcclxuXHRcdFx0XHJcblx0XHRcdHRoaXMuY2ZnID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5jcmVhdGUobnVsbCksIFJHTC5kZWZhdWx0cyksIGNmZyk7XHJcblx0XHRcdFxyXG5cdFx0XHRhc3NlcnQub2sodGhpcy5jZmcubmFtZSwgXCJSR0wgJ25hbWUnIG11c3QgYmUgcHJvdmlkZWQgaW4gdGhlIGNvbmZpZ1wiKTtcclxuXHRcdFx0XHJcblx0XHRcdHRoaXMuY2ZnLm1haW5cdFx0PSBcIi4vXCIgKyBwYXRoLndpbjMyLm5vcm1hbGl6ZSh0aGlzLmNmZy5tYWluID8/IFwiLi9tYWluLmpzXCIpO1xyXG5cdFx0XHR0aGlzLmNmZy5tYXBwaW5nc1x0PSBcIi4vXCIgKyBwYXRoLndpbjMyLm5vcm1hbGl6ZSh0aGlzLmNmZy5tYXBwaW5ncyA/PyBcIi4vbWFwcGluZ3MuanNcIik7XHJcblx0XHRcdFxyXG5cdFx0XHQvL3Byb2Nlc3Muc3Rkb3V0LndyaXRlKGBcXHgxYl0wOyR7dGhpcy5jZmcubmFtZX1cXGFgKTtcclxuXHRcdFx0cHJvY2Vzcy50aXRsZSA9IHRoaXMuY2ZnLm5hbWUgPz8gcHJvY2Vzcy50aXRsZSA/PyBcIlJHTFwiO1xyXG5cdFx0XHRcclxuXHRcdFx0dGhpcy5wYXJzZU1hcHBpbmdzKCk7XHJcblx0XHR9IC8vY3RvclxyXG5cdFx0XHJcblx0XHRnZXQgZGltZW5zKCk6IFtudW1iZXIsIG51bWJlcl0gfCBbMCwgMF0ge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5zb3V0Py5nZXRXaW5kb3dTaXplKCkgPz8gWzAsIDBdO1xyXG5cdFx0fSAvL2ctZGltZW5zXHJcblx0XHRnZXQgY0RwdCgpOiBudW1iZXIge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5jb2xvckRlcHRoKCk7XHJcblx0XHR9IC8vZy1jRHB0XHJcblx0XHRnZXQgc2VycigpOiB0dHkuV3JpdGVTdHJlYW0ge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fYm91bmQuc2VyciA/PyB0aGlzLl9ib3VuZC5zb3V0ID8/IHByb2Nlc3Muc3RkZXJyO1xyXG5cdFx0fSAvL2ctc2VyclxyXG5cdFx0Z2V0IHNvdXQoKTogdHR5LldyaXRlU3RyZWFtIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2JvdW5kLnNvdXQgPz8gcHJvY2Vzcy5zdGRvdXQ7XHJcblx0XHR9IC8vZy1zb3V0XHJcblx0XHRnZXQgc2luKCk6IHR0eS5SZWFkU3RyZWFtIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2JvdW5kLnNpbiA/PyBwcm9jZXNzLnN0ZGluO1xyXG5cdFx0fSAvL2ctc2luXHJcblx0XHRcclxuXHRcdC8qKlxyXG5cdFx0ICogUGFyc2UgTWFwcGluZ3MgZnJvbSBGaWxlXHJcblx0XHQgKi9cclxuXHRcdHBhcnNlTWFwcGluZ3MoZnJvbTogTnVsbGFibGU8c3RyaW5nPiA9IHRoaXMuY2ZnLm1hcHBpbmdzKTogT2JqZWN0IHtcclxuXHRcdFx0YXNzZXJ0Lm9rKGZyb20sIFwiJ21hcHBpbmdzJyBtdXN0IGJlIGEgdmFsaWQgcGF0aFwiKTtcclxuXHRcdFx0XHJcblx0XHRcdGZyb20gPSBwYXRoLndpbjMyLmpvaW4ocHJvY2Vzcy5jd2QoKSwgZnJvbSk7XHJcblx0XHRcdFxyXG5cdFx0XHRkZWxldGUgcmVxdWlyZS5jYWNoZVtmcm9tXTtcclxuXHRcdFx0XHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0cmV0dXJuIHJnbG0uUkdMTS5SR0xNQ2h1bmsubWFwcGluZ3MgPSByZXF1aXJlKGZyb20pO1xyXG5cdFx0XHR9IGNhdGNoKGUpIHtcclxuXHRcdFx0XHRyZXR1cm4gcmdsbS5SR0xNLlJHTE1DaHVuay5tYXBwaW5ncyA9IHJlcXVpcmUocGF0aC5qb2luKF9fZGlybmFtZSwgXCIuLi8uLi9tYXBwaW5ncy5qc1wiKSk7XHJcblx0XHRcdH1cclxuXHRcdH0gLy9wYXJzZU1hcHBpbmdzXHJcblx0XHRcclxuXHRcdC8qKlxyXG5cdFx0ICogQ2FwdHVyZSBrZXlzIGZyb20gU0lOXHJcblx0XHQgKi9cclxuXHRcdGNhcHR1cmUod2hpY2g6IHR0eS5SZWFkU3RyZWFtID0gdGhpcy5zaW4sIGJpbmQgPSB0cnVlLCBvdXQ6IHR0eS5Xcml0ZVN0cmVhbSA9IHRoaXMuc291dCwgZXJyOiB0dHkuV3JpdGVTdHJlYW0gPSB0aGlzLnNlcnIpOiBib29sZWFuIHtcclxuXHRcdFx0YXNzZXJ0Lm9rKHdoaWNoLmlzVFRZICYmIG91dC5pc1RUWSAmJiBlcnIuaXNUVFksIFwiU3RyZWFtIG11c3QgYmUgVFRZXCIpO1xyXG5cdFx0XHRcclxuXHRcdFx0aWYgKCh3aGljaC5pc1JhdyAmJiAhYmluZCkgfHwgKCF3aGljaC5pc1JhdyAmJiBiaW5kKSkgd2hpY2guc2V0UmF3TW9kZShiaW5kKTtcclxuXHRcdFx0XHJcblx0XHRcdGlmICh0aGlzLl9ib3VuZC5zaW5iaW5kICYmIHRoaXMuX2JvdW5kLnNpbikge1xyXG5cdFx0XHRcdHRoaXMuX2JvdW5kLnNpbiEucmVtb3ZlTGlzdGVuZXIoXCJkYXRhXCIsIHRoaXMuX2JvdW5kLnNpbmJpbmQhKTtcclxuXHRcdFx0XHR0aGlzLl9ib3VuZC5zaW5iaW5kID0gbnVsbDtcclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0aWYgKHdoaWNoLmlzUmF3KSB7XHJcblx0XHRcdFx0d2hpY2gub24oXCJkYXRhXCIsIHRoaXMuX2JvdW5kLnNpbmJpbmQgPSAoa2V5OiBCdWZmZXIpID0+IHtcclxuXHRcdFx0XHRcdHRoaXMuZW1pdChcInJhd2tleVwiLCBrZXksIGtleS5sZW5ndGggPiAxICYmIGtleVswXSA9PSAweDFiLCBrZXkubGVuZ3RoID4gMSA/IGtleS5zbGljZSgxKSA6IGtleS5zbGljZSgwKSk7XHJcblx0XHRcdFx0XHR0aGlzLmVtaXQoXCJyYXdjdHJsa2V5XCIsIGtleSwgQnVmZmVyLmZyb20oWyhBcnJheS5mcm9tKGtleS52YWx1ZXMoKSkucG9wKCkgPz8gMCkgKyAweDYxIC0gMV0pLCBrZXkubGVuZ3RoID4gMSAmJiBrZXlbMF0gPT0gMHgxYiwga2V5Lmxlbmd0aCA+IDEgPyBrZXkuc2xpY2UoMSkgOiBrZXkuc2xpY2UoMCkpO1xyXG5cdFx0XHRcdFx0dGhpcy5lbWl0KFwia2V5XCIsIGtleS50b1N0cmluZyhcInV0ZjhcIiksIGtleS5sZW5ndGggPiAxICYmIGtleVswXSA9PSAweDFiLCAoa2V5Lmxlbmd0aCA+IDEgPyBrZXkuc2xpY2UoMSkgOiBrZXkuc2xpY2UoMCkpLnRvU3RyaW5nKFwidXRmOFwiKSk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHRcdHRoaXMuX2JvdW5kLnNpbiA9IHdoaWNoO1xyXG5cdFx0XHR0aGlzLl9ib3VuZC5zb3V0ID0gb3V0O1xyXG5cdFx0XHR0aGlzLl9ib3VuZC5zZXJyID0gZXJyO1xyXG5cdFx0XHRcclxuXHRcdFx0dGhpcy5lbWl0KFwiZGVidWdcIiwgYFRUWSBzZXQgdG8gJHtiaW5kfWApO1xyXG5cdFx0XHRcclxuXHRcdFx0cmV0dXJuIHdoaWNoLmlzUmF3O1xyXG5cdFx0fSAvL2NhcHR1cmVcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBMb2FkIHBhY2thZ2UgQ29uZmlnIGZyb20gRmlsZVxyXG5cdFx0ICovXHJcblx0XHRzdGF0aWMgYXN5bmMgbG9hZChmcm9tOiBzdHJpbmcgfCBSR0xDZmcgPSBcIi4vcGFja2FnZS5qc29uXCIpOiBQcm9taXNlPFJHTD4ge1xyXG5cdFx0XHRpZiAodHlwZW9mIGZyb20gPT0gXCJzdHJpbmdcIikge1xyXG5cdFx0XHRcdGZyb20gPSBwYXRoLndpbjMyLnJlc29sdmUoZnJvbSk7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0bGV0IG91dDogUkdMID0gbmV3IFJHTChhd2FpdCBmcy5yZWFkSlNPTihmcm9tLCB7XHJcblx0XHRcdFx0XHRlbmNvZGluZzogXCJhc2NpaVwiLFxyXG5cdFx0XHRcdFx0ZmxhZzogXCJyXCJcclxuXHRcdFx0XHR9KSk7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0b3V0LiNfbG9hZGVkRnJvbSA9IGZyb207XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0cmV0dXJuIG91dDtcclxuXHRcdFx0fSBlbHNlIHJldHVybiBuZXcgUkdMKGZyb20pO1xyXG5cdFx0fSAvL2xvYWRcclxuXHRcdC8qKlxyXG5cdFx0ICogU3RvcmUgcGFja2FnZSBDb25maWcgdG8gRmlsZVxyXG5cdFx0ICovXHJcblx0XHRhc3luYyBzdG9yZSh0bzogc3RyaW5nID0gdGhpcy4jX2xvYWRlZEZyb20gPz8gXCIuL3BhY2thZ2UuanNvblwiLCByZXBsPzogKCh0aGlzOiBhbnksIGtleTogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKSA9PiBhbnkpLCBwYWQ6IG51bWJlciA9IDIpOiBQcm9taXNlPGFueT4ge1xyXG5cdFx0XHRhc3NlcnQub2sodG8gJiYgdHlwZW9mIHRvID09IFwic3RyaW5nXCIsIFwiJ2NvbmZpZycgbXVzdCBiZSBhIHZhbGlkIHBhdGhcIik7XHJcblx0XHRcdFxyXG5cdFx0XHRyZXR1cm4gYXdhaXQgZnMud3JpdGVKU09OKHRvLCB0aGlzLmNmZywge1xyXG5cdFx0XHRcdEVPTDogb3MuRU9MLFxyXG5cdFx0XHRcdGVuY29kaW5nOiBcImFzY2lpXCIsXHJcblx0XHRcdFx0bW9kZTogMG83NzUsXHJcblx0XHRcdFx0c3BhY2VzOiBwYWQsXHJcblx0XHRcdFx0cmVwbGFjZXI6IHJlcGwsXHJcblx0XHRcdFx0ZmxhZzogXCJ3XCJcclxuXHRcdFx0fSk7XHJcblx0XHR9IC8vc3RvcmVcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBMYXVuY2ggcGFja2FnZSBlbnRyeVxyXG5cdFx0ICovXHJcblx0XHRleGVjKGZyb206IE51bGxhYmxlPHN0cmluZz4gPSB0aGlzLmNmZy5tYWluID8/IFwiLi9tYWluLmpzXCIpOiBhbnl7XHJcblx0XHRcdGFzc2VydC5vayhmcm9tLCBcIidtYWluJyBtdXN0IGJlIGEgdmFsaWQgcGF0aFwiKTtcclxuXHRcdFx0XHJcblx0XHRcdGZyb20gPSBwYXRoLndpbjMyLmpvaW4ocHJvY2Vzcy5jd2QoKSwgZnJvbSk7XHJcblx0XHRcdFxyXG5cdFx0XHRkZWxldGUgcmVxdWlyZS5jYWNoZVtmcm9tXTtcclxuXHRcdFx0XHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0cmV0dXJuIHJlcXVpcmUoZnJvbSkodGhpcywgbW9kdWxlKTtcclxuXHRcdFx0fSBjYXRjaChlKSB7XHJcblx0XHRcdFx0cmV0dXJuIHJlcXVpcmUocGF0aC53aW4zMi5qb2luKHByb2Nlc3MuY3dkKCksIFwiLi9tYWluLmpzXCIpKSh0aGlzLCBtb2R1bGUpO1xyXG5cdFx0XHR9XHJcblx0XHR9IC8vZXhlY1xyXG5cdFx0XHJcblx0XHQvKipcclxuXHRcdCAqIFdyaXRlLWFuZC1jb3VudCB0byBTT1VUXHJcblx0XHQgKi9cclxuXHRcdHdyaXRlKGQ6IHN0cmluZyB8IFVpbnQ4QXJyYXkgfCBCdWZmZXIsIC4uLmRhdGE6IChzdHJpbmcgfCBVaW50OEFycmF5KVtdKTogYm9vbGVhbiB7XHJcblx0XHRcdGlmIChkIGluc3RhbmNlb2YgQnVmZmVyKSBkID0gZC50b1N0cmluZyhcImFzY2lpXCIpO1xyXG5cdFx0XHRlbHNlIGlmIChkIGluc3RhbmNlb2YgVWludDhBcnJheSkgZCA9IGQuam9pbignJyk7XHJcblx0XHRcdFxyXG5cdFx0XHRkID0gZC5yZXBsYWNlQWxsKCdcXHQnLCAnICcucmVwZWF0KDQpKS5yZXBsYWNlQWxsKC8oKD88IVxccilcXG4oPyFcXHIpfCg/PCFcXG4pXFxyKD8hXFxuKXxcXHJcXG58XFxuXFxyKS9nbWlzLCAnXFxuJyk7XHJcblx0XHRcdFxyXG5cdFx0XHRjb25zdCBjaHM6IHN0cmluZ1tdID0gZC50b1N0cmluZygpLnNwbGl0KCdcXG4nKSxcclxuXHRcdFx0XHRsZW46IG51bWJlciA9IGNocy5sZW5ndGggLSAxO1xyXG5cdFx0XHRcclxuXHRcdFx0aWYgKGxlbiA+PSAxKSB0aGlzLmN1cnNvclswXSA9IGNoc1tsZW5dLmxlbmd0aDtcclxuXHRcdFx0ZWxzZSB0aGlzLmN1cnNvclswXSArPSBjaHNbbGVuXS5sZW5ndGg7XHJcblx0XHRcdFxyXG5cdFx0XHR0aGlzLmN1cnNvclswXSAlPSB0aGlzLnNvdXQuY29sdW1ucztcclxuXHRcdFx0dGhpcy5jdXJzb3JbMV0gPSBNYXRoLm1pbih0aGlzLmN1cnNvclsxXSArIGxlbiwgdGhpcy5zb3V0LnJvd3MpO1xyXG5cdFx0XHRcclxuXHRcdFx0Y29uc3Qgb3V0OiBib29sZWFuID0gdGhpcy5zb3V0LndyaXRlKGQpO1xyXG5cdFx0XHRcclxuXHRcdFx0dGhpcy5lbWl0KFwid3JpdGVcIiwgZCk7XHJcblx0XHRcdFxyXG5cdFx0XHRpZiAoIW91dCkgcHJvY2Vzcy5uZXh0VGljaygoKSA9PiB0aGlzLnNvdXQudW5jb3JrKCkpO1xyXG5cdFx0XHRcclxuXHRcdFx0ZGF0YS5mb3JFYWNoKGR0ID0+IHRoaXMud3JpdGUoZHQpKTtcclxuXHRcdFx0XHJcblx0XHRcdHJldHVybiBvdXQ7XHJcblx0XHR9IC8vd3JpdGVcclxuXHRcdC8qKlxyXG5cdFx0ICogV3JpdGUtYW5kLWNvdW50LW5ld2xpbmUgdG8gU09VVFxyXG5cdFx0ICovXHJcblx0XHR3cml0ZUUoLi4uZGF0YTogKHN0cmluZyB8IFVpbnQ4QXJyYXkgfCBCdWZmZXIpW10pOiBib29sZWFuIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMud3JpdGUoZGF0YS5zaGlmdCgpISwgLi4uZGF0YSwgb3MuRU9MKTtcclxuXHRcdH0gLy93cml0ZUVcclxuXHRcdFxyXG5cdFx0LyoqXHJcblx0XHQgKiBHZXQgVFRZIGNvbG9yIGRlcHRoXHJcblx0XHQgKi9cclxuXHRcdGNvbG9yRGVwdGgoZW52OiBOb2RlSlMuUHJvY2Vzc0VudiA9IHByb2Nlc3MuZW52KTogbnVtYmVyIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuc291dC5nZXRDb2xvckRlcHRoKGVudik7XHJcblx0XHR9IC8vY29sb3JEZXB0aFxyXG5cdFx0XHJcblx0XHQvKipcclxuXHRcdCAqIE1vdmUtYW5kLWNvdW50IFNPVVQgY3Vyc29yXHJcblx0XHQgKi9cclxuXHRcdGFzeW5jIG1vdmUoeDogbnVtYmVyLCB5PzogbnVtYmVyLCByZWw6IGJvb2xlYW4gPSBmYWxzZSk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG5cdFx0XHRpZiAoIXJlbCkgeCA9IE1hdGgubWluKE1hdGgubWF4KHgsIDApLCB0aGlzLmRpbWVuc1swXSk7XHJcblx0XHRcdGVsc2UgeCA9IE1hdGgubWluKE1hdGgubWF4KHgsIC10aGlzLmRpbWVuc1swXSksIHRoaXMuZGltZW5zWzBdKTtcclxuXHRcdFx0aWYgKCFyZWwgJiYgeSkgeSA9IE1hdGgubWluKE1hdGgubWF4KHksIDApLCB0aGlzLmRpbWVuc1sxXSk7XHJcblx0XHRcdGVsc2UgaWYgKHJlbCAmJiB5KSB5ID0gTWF0aC5taW4oTWF0aC5tYXgoeSwgLXRoaXMuZGltZW5zWzFdKSwgdGhpcy5kaW1lbnNbMV0pO1xyXG5cdFx0XHRcclxuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xyXG5cdFx0XHRcdGxldCBkYXRhOiBib29sZWFuO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdHRoaXMuZW1pdChcIm1vdmVcIiwgeCwgeSwgcmVsKTtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRpZiAoIXJlbCkge1xyXG5cdFx0XHRcdFx0dGhpcy5jdXJzb3JbMF0gPSB4O1xyXG5cdFx0XHRcdFx0dGhpcy5jdXJzb3JbMV0gPSB5ID8/IHRoaXMuY3Vyc29yWzFdO1xyXG5cdFx0XHRcdFx0ZGF0YSA9IHJlYWRsaW5lLmN1cnNvclRvKHRoaXMuc291dCwgeCwgeSwgKCkgPT4gcmVzKGRhdGEpKTtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0aWYgKHgpIHRoaXMuY3Vyc29yWzBdICs9IHg7XHJcblx0XHRcdFx0XHRpZiAoeSkgdGhpcy5jdXJzb3JbMV0gKz0geTtcclxuXHRcdFx0XHRcdGRhdGEgPSByZWFkbGluZS5tb3ZlQ3Vyc29yKHRoaXMuc291dCwgeCwgeSA/PyAwLCAoKSA9PiByZXMoZGF0YSkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9IC8vbW92ZVxyXG5cdFx0LyoqXHJcblx0XHQgKiBDbGVhci1hbmQtcmVzdG9yZSBTT1VUXHJcblx0XHQgKi9cclxuXHRcdGFzeW5jIGNsZWFyKGxpbmVzPzogbnVtYmVyW10gfCBudW1iZXIsIGRpcjogdHR5LkRpcmVjdGlvbiA9IDAsIHJlbD86IGJvb2xlYW4pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXMsIHJlaikgPT4ge1xyXG5cdFx0XHRcdGNvbnN0IHNhdjogW251bWJlciwgbnVtYmVyXSA9IFsuLi50aGlzLmN1cnNvcl07XHJcblx0XHRcdFx0bGV0IG91dDogYm9vbGVhbiA9IHRydWU7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0aWYgKCFsaW5lcykge1xyXG5cdFx0XHRcdFx0dGhpcy5tb3ZlKDAsIDAsIHJlbCkudGhlbigoKSA9PiB7XHJcblx0XHRcdFx0XHRcdG91dCA9IHJlYWRsaW5lLmNsZWFyU2NyZWVuRG93bih0aGlzLnNvdXQsICgpID0+IHtcclxuXHRcdFx0XHRcdFx0XHR0aGlzLm1vdmUoLi4uc2F2LCBmYWxzZSkudGhlbigoKSA9PiByZXMob3V0KSk7XHJcblx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YgbGluZXMgPT0gXCJudW1iZXJcIiAmJiBsaW5lcyA8IDApXHJcblx0XHRcdFx0XHRvdXQgPSByZWFkbGluZS5jbGVhckxpbmUodGhpcy5zb3V0LCBkaXIsICgpID0+IHtcclxuXHRcdFx0XHRcdFx0dGhpcy5tb3ZlKC4uLnNhdiwgZmFsc2UpLnRoZW4oKCkgPT4gcmVzKG91dCkpO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0ZWxzZSBpZiAodHlwZW9mIGxpbmVzID09IFwibnVtYmVyXCIpIHtcclxuXHRcdFx0XHRcdHRoaXMubW92ZSgwLCBsaW5lcywgcmVsKS50aGVuKCgpID0+IHtcclxuXHRcdFx0XHRcdFx0b3V0ID0gcmVhZGxpbmUuY2xlYXJMaW5lKHRoaXMuc291dCwgZGlyLCAoKSA9PiB7XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5tb3ZlKC4uLnNhdiwgZmFsc2UpLnRoZW4oKCkgPT4gcmVzKG91dCkpO1xyXG5cdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH0gZWxzZVxyXG5cdFx0XHRcdFx0cmV0dXJuIFByb21pc2UuYWxsKGxpbmVzLm1hcChsID0+IHRoaXMuY2xlYXIobCwgZGlyLCByZWwpKSkudGhlbihicyA9PiByZXMoYnMuZXZlcnkoYiA9PiBiKSksIHJlaik7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0dGhpcy5lbWl0KFwiY2xlYXJcIiwgbGluZXMsIGRpciwgcmVsLCBvdXQpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH0gLy9jbGVhclxyXG5cdFx0XHJcblx0XHRvbmNlKGV2ZW50bmFtZTogXCJsb2dcIiwgbGlzdGVuZXI6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCk6IHRoaXM7XHJcblx0XHRvbmNlKGV2ZW50bmFtZTogXCJkZWJ1Z1wiLCBsaXN0ZW5lcjogKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkKTogdGhpcztcclxuXHRcdG9uY2UoZXZlbnRuYW1lOiBcImNsZWFyXCIsIGxpc3RlbmVyOiAobGluZXM6IG51bWJlciwgZGlyOiB0dHkuRGlyZWN0aW9uLCByZWw6IGJvb2xlYW4sIG91dDogYm9vbGVhbikgPT4gdm9pZCk6IHRoaXM7XHJcblx0XHRvbmNlKGV2ZW50bmFtZTogXCJ3cml0ZVwiLCBsaXN0ZW5lcjogKGQ6IHN0cmluZyB8IFVpbnQ4QXJyYXkpID0+IHZvaWQpOiB0aGlzO1xyXG5cdFx0b25jZShldmVudG5hbWU6IFwibW92ZVwiLCBsaXN0ZW5lcjogKHg6IG51bWJlciwgeTogbnVtYmVyLCByZWw6IGJvb2xlYW4pID0+IHZvaWQpOiB0aGlzO1xyXG5cdFx0b25jZShldmVudG5hbWU6IFwia2V5XCIsIGxpc3RlbmVyOiAoa2V5OiBzdHJpbmcsIGlzYWx0OiBib29sZWFuLCBzOiBzdHJpbmcpID0+IHZvaWQpOiB0aGlzO1xyXG5cdFx0b25jZShldmVudG5hbWU6IFwicmF3a2V5XCIsIGxpc3RlbmVyOiAoa2V5OiBCdWZmZXIsIGlzYWx0OiBib29sZWFuLCBzOiBCdWZmZXIpID0+IHZvaWQpOiB0aGlzO1xyXG5cdFx0b25jZShldmVudG5hbWU6IFwicmF3Y3RybGtleVwiLCBsaXN0ZW5lcjogKGtleTogQnVmZmVyLCBjdHJsa2V5OiBCdWZmZXIsIGlzYWx0OiBib29sZWFuLCBzOiBCdWZmZXIpID0+IHZvaWQpOiB0aGlzO1xyXG5cdFx0b25jZShldmVudG5hbWU6IHN0cmluZyB8IHN5bWJvbCwgbGlzdGVuZXI6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCk6IHRoaXM7XHJcblx0XHRvbmNlKGV2ZW50bmFtZTogc3RyaW5nIHwgc3ltYm9sLCBsaXN0ZW5lcjogKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkKTogdGhpcyB7XHJcblx0XHRcdHJldHVybiBzdXBlci5vbihldmVudG5hbWUsIGxpc3RlbmVyKTtcclxuXHRcdH0gLy9vbmNlXHJcblx0XHRvbihldmVudG5hbWU6IFwibG9nXCIsIGxpc3RlbmVyOiAoLi4uYXJnczogYW55W10pID0+IHZvaWQpOiB0aGlzO1xyXG5cdFx0b24oZXZlbnRuYW1lOiBcImRlYnVnXCIsIGxpc3RlbmVyOiAoLi4uYXJnczogYW55W10pID0+IHZvaWQpOiB0aGlzO1xyXG5cdFx0b24oZXZlbnRuYW1lOiBcImNsZWFyXCIsIGxpc3RlbmVyOiAobGluZXM6IG51bWJlciwgZGlyOiB0dHkuRGlyZWN0aW9uLCByZWw6IGJvb2xlYW4sIG91dDogYm9vbGVhbikgPT4gdm9pZCk6IHRoaXM7XHJcblx0XHRvbihldmVudG5hbWU6IFwid3JpdGVcIiwgbGlzdGVuZXI6IChkOiBzdHJpbmcgfCBVaW50OEFycmF5KSA9PiB2b2lkKTogdGhpcztcclxuXHRcdG9uKGV2ZW50bmFtZTogXCJtb3ZlXCIsIGxpc3RlbmVyOiAoeDogbnVtYmVyLCB5OiBudW1iZXIsIHJlbDogYm9vbGVhbikgPT4gdm9pZCk6IHRoaXM7XHJcblx0XHRvbihldmVudG5hbWU6IFwia2V5XCIsIGxpc3RlbmVyOiAoa2V5OiBzdHJpbmcsIGlzYWx0OiBib29sZWFuLCBzOiBzdHJpbmcpID0+IHZvaWQpOiB0aGlzO1xyXG5cdFx0b24oZXZlbnRuYW1lOiBcInJhd2tleVwiLCBsaXN0ZW5lcjogKGtleTogQnVmZmVyLCBpc2FsdDogYm9vbGVhbiwgczogQnVmZmVyKSA9PiB2b2lkKTogdGhpcztcclxuXHRcdG9uKGV2ZW50bmFtZTogXCJyYXdjdHJsa2V5XCIsIGxpc3RlbmVyOiAoa2V5OiBCdWZmZXIsIGN0cmxrZXk6IEJ1ZmZlciwgaXNhbHQ6IGJvb2xlYW4sIHM6IEJ1ZmZlcikgPT4gdm9pZCk6IHRoaXM7XHJcblx0XHRvbihldmVudG5hbWU6IHN0cmluZyB8IHN5bWJvbCwgbGlzdGVuZXI6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCk6IHRoaXM7XHJcblx0XHRvbihldmVudG5hbWU6IHN0cmluZyB8IHN5bWJvbCwgbGlzdGVuZXI6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCk6IHRoaXMge1xyXG5cdFx0XHRyZXR1cm4gc3VwZXIub24oZXZlbnRuYW1lLCBsaXN0ZW5lcik7XHJcblx0XHR9IC8vb25cclxuXHRcdGVtaXQoZXZlbnRuYW1lOiBcImxvZ1wiLCAuLi5hcmdzOiBhbnlbXSk6IGFueTtcclxuXHRcdGVtaXQoZXZlbnRuYW1lOiBcImRlYnVnXCIsIC4uLmFyZ3M6IGFueVtdKTogYW55O1xyXG5cdFx0ZW1pdChldmVudG5hbWU6IFwiY2xlYXJcIiwgbGluZXM6IG51bWJlciwgZGlyOiB0dHkuRGlyZWN0aW9uLCByZWw6IGJvb2xlYW4sIG91dDogYm9vbGVhbik6IGFueTtcclxuXHRcdGVtaXQoZXZlbnRuYW1lOiBcIndyaXRlXCIsIGQ6IHN0cmluZyB8IFVpbnQ4QXJyYXkpOiBzdHJpbmc7XHJcblx0XHRlbWl0KGV2ZW50bmFtZTogXCJtb3ZlXCIsIHg6IG51bWJlciwgeTogbnVtYmVyLCByZWw6IGJvb2xlYW4pOiBib29sZWFuO1xyXG5cdFx0ZW1pdChldmVudG5hbWU6IFwia2V5XCIsIGtleTogc3RyaW5nLCBpc2FsdDogYm9vbGVhbiwgczogc3RyaW5nKTogc3RyaW5nO1xyXG5cdFx0ZW1pdChldmVudG5hbWU6IFwicmF3a2V5XCIsIGtleTogQnVmZmVyLCBpc2FsdDogYm9vbGVhbiwgczogQnVmZmVyKTogQnVmZmVyO1xyXG5cdFx0ZW1pdChldmVudG5hbWU6IFwicmF3Y3RybGtleVwiLCBrZXk6IEJ1ZmZlciwgY3RybGtleTogQnVmZmVyLCBpc2FsdDogYm9vbGVhbiwgczogQnVmZmVyKTogQnVmZmVyO1xyXG5cdFx0ZW1pdChldmVudG5hbWU6IHN0cmluZyB8IHN5bWJvbCwgLi4uYXJnczogYW55W10pOiBib29sZWFuO1xyXG5cdFx0ZW1pdChldmVudG5hbWU6IHN0cmluZyB8IHN5bWJvbCwgLi4uYXJnczogYW55W10pOiBhbnkge1xyXG5cdFx0XHRyZXR1cm4gc3VwZXIuZW1pdChldmVudG5hbWUsIC4uLmFyZ3MpO1xyXG5cdFx0fSAvL2VtaXRcclxuXHRcdFxyXG5cdH0gLy9SR0xcclxuXHRcclxufSAvL3JnbFxyXG5cclxuZXhwb3J0IHsgcmdsbSB9O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgcmdsO1xyXG4iXX0=