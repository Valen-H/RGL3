#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const mod = tslib_1.__importStar(require("../lib/rgl"));
const path = tslib_1.__importStar(require("path"));
const util = tslib_1.__importStar(require("util"));
const os = tslib_1.__importStar(require("os"));
const chalk_1 = tslib_1.__importDefault(require("chalk"));
let qtcn = false, Rgl, map, gout, cur = [0, 0];
function help() {
    return `Commands:
	h			-	Display this help screen
	d			-	Display Map
	c			-	Clear Screen
	s			-	Save Map
	l			-	Load Map
	r			-	Resize Map (Very Important to do first!!)
	t			-	Trim leftovers after resize
	ev[cd		-	Evaluate code
	m			-	Set/Get Metadata
	mv		   -	Move Cursor (can also use keyboard arrows)
	mov[udrl]	-	Move Line
	d[cr]		-	Delete Column/Row and resize
	[ch,1,2,3	-	Place Chunk
	ctrl-C/qt	-	Quit

Separate Commands with '.' (dot)
Pass parameters with X[arg,...
Hit ENTER to execute (or alt-enter to persist)
Access command history with shift+up/down`;
} //help
function move(x = cur[0], y = cur[1]) {
    let t;
    if (t = map.get(...cur))
        t.onrender = (_idx, c) => c.chr ? c.print : ' ';
    cur[0] = x % (map.dimens[0] || 1);
    cur[1] = y % (map.dimens[1] || 1);
    while (cur[0] < 0)
        cur[0] += map.dimens[0];
    while (cur[1] < 0)
        cur[1] += map.dimens[1];
    if (t = map.get(...cur))
        t.onrender = (_idx, _c) => chalk_1.default.inverse.italic.bold.italic('@');
    return cur;
} //move
function moveBy(dx = 0, dy = 0) {
    return move(cur[0] + dx, cur[1] + dy);
} //moveBy
async function render() {
    await command('c');
    await map.stamp();
} //render
function pad(n = map.dimens[0] * map.dimens[1], wild = false) {
    while (map.chunks.length < n) {
        const p = mod.rglm.RGLM.RGLMChunk.blank();
        map.chunks.push(p);
        p.onrender = (_idx, c) => c.chr ? c.print : ' ';
    }
    while (n < map.chunks.length) {
        if (wild || !map.chunks[map.chunks.length - 1].chr)
            map.chunks.pop();
        else
            break;
    }
    return command("d");
} //pad
function patch() {
    return map.chunks.forEach((c) => c.onrender = (_idx, c) => c.chr ? c.print : ' ');
} //patch
function quit() {
    if (!qtcn) {
        Rgl.writeE("Press Quit again.");
        qtcn = true;
        setTimeout(() => (qtcn = false), 2000);
    }
    else {
        Rgl.writeE("Quit.");
        process.exit(1);
    }
} //quit
async function command(acc) {
    let comm = acc.split(/(?<!\\)\./gmi).map(c => c.replaceAll(/(?<!\\)\\/gmi, '').replaceAll("\\\\", "\\"));
    for (const com of comm) {
        const args = (com.match(/\[(.+)$/mis) || [])[1], noarg = com.replace(/\[.*$/mis, "");
        if (/^h(?:elp)?/is.test(com))
            Rgl.writeE(help());
        else if (/^d(?:is(?:p(?:l(?:ay)?)?)?)?(?:\[|$)/is.test(com))
            await render();
        else if (/^c(?:l(?:(?:ea)?[rn])?)?(?:\[|$)/is.test(com))
            await Rgl.clear();
        else if (/^e(?:v(?:a?l(?:uate)?)?)?(?:\[|$)/is.test(com)) {
            Rgl.writeE(util.inspect(await eval(args ?? "")));
        }
        else if (/^(?:q(?:(?:ui)?t)?|e(?:(?:xi)?t)?)(?:\[|$)/is.test(com))
            quit();
        else if (/^s(?:ave?|to?re?)?(?:\[|$)/is.test(com)) {
            await map.store(args);
            Rgl.writeE("Map saved.");
        }
        else if (/^(?:re?)?l(?:(?:oa)?d)?(?:\[|$)/is.test(com)) {
            map = await mod.rglm.RGLM.RGLMap.parse(args || gout, Rgl);
            patch();
            Rgl.writeE("Map loaded.");
        }
        else if (/^re?(?:s(?:i?ze?)?)?(?:\[|$)/is.test(com)) {
            if (args) {
                const s = args.split(',').map(Number);
                map.dimens[0] = Math.max(typeof s[0] == "number" ? s[0] : map.dimens[0], 0);
                map.dimens[1] = Math.max(typeof s[1] == "number" ? s[1] : map.dimens[1], 0);
                await pad();
            }
            Rgl.writeE(`Size: ${map.dimens.join(", ")}\tCursor: ${cur.join(", ")}`);
        }
        else if (/^t(?:ri?m)?/is.test(com)) {
            const s = args ? Number(args) : (map.dimens[0] * map.dimens[1]);
            await pad(s, true);
        }
        else if (/^m(?:eta?(?:da?ta?)?)?(?:\[|$)/is.test(com)) {
            const s = (args ?? "").split('=');
            if (s.length >= 2) {
                map.meta[s[0]] = s[1] ?? "";
                command(`meta[${s[0]}`);
            }
            else if (s.length && s[0])
                Rgl.writeE(s[0], " = ", map.meta[s[0]] ?? "");
            else
                Rgl.writeE(Array.from(Object.entries(map.meta || {}).map(e => "- " + e.join(" = "))).join(os.EOL));
        }
        else if (/^m(?:ove?|v)?(?:\[|$)/is.test(com)) {
            move(...(args ?? "0,0").split(',').map(Number));
            command("d.r");
        }
        else if (/^m(?:ove?|v)?up?(?:\[|$)/is.test(com)) {
            let by = -1;
            if (args)
                by = -Number(args);
            let t = by + cur[1];
            while (t < 0)
                t += map.dimens[1];
            t = t % map.dimens[1];
            if (t != cur[1])
                for (let x = 0; x < map.dimens[0]; x++)
                    map.swap(map.get(x, cur[1]), map.get(x, t));
            moveBy(0, by);
            command("d");
        }
        else if (/^m(?:ove?|v)?d(?:o?wn)?(?:\[|$)/is.test(com)) {
            let by = 1;
            if (args)
                by = Number(args);
            let t = by + cur[1];
            while (t < 0)
                t += map.dimens[1];
            t = t % map.dimens[1];
            if (t != cur[1])
                for (let x = 0; x < map.dimens[0]; x++)
                    map.swap(map.get(x, cur[1]), map.get(x, t));
            moveBy(0, by);
            command("d");
        }
        else if (/^m(?:ove?|v)?r(?:i?gh?t)?(?:\[|$)/is.test(com)) {
            let by = 1;
            if (args)
                by = Number(args);
            let t = by + cur[0];
            while (t < 0)
                t += map.dimens[0];
            t = t % map.dimens[0];
            if (t != cur[0])
                for (let y = 0; y < map.dimens[1]; y++)
                    map.swap(map.get(cur[0], y), map.get(t, y));
            moveBy(by);
            command("d");
        }
        else if (/^m(?:ove?|v)?l(?:e?ft)?(?:\[|$)/is.test(com)) {
            let by = -1;
            if (args)
                by = -Number(args);
            let t = by + cur[0];
            while (t < 0)
                t += map.dimens[0];
            t = t % map.dimens[0];
            if (t != cur[0])
                for (let y = 0; y < map.dimens[1]; y++)
                    map.swap(map.get(cur[0], y), map.get(t, y));
            moveBy(by);
            command("d");
        }
        else if (/^d(?:e?l(?:e?te?))?r(?:o?w)?(?:\[|$)/is.test(com)) {
            map.place([], 0, cur[1], map.dimens[0]);
            moveBy();
            await command(`d.r[${map.dimens[0]},${Math.max(map.dimens[1] - 1, 0)}`);
            if (Number(args ?? 0) > 1)
                await command("dr.".repeat(Number(args) - 1));
        }
        else if (/^d(?:e?l(?:e?te?))?c(?:o?l(?:u?mn)?)?(?:\[|$)/is.test(com)) {
            let dellist = [];
            for (let i = 0; i < map.dimens[1]; i++) {
                const t = map.get(cur[0], i);
                if (!t)
                    continue;
                t.onrender = (_idx, c) => c.print;
                dellist.push(t);
            }
            moveBy();
            dellist.forEach(d => map.place([], ...map.calcChkCrd(d)));
            await command(`d.r[${Math.max(map.dimens[0] - 1, 0)},${map.dimens[1]}`);
            if (Number(args ?? 0) > 1)
                await command("dc.".repeat(Number(args) - 1));
        }
        else if (/^del(?:ete)?(?:\[|$)/is.test(com)) {
            Rgl.writeE("Unimplemented");
        }
        else if (/^b(?:l(?:an)?k)?r(?:o?w)?(?:\[|$)/is.test(com)) {
            Rgl.writeE("Unimplemented");
        }
        else if (/^b(?:l(?:an)?k)?c(?:o?l(?:u?mn)?)?(?:\[|$)/is.test(com)) {
            Rgl.writeE("Unimplemented");
        }
        else if (/^b(?:l(?:an)?k)?(?:\[|$)/is.test(com)) {
            Rgl.writeE("Unimplemented");
        }
        else if (/^sw(?:a?p)?(?:\[|$)/is.test(com)) {
            Rgl.writeE("Unimplemented");
        }
        else if (/^s(?:hi?ft?)?r(?:o?w)?(?:\[|$)/is.test(com)) {
            Rgl.writeE("Unimplemented");
        }
        else if (/^s(?:hi?ft?)?c(?:o?l(?:u?mn)?)?(?:\[|$)/is.test(com)) {
            Rgl.writeE("Unimplemented");
        }
        else if (!noarg) {
            let c = mod.rglm.RGLM.RGLMChunk.blank();
            if (args) {
                const s = args.split(',');
                c.chr = s[0].toString().charAt(0) ?? '';
                c.fg = Math.max(Math.min(Number(s[1] ?? 0xff), 0xff), 0);
                c.bg = Math.max(Math.min(Number(s[2] ?? 0xff), 0xff), 0);
                c.st = Math.max(Math.min(Number(s[3] ?? 0xff), 0xff), 0);
                c.cust = Math.max(Math.min(Number(s[4] ?? 0xff), 0xff), 0);
            }
            map.place([c], ...cur);
            moveBy(1);
            command("d.r");
        }
    }
} //command
module.exports = async function Map(out, ...args) {
    console.info(`Writing: ${out || "map.rglm"}`);
    const mpg = /-{0,2}m(?:ap(?:pings?)?)?/.test(args[0]) ? args[1] : null;
    try {
        Rgl = await mod.rgl.RGL.load();
        if (mpg)
            Rgl.parseMappings(mpg);
    }
    catch (e) {
        Rgl = await mod.rgl.RGL.load({
            name: path.win32.basename(out || "map.rglm"),
            main: "main.js",
            description: "rgl map",
            version: "0.1.0",
            keywords: ["map", "make", "rgl"],
            mappings: mpg || "mappings.js"
        });
    }
    Rgl.capture();
    await Rgl.clear();
    try {
        map = await mod.rglm.RGLM.RGLMap.parse(gout = out || `map${Math.round(Math.random() * 0xffffffff)}.rglm`, Rgl);
    }
    catch (e) {
        map = mod.rglm.RGLM.RGLMap.blank(Rgl);
        map.parent = Rgl;
        map._loadedFrom = gout = `map${Math.round(Math.random() * 0xffffffff)}.rglm`;
    }
    Rgl.writeE(`Writing: ${gout}`);
    Rgl.writeE(help());
    let acc = "", history = [], histidx = 0, acidx = 0;
    patch();
    moveBy(0, 0);
    Rgl.on("rawctrlkey", async (k, c, a, b) => {
        if (!mod.rgl.RGL.special_keys.ctrlC.compare(k))
            quit();
        else if (!mod.rgl.RGL.special_keys.enter.compare(k)) {
            if (!acc)
                return;
            await Rgl.clear(-1);
            await Rgl.move(0);
            await command(acc);
            history.push(acc);
            while (history.length > 100)
                history.shift();
            acc = "";
            acidx = histidx = 0;
        }
        else if (!mod.rgl.RGL.special_keys.altEnter.compare(k)) {
            if (!acc)
                return;
            await Rgl.move(0);
            await command(acc);
            history.push(acc);
            while (history.length > 100)
                history.shift();
            histidx = 0;
        }
        else if (!mod.rgl.RGL.special_keys.back.compare(k)) {
            acc = acc.slice(0, acc.length - 1);
            await Rgl.move(-1, 0, true);
            Rgl.write(' ');
            await Rgl.move(-1, 0, true);
        }
        else if (!mod.rgl.RGL.special_keys.up.compare(k)) {
            moveBy(0, -1);
            command("d");
        }
        else if (!mod.rgl.RGL.special_keys.down.compare(k)) {
            moveBy(0, 1);
            command("d");
        }
        else if (!mod.rgl.RGL.special_keys.right.compare(k)) {
            moveBy(1, 0);
            command("d");
        }
        else if (!mod.rgl.RGL.special_keys.left.compare(k)) {
            moveBy(-1, 0);
            command("d");
        }
        else if (!mod.rgl.RGL.special_keys.shiftUp.compare(k)) {
            histidx = histidx <= history.length ? (histidx + 1) : histidx;
            acc = history[history.length - histidx] ?? acc;
            await Rgl.clear(-1);
            await Rgl.move(0);
            Rgl.write(acc);
        }
        else if (!mod.rgl.RGL.special_keys.shiftDown.compare(k)) {
            histidx = histidx > 0 ? (histidx - 1) : histidx;
            acc = history[history.length - histidx] ?? acc;
            await Rgl.clear(-1);
            await Rgl.move(0);
            Rgl.write(acc);
        }
        else {
            let s = b.toString();
            acc += s;
            Rgl.write(s);
            acidx++;
        }
    });
}; //map
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vYmluL21hcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBRUEsWUFBWSxDQUFDOzs7QUFFYix3REFBa0M7QUFDbEMsbURBQTZCO0FBQzdCLG1EQUE2QjtBQUM3QiwrQ0FBeUI7QUFDekIsMERBQTBCO0FBRTFCLElBQUksSUFBSSxHQUFZLEtBQUssRUFDeEIsR0FBZ0IsRUFDaEIsR0FBeUIsRUFDekIsSUFBWSxFQUNaLEdBQUcsR0FBcUIsQ0FBRSxDQUFDLEVBQUUsQ0FBQyxDQUFFLENBQUM7QUFFbEMsU0FBUyxJQUFJO0lBQ1osT0FBTzs7Ozs7Ozs7Ozs7Ozs7Ozs7OzswQ0FtQmtDLENBQUM7QUFDM0MsQ0FBQyxDQUFDLE1BQU07QUFFUixTQUFTLElBQUksQ0FBQyxJQUFZLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFZLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDbkQsSUFBSSxDQUEwQixDQUFDO0lBQy9CLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUM7UUFBRSxDQUFDLENBQUMsUUFBUSxHQUFHLENBQUMsSUFBWSxFQUFFLENBQTBCLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztJQUUxRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNsQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUVsQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQUUsR0FBRyxDQUFDLENB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QUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEIsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xCLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDZjthQUFNLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUMxRCxPQUFPLEdBQUcsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUVoRCxHQUFHLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLElBQUksR0FBRyxDQUFDO1lBRS9DLE1BQU0sR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BCLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsQixHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ2Y7YUFBTTtZQUNOLElBQUksQ0FBQyxHQUFXLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUM3QixHQUFHLElBQUksQ0FBQyxDQUFDO1lBQ1QsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNiLEtBQUssRUFBRSxDQUFDO1NBQ1I7SUFDRixDQUFDLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyIjIS91c3IvYmluL2VudiBub2RlXHJcblxyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbmltcG9ydCAqIGFzIG1vZCBmcm9tIFwiLi4vbGliL3JnbFwiO1xyXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gXCJwYXRoXCI7XHJcbmltcG9ydCAqIGFzIHV0aWwgZnJvbSBcInV0aWxcIjtcclxuaW1wb3J0ICogYXMgb3MgZnJvbSBcIm9zXCI7XHJcbmltcG9ydCBjaGFsayBmcm9tIFwiY2hhbGtcIjtcclxuXHJcbmxldCBxdGNuOiBib29sZWFuID0gZmFsc2UsXHJcblx0UmdsOiBtb2QucmdsLlJHTCxcclxuXHRtYXA6IG1vZC5yZ2xtLlJHTE0uUkdMTWFwLFxyXG5cdGdvdXQ6IHN0cmluZyxcclxuXHRjdXI6IFtudW1iZXIsIG51bWJlcl0gPSBbIDAsIDAgXTtcclxuXHJcbmZ1bmN0aW9uIGhlbHAoKTogc3RyaW5nIHtcclxuXHRyZXR1cm4gYENvbW1hbmRzOlxyXG5cdGhcdFx0XHQtXHREaXNwbGF5IHRoaXMgaGVscCBzY3JlZW5cclxuXHRkXHRcdFx0LVx0RGlzcGxheSBNYXBcclxuXHRjXHRcdFx0LVx0Q2xlYXIgU2NyZWVuXHJcblx0c1x0XHRcdC1cdFNhdmUgTWFwXHJcblx0bFx0XHRcdC1cdExvYWQgTWFwXHJcblx0clx0XHRcdC1cdFJlc2l6ZSBNYXAgKFZlcnkgSW1wb3J0YW50IHRvIGRvIGZpcnN0ISEpXHJcblx0dFx0XHRcdC1cdFRyaW0gbGVmdG92ZXJzIGFmdGVyIHJlc2l6ZVxyXG5cdGV2W2NkXHRcdC1cdEV2YWx1YXRlIGNvZGVcclxuXHRtXHRcdFx0LVx0U2V0L0dldCBNZXRhZGF0YVxyXG5cdG12XHRcdCAgIC1cdE1vdmUgQ3Vyc29yIChjYW4gYWxzbyB1c2Uga2V5Ym9hcmQgYXJyb3dzKVxyXG5cdG1vdlt1ZHJsXVx0LVx0TW92ZSBMaW5lXHJcblx0ZFtjcl1cdFx0LVx0RGVsZXRlIENvbHVtbi9Sb3cgYW5kIHJlc2l6ZVxyXG5cdFtjaCwxLDIsM1x0LVx0UGxhY2UgQ2h1bmtcclxuXHRjdHJsLUMvcXRcdC1cdFF1aXRcclxuXHJcblNlcGFyYXRlIENvbW1hbmRzIHdpdGggJy4nIChkb3QpXHJcblBhc3MgcGFyYW1ldGVycyB3aXRoIFhbYXJnLC4uLlxyXG5IaXQgRU5URVIgdG8gZXhlY3V0ZSAob3IgYWx0LWVudGVyIHRvIHBlcnNpc3QpXHJcbkFjY2VzcyBjb21tYW5kIGhpc3Rvcnkgd2l0aCBzaGlmdCt1cC9kb3duYDtcclxufSAvL2hlbHBcclxuXHJcbmZ1bmN0aW9uIG1vdmUoeDogbnVtYmVyID0gY3VyWzBdLCB5OiBudW1iZXIgPSBjdXJbMV0pIHtcclxuXHRsZXQgdDogbW9kLnJnbG0uUkdMTS5SR0xNQ2h1bms7XHJcblx0aWYgKHQgPSBtYXAuZ2V0KC4uLmN1cikpIHQub25yZW5kZXIgPSAoX2lkeDogbnVtYmVyLCBjOiBtb2QucmdsbS5SR0xNLlJHTE1DaHVuaykgPT4gYy5jaHIgPyBjLnByaW50IDogJyAnO1xyXG5cdFxyXG5cdGN1clswXSA9IHggJSAobWFwLmRpbWVuc1swXSB8fCAxKTtcclxuXHRjdXJbMV0gPSB5ICUgKG1hcC5kaW1lbnNbMV0gfHwgMSk7XHJcblx0XHJcblx0d2hpbGUgKGN1clswXSA8IDApIGN1clswXSArPSBtYXAuZGltZW5zWzBdO1xyXG5cdHdoaWxlIChjdXJbMV0gPCAwKSBjdXJbMV0gKz0gbWFwLmRpbWVuc1sxXTtcclxuXHRcclxuXHRpZiAodCA9IG1hcC5nZXQoLi4uY3VyKSkgdC5vbnJlbmRlciA9IChfaWR4OiBudW1iZXIsIF9jOiBtb2QucmdsbS5SR0xNLlJHTE1DaHVuaykgPT4gY2hhbGsuaW52ZXJzZS5pdGFsaWMuYm9sZC5pdGFsaWMoJ0AnKTtcclxuXHRcclxuXHRyZXR1cm4gY3VyO1xyXG59IC8vbW92ZVxyXG5mdW5jdGlvbiBtb3ZlQnkoZHg6IG51bWJlciA9IDAsIGR5OiBudW1iZXIgPSAwKSB7XHJcblx0cmV0dXJuIG1vdmUoY3VyWzBdICsgZHgsIGN1clsxXSArIGR5KTtcclxufSAvL21vdmVCeVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gcmVuZGVyKCkge1xyXG5cdGF3YWl0IGNvbW1hbmQoJ2MnKTtcclxuXHRhd2FpdCBtYXAuc3RhbXAoKTtcclxufSAvL3JlbmRlclxyXG5cclxuZnVuY3Rpb24gcGFkKG46IG51bWJlciA9IG1hcC5kaW1lbnNbMF0gKiBtYXAuZGltZW5zWzFdLCB3aWxkOiBib29sZWFuID0gZmFsc2UpIHtcclxuXHR3aGlsZSAobWFwLmNodW5rcy5sZW5ndGggPCBuKSB7XHJcblx0XHRjb25zdCBwOiBtb2QucmdsbS5SR0xNLlJHTE1DaHVuayA9IG1vZC5yZ2xtLlJHTE0uUkdMTUNodW5rLmJsYW5rKCk7XHJcblx0XHRcclxuXHRcdG1hcC5jaHVua3MucHVzaChwKTtcclxuXHRcdHAub25yZW5kZXIgPSAoX2lkeDogbnVtYmVyLCBjOiBtb2QucmdsbS5SR0xNLlJHTE1DaHVuayk6IHN0cmluZyA9PiBjLmNociA/IGMucHJpbnQgOiAnICc7XHJcblx0fVxyXG5cdFxyXG5cdHdoaWxlIChuIDwgbWFwLmNodW5rcy5sZW5ndGgpIHtcclxuXHRcdGlmICh3aWxkIHx8ICFtYXAuY2h1bmtzW21hcC5jaHVua3MubGVuZ3RoIC0gMV0uY2hyKVxyXG5cdFx0XHRtYXAuY2h1bmtzLnBvcCgpO1xyXG5cdFx0ZWxzZSBicmVhaztcclxuXHR9XHJcblx0XHJcblx0cmV0dXJuIGNvbW1hbmQoXCJkXCIpO1xyXG59IC8vcGFkXHJcbmZ1bmN0aW9uIHBhdGNoKCkge1xyXG5cdHJldHVybiBtYXAuY2h1bmtzLmZvckVhY2goKGM6IG1vZC5yZ2xtLlJHTE0uUkdMTUNodW5rKSA9PiBjLm9ucmVuZGVyID0gKF9pZHg6IG51bWJlciwgYzogbW9kLnJnbG0uUkdMTS5SR0xNQ2h1bmspOiBzdHJpbmcgPT4gYy5jaHIgPyBjLnByaW50IDogJyAnKTtcclxufSAvL3BhdGNoXHJcblxyXG5mdW5jdGlvbiBxdWl0KCk6IHZvaWQge1xyXG5cdGlmICghcXRjbikge1xyXG5cdFx0UmdsLndyaXRlRShcIlByZXNzIFF1aXQgYWdhaW4uXCIpO1xyXG5cdFx0cXRjbiA9IHRydWU7XHJcblx0XHRzZXRUaW1lb3V0KCgpID0+IChxdGNuID0gZmFsc2UpLCAyMDAwKTtcclxuXHR9IGVsc2Uge1xyXG5cdFx0UmdsLndyaXRlRShcIlF1aXQuXCIpO1xyXG5cdFx0cHJvY2Vzcy5leGl0KDEpO1xyXG5cdH1cclxufSAvL3F1aXRcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGNvbW1hbmQoYWNjOiBzdHJpbmcpIHtcclxuXHRsZXQgY29tbTogc3RyaW5nW10gPSBhY2Muc3BsaXQoLyg/PCFcXFxcKVxcLi9nbWkpLm1hcChjID0+IGMucmVwbGFjZUFsbCgvKD88IVxcXFwpXFxcXC9nbWksICcnKS5yZXBsYWNlQWxsKFwiXFxcXFxcXFxcIiwgXCJcXFxcXCIpKTtcclxuXHRcclxuXHRmb3IgKGNvbnN0IGNvbSBvZiBjb21tKSB7XHJcblx0XHRjb25zdCBhcmdzOiBzdHJpbmcgPSAoY29tLm1hdGNoKC9cXFsoLispJC9taXMpIHx8IFsgXSlbMV0sXHJcblx0XHRcdG5vYXJnOiBzdHJpbmcgPSBjb20ucmVwbGFjZSgvXFxbLiokL21pcywgXCJcIik7XHJcblx0XHRcclxuXHRcdGlmICgvXmgoPzplbHApPy9pcy50ZXN0KGNvbSkpIFJnbC53cml0ZUUoaGVscCgpKTtcclxuXHRcdGVsc2UgaWYgKC9eZCg/OmlzKD86cCg/OmwoPzpheSk/KT8pPyk/KD86XFxbfCQpL2lzLnRlc3QoY29tKSkgYXdhaXQgcmVuZGVyKCk7XHJcblx0XHRlbHNlIGlmICgvXmMoPzpsKD86KD86ZWEpP1tybl0pPyk/KD86XFxbfCQpL2lzLnRlc3QoY29tKSkgYXdhaXQgUmdsLmNsZWFyKCk7XHJcblx0XHRlbHNlIGlmICgvXmUoPzp2KD86YT9sKD86dWF0ZSk/KT8pPyg/OlxcW3wkKS9pcy50ZXN0KGNvbSkpIHtcclxuXHRcdFx0UmdsLndyaXRlRSh1dGlsLmluc3BlY3QoYXdhaXQgZXZhbChhcmdzID8/IFwiXCIpKSk7XHJcblx0XHR9IGVsc2UgaWYgKC9eKD86cSg/Oig/OnVpKT90KT98ZSg/Oig/OnhpKT90KT8pKD86XFxbfCQpL2lzLnRlc3QoY29tKSkgcXVpdCgpO1xyXG5cdFx0ZWxzZSBpZiAoL15zKD86YXZlP3x0bz9yZT8pPyg/OlxcW3wkKS9pcy50ZXN0KGNvbSkpIHtcclxuXHRcdFx0YXdhaXQgbWFwLnN0b3JlKGFyZ3MpO1xyXG5cdFx0XHRSZ2wud3JpdGVFKFwiTWFwIHNhdmVkLlwiKTtcclxuXHRcdH0gZWxzZSBpZiAoL14oPzpyZT8pP2woPzooPzpvYSk/ZCk/KD86XFxbfCQpL2lzLnRlc3QoY29tKSkge1xyXG5cdFx0XHRtYXAgPSBhd2FpdCBtb2QucmdsbS5SR0xNLlJHTE1hcC5wYXJzZShhcmdzIHx8IGdvdXQsIFJnbCk7XHJcblx0XHRcdHBhdGNoKCk7XHJcblx0XHRcdFJnbC53cml0ZUUoXCJNYXAgbG9hZGVkLlwiKTtcclxuXHRcdH0gZWxzZSBpZiAoL15yZT8oPzpzKD86aT96ZT8pPyk/KD86XFxbfCQpL2lzLnRlc3QoY29tKSkge1xyXG5cdFx0XHRpZiAoYXJncykge1xyXG5cdFx0XHRcdGNvbnN0IHM6IG51bWJlcltdID0gYXJncy5zcGxpdCgnLCcpLm1hcChOdW1iZXIpO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdG1hcC5kaW1lbnNbMF0gPSBNYXRoLm1heCh0eXBlb2Ygc1swXSA9PSBcIm51bWJlclwiID8gc1swXSA6IG1hcC5kaW1lbnNbMF0sIDApO1xyXG5cdFx0XHRcdG1hcC5kaW1lbnNbMV0gPSBNYXRoLm1heCh0eXBlb2Ygc1sxXSA9PSBcIm51bWJlclwiID8gc1sxXSA6IG1hcC5kaW1lbnNbMV0sIDApO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGF3YWl0IHBhZCgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHRSZ2wud3JpdGVFKGBTaXplOiAke21hcC5kaW1lbnMuam9pbihcIiwgXCIpfVxcdEN1cnNvcjogJHtjdXIuam9pbihcIiwgXCIpfWApO1xyXG5cdFx0fSBlbHNlIGlmICgvXnQoPzpyaT9tKT8vaXMudGVzdChjb20pKSB7XHJcblx0XHRcdGNvbnN0IHM6IG51bWJlciA9IGFyZ3MgPyBOdW1iZXIoYXJncykgOiAobWFwLmRpbWVuc1swXSAqIG1hcC5kaW1lbnNbMV0pO1xyXG5cdFx0XHRcclxuXHRcdFx0YXdhaXQgcGFkKHMsIHRydWUpO1xyXG5cdFx0fSBlbHNlIGlmICgvXm0oPzpldGE/KD86ZGE/dGE/KT8pPyg/OlxcW3wkKS9pcy50ZXN0KGNvbSkpIHtcclxuXHRcdFx0Y29uc3QgczogW3N0cmluZywgc3RyaW5nXSA9IChhcmdzID8/IFwiXCIpLnNwbGl0KCc9JykgYXMgW3N0cmluZywgc3RyaW5nXTtcclxuXHRcdFx0XHJcblx0XHRcdGlmIChzLmxlbmd0aCA+PSAyKSB7XHJcblx0XHRcdFx0bWFwLm1ldGFbc1swXV0gPSBzWzFdID8/IFwiXCI7XHJcblx0XHRcdFx0Y29tbWFuZChgbWV0YVske3NbMF19YCk7XHJcblx0XHRcdH0gZWxzZSBpZiAocy5sZW5ndGggJiYgc1swXSkgUmdsLndyaXRlRShzWzBdLCBcIiA9IFwiLCBtYXAubWV0YVtzWzBdXSA/PyBcIlwiKTtcclxuXHRcdFx0ZWxzZSBSZ2wud3JpdGVFKEFycmF5LmZyb20oT2JqZWN0LmVudHJpZXMobWFwLm1ldGEgfHwge30pLm1hcChlID0+IFwiLSBcIiArIGUuam9pbihcIiA9IFwiKSkpLmpvaW4ob3MuRU9MKSk7XHJcblx0XHR9IGVsc2UgaWYgKC9ebSg/Om92ZT98dik/KD86XFxbfCQpL2lzLnRlc3QoY29tKSkge1xyXG5cdFx0XHRtb3ZlKC4uLihhcmdzID8/IFwiMCwwXCIpLnNwbGl0KCcsJykubWFwKE51bWJlcikpO1xyXG5cdFx0XHRjb21tYW5kKFwiZC5yXCIpO1xyXG5cdFx0fSBlbHNlIGlmICgvXm0oPzpvdmU/fHYpP3VwPyg/OlxcW3wkKS9pcy50ZXN0KGNvbSkpIHtcclxuXHRcdFx0bGV0IGJ5OiBudW1iZXIgPSAtMTtcclxuXHRcdFx0XHJcblx0XHRcdGlmIChhcmdzKSBieSA9IC1OdW1iZXIoYXJncyk7XHJcblx0XHRcdFxyXG5cdFx0XHRsZXQgdCA9IGJ5ICsgY3VyWzFdO1xyXG5cdFx0XHRcclxuXHRcdFx0d2hpbGUgKHQgPCAwKSB0ICs9IG1hcC5kaW1lbnNbMV07XHJcblx0XHRcdHQgPSB0ICUgbWFwLmRpbWVuc1sxXTtcclxuXHRcdFx0XHJcblx0XHRcdGlmICh0ICE9IGN1clsxXSlcclxuXHRcdFx0XHRmb3IgKGxldCB4OiBudW1iZXIgPSAwOyB4IDwgbWFwLmRpbWVuc1swXTsgeCsrKVxyXG5cdFx0XHRcdFx0bWFwLnN3YXAobWFwLmdldCh4LCBjdXJbMV0pLCBtYXAuZ2V0KHgsIHQpKTtcclxuXHRcdFx0XHJcblx0XHRcdG1vdmVCeSgwLCBieSk7XHJcblx0XHRcdGNvbW1hbmQoXCJkXCIpO1xyXG5cdFx0fSBlbHNlIGlmICgvXm0oPzpvdmU/fHYpP2QoPzpvP3duKT8oPzpcXFt8JCkvaXMudGVzdChjb20pKSB7XHJcblx0XHRcdGxldCBieTogbnVtYmVyID0gMTtcclxuXHRcdFx0XHJcblx0XHRcdGlmIChhcmdzKSBieSA9IE51bWJlcihhcmdzKTtcclxuXHRcdFx0XHJcblx0XHRcdGxldCB0ID0gYnkgKyBjdXJbMV07XHJcblx0XHRcdFxyXG5cdFx0XHR3aGlsZSAodCA8IDApIHQgKz0gbWFwLmRpbWVuc1sxXTtcclxuXHRcdFx0dCA9IHQgJSBtYXAuZGltZW5zWzFdO1xyXG5cdFx0XHRcclxuXHRcdFx0aWYgKHQgIT0gY3VyWzFdKVxyXG5cdFx0XHRcdGZvciAobGV0IHg6IG51bWJlciA9IDA7IHggPCBtYXAuZGltZW5zWzBdOyB4KyspXHJcblx0XHRcdFx0XHRtYXAuc3dhcChtYXAuZ2V0KHgsIGN1clsxXSksIG1hcC5nZXQoeCwgdCkpO1xyXG5cdFx0XHRcclxuXHRcdFx0bW92ZUJ5KDAsIGJ5KTtcclxuXHRcdFx0Y29tbWFuZChcImRcIik7XHJcblx0XHR9IGVsc2UgaWYgKC9ebSg/Om92ZT98dik/cig/Omk/Z2g/dCk/KD86XFxbfCQpL2lzLnRlc3QoY29tKSkge1xyXG5cdFx0XHRsZXQgYnk6IG51bWJlciA9IDE7XHJcblx0XHRcdFxyXG5cdFx0XHRpZiAoYXJncykgYnkgPSBOdW1iZXIoYXJncyk7XHJcblx0XHRcdFxyXG5cdFx0XHRsZXQgdCA9IGJ5ICsgY3VyWzBdO1xyXG5cdFx0XHRcclxuXHRcdFx0d2hpbGUgKHQgPCAwKSB0ICs9IG1hcC5kaW1lbnNbMF07XHJcblx0XHRcdHQgPSB0ICUgbWFwLmRpbWVuc1swXTtcclxuXHRcdFx0XHJcblx0XHRcdGlmICh0ICE9IGN1clswXSlcclxuXHRcdFx0XHRmb3IgKGxldCB5OiBudW1iZXIgPSAwOyB5IDwgbWFwLmRpbWVuc1sxXTsgeSsrKVxyXG5cdFx0XHRcdFx0bWFwLnN3YXAobWFwLmdldChjdXJbMF0sIHkpLCBtYXAuZ2V0KHQsIHkpKTtcclxuXHRcdFx0XHJcblx0XHRcdG1vdmVCeShieSk7XHJcblx0XHRcdGNvbW1hbmQoXCJkXCIpO1xyXG5cdFx0fSBlbHNlIGlmICgvXm0oPzpvdmU/fHYpP2woPzplP2Z0KT8oPzpcXFt8JCkvaXMudGVzdChjb20pKSB7XHJcblx0XHRcdGxldCBieTogbnVtYmVyID0gLTE7XHJcblx0XHRcdFxyXG5cdFx0XHRpZiAoYXJncykgYnkgPSAtTnVtYmVyKGFyZ3MpO1xyXG5cdFx0XHRcclxuXHRcdFx0bGV0IHQgPSBieSArIGN1clswXTtcclxuXHRcdFx0XHJcblx0XHRcdHdoaWxlICh0IDwgMCkgdCArPSBtYXAuZGltZW5zWzBdO1xyXG5cdFx0XHR0ID0gdCAlIG1hcC5kaW1lbnNbMF07XHJcblx0XHRcdFxyXG5cdFx0XHRpZiAodCAhPSBjdXJbMF0pXHJcblx0XHRcdFx0Zm9yIChsZXQgeTogbnVtYmVyID0gMDsgeSA8IG1hcC5kaW1lbnNbMV07IHkrKylcclxuXHRcdFx0XHRcdG1hcC5zd2FwKG1hcC5nZXQoY3VyWzBdLCB5KSwgbWFwLmdldCh0LCB5KSk7XHJcblx0XHRcdFxyXG5cdFx0XHRtb3ZlQnkoYnkpO1xyXG5cdFx0XHRjb21tYW5kKFwiZFwiKTtcclxuXHRcdH0gZWxzZSBpZiAoL15kKD86ZT9sKD86ZT90ZT8pKT9yKD86bz93KT8oPzpcXFt8JCkvaXMudGVzdChjb20pKSB7XHJcblx0XHRcdG1hcC5wbGFjZShbXSwgMCwgY3VyWzFdLCBtYXAuZGltZW5zWzBdKTtcclxuXHRcdFx0bW92ZUJ5KCk7XHJcblx0XHRcdGF3YWl0IGNvbW1hbmQoYGQuclske21hcC5kaW1lbnNbMF19LCR7TWF0aC5tYXgobWFwLmRpbWVuc1sxXSAtIDEsIDApfWApO1xyXG5cdFx0XHRpZiAoTnVtYmVyKGFyZ3MgPz8gMCkgPiAxKSBhd2FpdCBjb21tYW5kKFwiZHIuXCIucmVwZWF0KE51bWJlcihhcmdzKSAtIDEpKTtcclxuXHRcdH0gZWxzZSBpZiAoL15kKD86ZT9sKD86ZT90ZT8pKT9jKD86bz9sKD86dT9tbik/KT8oPzpcXFt8JCkvaXMudGVzdChjb20pKSB7XHJcblx0XHRcdGxldCBkZWxsaXN0OiBtb2QucmdsbS5SR0xNLlJHTE1DaHVua1tdID0gWyBdO1xyXG5cdFx0XHRcclxuXHRcdFx0Zm9yIChsZXQgaTogbnVtYmVyID0gMDsgaSA8IG1hcC5kaW1lbnNbMV07IGkrKykge1xyXG5cdFx0XHRcdGNvbnN0IHQ6IG1vZC5yZ2xtLlJHTE0uUkdMTUNodW5rID0gbWFwLmdldChjdXJbMF0sIGkpO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGlmICghdCkgY29udGludWU7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0dC5vbnJlbmRlciA9IChfaWR4OiBudW1iZXIsIGM6IG1vZC5yZ2xtLlJHTE0uUkdMTUNodW5rKTogc3RyaW5nID0+IGMucHJpbnQ7XHJcblx0XHRcdFx0ZGVsbGlzdC5wdXNoKHQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHRtb3ZlQnkoKTtcclxuXHRcdFx0ZGVsbGlzdC5mb3JFYWNoKGQgPT4gbWFwLnBsYWNlKFtdLCAuLi5tYXAuY2FsY0Noa0NyZChkKSkpO1xyXG5cdFx0XHRcclxuXHRcdFx0YXdhaXQgY29tbWFuZChgZC5yWyR7TWF0aC5tYXgobWFwLmRpbWVuc1swXSAtIDEsIDApfSwke21hcC5kaW1lbnNbMV19YCk7XHJcblx0XHRcdGlmIChOdW1iZXIoYXJncyA/PyAwKSA+IDEpIGF3YWl0IGNvbW1hbmQoXCJkYy5cIi5yZXBlYXQoTnVtYmVyKGFyZ3MpIC0gMSkpO1xyXG5cdFx0fSBlbHNlIGlmICgvXmRlbCg/OmV0ZSk/KD86XFxbfCQpL2lzLnRlc3QoY29tKSkge1xyXG5cdFx0XHRSZ2wud3JpdGVFKFwiVW5pbXBsZW1lbnRlZFwiKTtcclxuXHRcdH0gZWxzZSBpZiAoL15iKD86bCg/OmFuKT9rKT9yKD86bz93KT8oPzpcXFt8JCkvaXMudGVzdChjb20pKSB7XHJcblx0XHRcdFJnbC53cml0ZUUoXCJVbmltcGxlbWVudGVkXCIpO1xyXG5cdFx0fSBlbHNlIGlmICgvXmIoPzpsKD86YW4pP2spP2MoPzpvP2woPzp1P21uKT8pPyg/OlxcW3wkKS9pcy50ZXN0KGNvbSkpIHtcclxuXHRcdFx0UmdsLndyaXRlRShcIlVuaW1wbGVtZW50ZWRcIik7XHJcblx0XHR9IGVsc2UgaWYgKC9eYig/OmwoPzphbik/ayk/KD86XFxbfCQpL2lzLnRlc3QoY29tKSkge1xyXG5cdFx0XHRSZ2wud3JpdGVFKFwiVW5pbXBsZW1lbnRlZFwiKTtcclxuXHRcdH0gZWxzZSBpZiAoL15zdyg/OmE/cCk/KD86XFxbfCQpL2lzLnRlc3QoY29tKSkge1xyXG5cdFx0XHRSZ2wud3JpdGVFKFwiVW5pbXBsZW1lbnRlZFwiKTtcclxuXHRcdH0gZWxzZSBpZiAoL15zKD86aGk/ZnQ/KT9yKD86bz93KT8oPzpcXFt8JCkvaXMudGVzdChjb20pKSB7XHJcblx0XHRcdFJnbC53cml0ZUUoXCJVbmltcGxlbWVudGVkXCIpO1xyXG5cdFx0fSBlbHNlIGlmICgvXnMoPzpoaT9mdD8pP2MoPzpvP2woPzp1P21uKT8pPyg/OlxcW3wkKS9pcy50ZXN0KGNvbSkpIHtcclxuXHRcdFx0UmdsLndyaXRlRShcIlVuaW1wbGVtZW50ZWRcIik7XHJcblx0XHR9IGVsc2UgaWYgKCFub2FyZykge1xyXG5cdFx0XHRsZXQgYzogbW9kLnJnbG0uUkdMTS5SR0xNQ2h1bmsgPSBtb2QucmdsbS5SR0xNLlJHTE1DaHVuay5ibGFuaygpO1xyXG5cdFx0XHRcclxuXHRcdFx0aWYgKGFyZ3MpIHtcclxuXHRcdFx0XHRjb25zdCBzOiBbc3RyaW5nLCBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXJdID0gYXJncy5zcGxpdCgnLCcpIGFzIFtzdHJpbmcsIG51bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcl07XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0Yy5jaHJcdD0gc1swXS50b1N0cmluZygpLmNoYXJBdCgwKSA/PyAnJztcclxuXHRcdFx0XHRjLmZnXHQ9IE1hdGgubWF4KE1hdGgubWluKE51bWJlcihzWzFdID8/IDB4ZmYpLCAweGZmKSwgMCk7XHJcblx0XHRcdFx0Yy5iZ1x0PSBNYXRoLm1heChNYXRoLm1pbihOdW1iZXIoc1syXSA/PyAweGZmKSwgMHhmZiksIDApO1xyXG5cdFx0XHRcdGMuc3RcdD0gTWF0aC5tYXgoTWF0aC5taW4oTnVtYmVyKHNbM10gPz8gMHhmZiksIDB4ZmYpLCAwKTtcclxuXHRcdFx0XHRjLmN1c3RcdD0gTWF0aC5tYXgoTWF0aC5taW4oTnVtYmVyKHNbNF0gPz8gMHhmZiksIDB4ZmYpLCAwKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0bWFwLnBsYWNlKFtjXSwgLi4uY3VyKTtcclxuXHRcdFx0bW92ZUJ5KDEpO1xyXG5cdFx0XHRjb21tYW5kKFwiZC5yXCIpO1xyXG5cdFx0fVxyXG5cdH1cclxufSAvL2NvbW1hbmRcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gYXN5bmMgZnVuY3Rpb24gTWFwKG91dDogc3RyaW5nLCAuLi5hcmdzOiBzdHJpbmdbXSkge1xyXG5cdGNvbnNvbGUuaW5mbyhgV3JpdGluZzogJHtvdXQgfHwgXCJtYXAucmdsbVwifWApO1xyXG5cdFxyXG5cdGNvbnN0IG1wZzogbW9kLk51bGxhYmxlPHN0cmluZz4gPSAvLXswLDJ9bSg/OmFwKD86cGluZ3M/KT8pPy8udGVzdChhcmdzWzBdKSA/IGFyZ3NbMV0gOiBudWxsO1xyXG5cdFxyXG5cdHRyeSB7XHJcblx0XHRSZ2wgPSBhd2FpdCBtb2QucmdsLlJHTC5sb2FkKCk7XHJcblx0XHRcclxuXHRcdGlmIChtcGcpIFJnbC5wYXJzZU1hcHBpbmdzKG1wZyk7XHJcblx0fSBjYXRjaCAoZSkge1xyXG5cdFx0UmdsID0gYXdhaXQgbW9kLnJnbC5SR0wubG9hZCh7XHJcblx0XHRcdG5hbWU6IHBhdGgud2luMzIuYmFzZW5hbWUob3V0IHx8IFwibWFwLnJnbG1cIiksXHJcblx0XHRcdG1haW46IFwibWFpbi5qc1wiLFxyXG5cdFx0XHRkZXNjcmlwdGlvbjogXCJyZ2wgbWFwXCIsXHJcblx0XHRcdHZlcnNpb246IFwiMC4xLjBcIixcclxuXHRcdFx0a2V5d29yZHM6IFsgXCJtYXBcIiwgXCJtYWtlXCIsIFwicmdsXCIgXSxcclxuXHRcdFx0bWFwcGluZ3M6IG1wZyB8fCBcIm1hcHBpbmdzLmpzXCJcclxuXHRcdH0pO1xyXG5cdH1cclxuXHRcclxuXHRSZ2wuY2FwdHVyZSgpO1xyXG5cdGF3YWl0IFJnbC5jbGVhcigpO1xyXG5cdFxyXG5cdHRyeSB7XHJcblx0XHRtYXAgPSBhd2FpdCBtb2QucmdsbS5SR0xNLlJHTE1hcC5wYXJzZShnb3V0ID0gb3V0IHx8IGBtYXAke01hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmZmYpfS5yZ2xtYCwgUmdsKTtcclxuXHR9IGNhdGNoKGUpIHtcclxuXHRcdG1hcCA9IG1vZC5yZ2xtLlJHTE0uUkdMTWFwLmJsYW5rKFJnbCk7XHJcblx0XHRtYXAucGFyZW50ID0gUmdsO1xyXG5cdFx0bWFwLl9sb2FkZWRGcm9tID0gZ291dCA9IGBtYXAke01hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmZmYpfS5yZ2xtYDtcclxuXHR9XHJcblx0XHJcblx0UmdsLndyaXRlRShgV3JpdGluZzogJHtnb3V0fWApO1xyXG5cdFJnbC53cml0ZUUoaGVscCgpKTtcclxuXHRcclxuXHRsZXQgYWNjOiBzdHJpbmcgPSBcIlwiLFxyXG5cdFx0aGlzdG9yeTogc3RyaW5nW10gPSBbXSxcclxuXHRcdGhpc3RpZHg6IG51bWJlciA9IDAsXHJcblx0XHRhY2lkeDogbnVtYmVyID0gMDtcclxuXHRcclxuXHRwYXRjaCgpO1xyXG5cdG1vdmVCeSgwLCAwKTtcclxuXHRcclxuXHRSZ2wub24oXCJyYXdjdHJsa2V5XCIsIGFzeW5jIChrLCBjLCBhLCBiKSA9PiB7XHJcblx0XHRpZiAoIW1vZC5yZ2wuUkdMLnNwZWNpYWxfa2V5cy5jdHJsQy5jb21wYXJlKGspKSBxdWl0KCk7XHJcblx0XHRlbHNlIGlmICghbW9kLnJnbC5SR0wuc3BlY2lhbF9rZXlzLmVudGVyLmNvbXBhcmUoaykpIHtcclxuXHRcdFx0aWYgKCFhY2MpIHJldHVybjtcclxuXHRcdFx0XHJcblx0XHRcdGF3YWl0IFJnbC5jbGVhcigtMSk7XHJcblx0XHRcdGF3YWl0IFJnbC5tb3ZlKDApO1xyXG5cdFx0XHRcclxuXHRcdFx0YXdhaXQgY29tbWFuZChhY2MpO1xyXG5cdFx0XHRcclxuXHRcdFx0aGlzdG9yeS5wdXNoKGFjYyk7XHJcblx0XHRcdHdoaWxlIChoaXN0b3J5Lmxlbmd0aCA+IDEwMCkgaGlzdG9yeS5zaGlmdCgpO1xyXG5cdFx0XHRcclxuXHRcdFx0YWNjID0gXCJcIjtcclxuXHRcdFx0YWNpZHggPSBoaXN0aWR4ID0gMDtcclxuXHRcdH0gZWxzZSBpZiAoIW1vZC5yZ2wuUkdMLnNwZWNpYWxfa2V5cy5hbHRFbnRlci5jb21wYXJlKGspKSB7XHJcblx0XHRcdGlmICghYWNjKSByZXR1cm47XHJcblx0XHRcdFxyXG5cdFx0XHRhd2FpdCBSZ2wubW92ZSgwKTtcclxuXHRcdFx0XHJcblx0XHRcdGF3YWl0IGNvbW1hbmQoYWNjKTtcclxuXHRcdFx0XHJcblx0XHRcdGhpc3RvcnkucHVzaChhY2MpO1xyXG5cdFx0XHR3aGlsZSAoaGlzdG9yeS5sZW5ndGggPiAxMDApIGhpc3Rvcnkuc2hpZnQoKTtcclxuXHRcdFx0XHJcblx0XHRcdGhpc3RpZHggPSAwO1xyXG5cdFx0fSBlbHNlIGlmICghbW9kLnJnbC5SR0wuc3BlY2lhbF9rZXlzLmJhY2suY29tcGFyZShrKSkge1xyXG5cdFx0XHRhY2MgPSBhY2Muc2xpY2UoMCwgYWNjLmxlbmd0aCAtIDEpO1xyXG5cdFx0XHRhd2FpdCBSZ2wubW92ZSgtMSwgMCwgdHJ1ZSk7XHJcblx0XHRcdFJnbC53cml0ZSgnICcpO1xyXG5cdFx0XHRhd2FpdCBSZ2wubW92ZSgtMSwgMCwgdHJ1ZSk7XHJcblx0XHR9IGVsc2UgaWYgKCFtb2QucmdsLlJHTC5zcGVjaWFsX2tleXMudXAuY29tcGFyZShrKSkge1xyXG5cdFx0XHRtb3ZlQnkoMCwgLTEpO1xyXG5cdFx0XHRjb21tYW5kKFwiZFwiKTtcclxuXHRcdH0gZWxzZSBpZiAoIW1vZC5yZ2wuUkdMLnNwZWNpYWxfa2V5cy5kb3duLmNvbXBhcmUoaykpIHtcclxuXHRcdFx0bW92ZUJ5KDAsIDEpO1xyXG5cdFx0XHRjb21tYW5kKFwiZFwiKTtcclxuXHRcdH0gZWxzZSBpZiAoIW1vZC5yZ2wuUkdMLnNwZWNpYWxfa2V5cy5yaWdodC5jb21wYXJlKGspKSB7XHJcblx0XHRcdG1vdmVCeSgxLCAwKTtcclxuXHRcdFx0Y29tbWFuZChcImRcIik7XHJcblx0XHR9IGVsc2UgaWYgKCFtb2QucmdsLlJHTC5zcGVjaWFsX2tleXMubGVmdC5jb21wYXJlKGspKSB7XHJcblx0XHRcdG1vdmVCeSgtMSwgMCk7XHJcblx0XHRcdGNvbW1hbmQoXCJkXCIpO1xyXG5cdFx0fSBlbHNlIGlmICghbW9kLnJnbC5SR0wuc3BlY2lhbF9rZXlzLnNoaWZ0VXAuY29tcGFyZShrKSkge1xyXG5cdFx0XHRoaXN0aWR4ID0gaGlzdGlkeCA8PSBoaXN0b3J5Lmxlbmd0aCA/IChoaXN0aWR4ICsgMSkgOiBoaXN0aWR4O1xyXG5cdFx0XHRcclxuXHRcdFx0YWNjID0gaGlzdG9yeVtoaXN0b3J5Lmxlbmd0aCAtIGhpc3RpZHhdID8/IGFjYztcclxuXHRcdFx0XHJcblx0XHRcdGF3YWl0IFJnbC5jbGVhcigtMSk7XHJcblx0XHRcdGF3YWl0IFJnbC5tb3ZlKDApO1xyXG5cdFx0XHRSZ2wud3JpdGUoYWNjKTtcclxuXHRcdH0gZWxzZSBpZiAoIW1vZC5yZ2wuUkdMLnNwZWNpYWxfa2V5cy5zaGlmdERvd24uY29tcGFyZShrKSkge1xyXG5cdFx0XHRoaXN0aWR4ID0gaGlzdGlkeCA+IDAgPyAoaGlzdGlkeCAtIDEpIDogaGlzdGlkeDtcclxuXHRcdFx0XHJcblx0XHRcdGFjYyA9IGhpc3RvcnlbaGlzdG9yeS5sZW5ndGggLSBoaXN0aWR4XSA/PyBhY2M7XHJcblx0XHRcdFxyXG5cdFx0XHRhd2FpdCBSZ2wuY2xlYXIoLTEpO1xyXG5cdFx0XHRhd2FpdCBSZ2wubW92ZSgwKTtcclxuXHRcdFx0UmdsLndyaXRlKGFjYyk7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRsZXQgczogc3RyaW5nID0gYi50b1N0cmluZygpO1xyXG5cdFx0XHRhY2MgKz0gcztcclxuXHRcdFx0UmdsLndyaXRlKHMpO1xyXG5cdFx0XHRhY2lkeCsrO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59OyAvL21hcFxyXG4iXX0=